<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Indexed DB</title>
</head>
<body>
  <pre>
    The basic pattern that IndexedDB encourages is the following:

    1. Open a database.
    2. Create an object store in the database.
    3. Start a transaction and make a request to do some database operation, like adding or retrieving data.
    4. Wait for the operation to complete by listening to the right kind of DOM event.
    5. Do something with the results (which can be found on the request object).
  </pre>

  <script>
    // // check if indexedDB is supported or not
    // if (!window.indexedDB) {
    //   window.alert("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");
    // }
    //
    // // Let us open our database
    // var request = window.indexedDB.open("MyTestDatabase", 3);
    //
    // var db;
    // var request = indexedDB.open("MyTestDatabase");
    // request.onerror = function(event) {
    //   console.log("Database error: " + event.target.errorCode);
    // };
    // request.onsuccess = function(event) {
    //   console.log('yehhh its working fine!');
    //   var objectStore = db.createObjectStore("name", { keyPath: "myKey" });
    // };
    //
    // // This event is only implemented in recent browsers
    // request.onupgradeneeded = function(event) {
    //   // Save the IDBDatabase interface
    //   var db = event.target.result;
    //
    //   // Create an objectStore for this database
    //   var objectStore = db.createObjectStore("name", { keyPath: "myKey" });
    // };

    // This is what our customer data looks like.
    const customerData = [
      { ssn: "444-44-4444", name: "Bill", age: 35, email: "bill@company.com" },
      { ssn: "555-55-5555", name: "Donna", age: 32, email: "donna@home.org" }
    ];

    const dbName = "the_name";

    var request = indexedDB.open(dbName, 2);

    request.onerror = function(event) {
      // Handle errors.
    };
    request.onupgradeneeded = function(event) {
      var db = event.target.result;

      // Create an objectStore to hold information about our customers. We're
      // going to use "ssn" as our key path because it's guaranteed to be
      // unique - or at least that's what I was told during the kickoff meeting.
      var objectStore = db.createObjectStore("customers", { keyPath: "ssn" });

      // Create an index to search customers by name. We may have duplicates
      // so we can't use a unique index.
      objectStore.createIndex("name", "name", { unique: false });

      // Create an index to search customers by email. We want to ensure that
      // no two customers have the same email, so use a unique index.
      objectStore.createIndex("email", "email", { unique: true });

      // Use transaction oncomplete to make sure the objectStore creation is
      // finished before adding data into it.
      objectStore.transaction.oncomplete = function(event) {
        // Store values in the newly created objectStore.
        var customerObjectStore = db.transaction("customers", "readwrite").objectStore("customers");
        customerData.forEach(function(customer) {
          customerObjectStore.add(customer);
        });
      };
    };
  </script>
</body>
</html>
