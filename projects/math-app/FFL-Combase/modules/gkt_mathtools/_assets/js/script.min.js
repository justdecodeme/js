var cv=document.getElementById("cv"),cvOuter=document.getElementById("cvOuter");function whichTransitionEvent(){var e,t=document.createElement("fakeelement"),a={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in a)if(void 0!==t.style[e])return a[e]}Object.size=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a};var initTools=function(){var e=document.getElementById("toolsUniverse"),t=e.querySelectorAll(".tools-planet"),a=document.getElementById("toolsPlanetSets"),r=document.getElementById("toolsPlanetPens"),s=(e.offsetWidth,document.getElementById("minimizeToggleBtn")),n=document.getElementById("toolsPlanetSetsBtn"),i=document.getElementById("toolsPlanetPensBtn"),o=currSetType=null;t.forEach(function(e){var t=e.querySelectorAll("#"+e.id+">.tools-satellite.primary"),a=e.querySelector(".tools-satellite:first-child").offsetWidth,r=e.offsetWidth,s=(t.length,(r-a)/2);t.forEach(function(t,a){var r=a-3,n=Math.round(110*Math.cos(30*r*(Math.PI/180))),i=Math.round(110*Math.sin(30*r*(Math.PI/180))),o=Math.round(n+s),l=Math.round(i+s);if(t.style.left=o+"px",t.style.top=l+"px",t.classList.contains("has-child")){let a=t.dataset.toolGroupType,r=19,n=165;e.querySelectorAll('[data-tool-group-type="'+a+'"].secondary').forEach(function(e,t){let i=t-4.5;switch(a){case"pastel1":i=t+.7;break;case"pastel2":i=t+2.2;break;case"stroke":i=t+3.8;break;case"opacity":i=t+5.2;break;case"scale":i=t-4.5;break;case"set-square":i=t-2.2}let o=Math.sin(r*i*(Math.PI/180))*n,l=Math.cos(r*i*(Math.PI/180))*n;e.style.top=(o+s).toString()+"px",e.style.left=(l+s).toString()+"px"})}})}),a.classList.add("active"),n.classList.add("active"),n.classList.add("temp-active");var l=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type1].active");t&&(t.classList.remove("active"),initTools.currToolType=null,cv.removeEventListener("mousedown",initDraw.start,!1)),t!=e&&(e.classList.add("active"),initTools.currToolType=e.dataset.toolType1,cv.addEventListener("mousedown",initDraw.start,!1))},d=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type2].active");t&&t!=e&&(t.classList.remove("active"),e.classList.add("active")),initDraw.strokeColor=e.dataset.value},c=function(e,t,a,r){if(a)t.classList.contains("show-child")?t.classList.remove("show-child"):(document.querySelector(".has-child.show-child")&&document.querySelector(".has-child.show-child").classList.remove("show-child"),t.classList.add("show-child"));else if(r){var s=document.querySelector('[data-tool-group-type="'+e+'"].primary'),n=document.querySelector('[data-tool-group-type="'+e+'"].secondary.active');if("pastel"==e.substr(0,6)&&(document.querySelector("[data-tool-type2].primary.active").classList.remove("active"),s.setAttribute("data-tool-type2","pastel"),e="pastel"),"scale"!=e&&"set-square"!=e||(n=null),n&&n.classList.remove("active"),"scale"==e||"set-square"==e){if("scale"==e)var i=document.querySelectorAll('[data-tool-group-type="scale"].secondary.active');else if("set-square"==e)i=document.querySelectorAll('[data-tool-group-type="set-square"].secondary.active');i.length>0?s.classList.add("active"):s.classList.remove("active")}else t.classList.add("active"),s.classList.add("active");switch(s.classList.remove("show-child"),e){case"opacity":initDraw.strokeOpacity=parseFloat(t.dataset.value);break;case"stroke":initDraw.strokeWidth=parseFloat(t.dataset.value);break;case"pastel":var o=t.querySelector("img").getAttribute("src");s.querySelector("img").setAttribute("src",o),s.setAttribute("data-value",t.dataset.value),initDraw.strokeColor=t.dataset.value}}};return e.addEventListener("click",function(t){var o=t.target,u=o.id,v=o.dataset.toolType1,p=o.dataset.toolType2,g=o.dataset.toolGroupType,m=o.classList.contains("primary"),y=o.classList.contains("secondary"),h=o.dataset.panelBtn;"minimizeToggleBtn"==u?document.querySelector(".tools-planet.active")?(s.classList.add("active"),e.classList.remove("active"),n.classList.remove("active"),i.classList.remove("active"),document.querySelector(".tools-planet.active").classList.add("temp-active"),document.querySelector(".tools-planet.active").classList.remove("active")):(e.classList.add("active"),s.classList.remove("active"),document.querySelector(".tools-toggle .temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.remove("temp-active")):"toolsPlanetPensBtn"==u?(n.classList.remove("active"),n.classList.remove("temp-active"),a.classList.remove("active"),i.classList.add("active"),i.classList.add("temp-active"),r.classList.add("active"),e.classList.add("active"),s.classList.remove("active")):"toolsPlanetSetsBtn"==u?(i.classList.remove("active"),i.classList.remove("temp-active"),r.classList.remove("active"),n.classList.add("active"),n.classList.add("temp-active"),a.classList.add("active"),e.classList.add("active"),s.classList.remove("active")):"undo"==u?initDraw.undo():"redo"==u?initDraw.redo():"clear"==u?initDraw.clear():v?l(o):p?d(o):h&&initPanel.toggle(o),g&&c(g,o,m,y)},!1),{currToolType:o,currSetType:currSetType}}(),initDraw=function(){var e,t,a,r,s,n,i=document.querySelector('[data-tool-group-type="opacity"].secondary.active'),o=parseFloat(i.dataset.value),l=document.querySelector('[data-tool-group-type="stroke"].secondary.active'),d=parseFloat(l.dataset.value),c=document.querySelector('[data-tool-type2="pastel"].primary.active').dataset.value,u=mousemoveDraw=!1,v=null,p=0,g=null,m=[],y=[],h=!1,b=!1,f=null,L=null,P=null,x={radius:0,center:{x:0,y:0},point:{x:0,y:0},dotRadius:5},S=function(){u=mousemoveDraw=!1,null!==v&&null!=document.getElementById(v)&&m.push({Elements:[],Id:v,Action:"draw"}),cv.removeEventListener("mouseup",S,!1),cv.removeEventListener("mouseleave",S,!1)},T=function(i){if(u&&mousemoveDraw){if(i.preventDefault(),g=math.getMousePosition(i,cv),"pen"==t||"marker"==t)a=document.getElementById(v),s=a.getAttribute("points"),"marker"==t?s=e.x+","+e.y+" "+g.x+","+g.y:"pen"==t&&(b?(h=math.sideAndRange(g)).inRange?(P=math.getCoords(f,h.side,g,n),g.x=P.x,g.y=P.y,s+=" "+g.x+","+g.y):(cv.removeEventListener("mousemove",T,!1),cv.removeEventListener("mouseup",S,!1)):s+=" "+g.x+","+g.y),a.setAttribute("points",s);else if("eraser"==t){var o=i.target;o.classList.contains("drawing")&&(y=[],m.push({Elements:[o],Id:o.id,Action:"erase"}),o.remove())}if("compass"==L&&"arc"==t){var l=(r=document.getElementById(v)).querySelector("polyline");s=l.getAttribute("points"),f=math.getSetPoints(initTools.currSetType),x.point.x=f[2].x,x.point.y=f[2].y,s+=" "+x.point.x+","+x.point.y,l.setAttribute("points",s)}cv.addEventListener("mouseleave",S,!1)}mousemoveDraw=!0};return{start:function(s){u=!0,s.preventDefault();var i=initDraw.strokeOpacity,o=initDraw.strokeColor,l=initDraw.strokeWidth,d=initDraw.strokeWidth+10;g=math.getMousePosition(s,cv),v="shape"+p,t=initTools.currToolType,L=initTools.currSetType,e=g,L&&("scale"==L.substr(0,5)&&(f=math.getSetPoints(initTools.currSetType),h=math.sideAndRange(g),b=h.inRange,n=h.slope,console.log(h),b&&(P=math.getCoords(f,h.side,g,n),g.x=P.x,g.y=P.y)),"compass"==L&&"arc"==t&&(f=math.getSetPoints(initTools.currSetType),x.center.x=f[1].x,x.center.y=f[1].y,x.point.x=f[2].x,x.point.y=f[2].y,x.radius=Math.sqrt((f[2].x-f[1].x)*(f[2].x-f[1].x)+(f[2].y-f[1].y)*(f[2].y-f[1].y)),x.radius=math.parseToFloat(x.radius,2),r=`<g class="drawing" id="${v}">\n            <ellipse style="fill:${o};stroke-width:0;stroke:none;" cx="${x.center.x}px" cy="${x.center.y}px" rx="${x.dotRadius}px" ry="${x.dotRadius}px"></ellipse>\n            <polyline style="fill:none;stroke-linecap:round;stroke:${o};stroke-width:3" points="${x.point.x},${x.point.y} "></polyline>\n          </g>`,cv.innerHTML+=r)),"pen"!=t&&"marker"!=t||("pen"==t?a='<polyline class="drawing" id="'+v+'" style="opacity:'+i+";fill:none;stroke-linecap:round;stroke:"+o+";stroke-width:"+l+'" points="'+g.x+","+g.y+'" />':"marker"==t&&(a='<polyline class="drawing" id="'+v+'" style="fill:none;stroke-linecap:round;stroke:rgba(0, 255, 0, .5);stroke-width:'+d+'" points="'+g.x+","+g.y+'" />'),cv.innerHTML+=a),cv.addEventListener("mousemove",T,!1),cv.addEventListener("mouseup",S,!1),p++},undo:function(){if(m.length>0){var e,t=m.pop();switch(t.Action){case"draw":e=document.getElementById(t.Id),t.Elements.push(e),e.parentNode.removeChild(e);break;case"erase":cv.appendChild(t.Elements[0]);break;case"clear":t.Elements.forEach(function(e){cv.appendChild(e),p++})}y.push(t)}},redo:function(){if(y.length>0){var e,t=y.pop();switch(t.Action){case"draw":e=t.Elements[0],cv.appendChild(e);break;case"erase":(e=t.Elements[0]).parentNode.removeChild(e);break;case"clear":t.Elements.forEach(function(e){e.parentNode.removeChild(e)})}m.push(t)}},clear:function(){p=0;var e=document.querySelectorAll(".drawing");y=[],m.push({Elements:e,Id:null,Action:"clear"}),cv.innerHTML=""},strokeOpacity:o,strokeWidth:d,strokeColor:c}}(),initMove=function(){var e=0,t=0,a=0,r=0,s=dropParent=oldDragParent=null,n=function(e,t){var a=e.querySelectorAll(".drag-area");"add"==t?a.length>0?a.forEach(function(e){e.addEventListener("mousedown",i,!1)}):e.addEventListener("mousedown",i,!1):"remove"==t&&(a.length>0?a.forEach(function(e){e.removeEventListener("mousedown",i,!1)}):e.removeEventListener("mousedown",i,!1))},i=function(a){initMove.mousemove=!1;var r=math.getMousePosition(a,cv);initMove.dragParent=a.target.closest(".draggable");var s=initMove.dragParent;if(a.target.classList.contains("drag-area")){if(cvOuter.classList.add("dragging"),e=r.x,t=r.y,s!=initMove.oldDragParent&&(s.style.zIndex=++initMove.dragParentzIndex),initMove.oldDragParent=initMove.dragParent,s.dataset.panelSet){var n=document.querySelector(".draggable-set.highlight");n&&n.classList.remove("highlight"),initTools.currSetType=s.dataset.panel,s.classList.add("highlight")}s.classList.contains("draggable-cubes")&&initCubes.getCoords(),cvOuter.addEventListener("mousemove",o,!1),cvOuter.addEventListener("mouseup",l,!1),s.addEventListener("dragstart",initDrag.start,!1)}s.dataset.sealType&&initPanel.trashPanel(a,"start",s.dataset.sealType)},o=function(s){initMove.mousemove=!0,s.preventDefault();var n=math.getMousePosition(s,cv),i=initMove.dragParent;if(a=e-n.x,r=t-n.y,e=n.x,t=n.y,i.style.left=i.offsetLeft-a+"px",i==toolsUniverse){var o=cvOuter.getBoundingClientRect().height-i.getBoundingClientRect().height-i.offsetTop;i.style.bottom=o+r+"px"}else i.style.top=i.offsetTop-r+"px";i.classList.contains("draggable-cubes")&&(i.classList.remove("detach"),initCubes.getShortestDist(),null!=initCubes.shortestDist&&(initCubes.shortestDist<initCubes.snapDist?initCubes.highlight(!0):initCubes.highlight(!1))),i.dataset.sealType&&initPanel.trashPanel(s,"move")},l=function(e){e.preventDefault();var t=initMove.dragParent;cvOuter.classList.remove("dragging"),t.classList.contains("draggable-cubes")&&null!=initCubes.shortestDist&&initCubes.shortestDist<initCubes.snapDist&&(initCubes.snap(),initCubes.shortestDist=null),t.dataset.sealType&&initPanel.trashPanel(e,"end")&&t.remove(),cvOuter.removeEventListener("mousemove",o,!1),cvOuter.removeEventListener("mouseup",l,!1),t.removeEventListener("dragstart",initDrag.start,!1)};return n(toolsUniverse,"add"),{mousemove:!1,dragParentzIndex:0,dragParent:s,dropParent:dropParent,oldDragParent:oldDragParent,init:n}}(),initDrag=function(){var e,t,a=function(e){e.preventDefault()},r=function(e){e.preventDefault()},s=function(e){e.preventDefault(),cvOuter.classList.add("dropping")},n=function(i){i.preventDefault();var o=i.dataTransfer.getData("sealType"),l=i.dataTransfer.getData("src"),d=i.dataTransfer.getData("width"),c=i.dataTransfer.getData("height"),u=i.dataTransfer.getData("sealDesign"),v=i.dataTransfer.getData("sealValue");cvOuter.classList.remove("dropping");var p,g=sealTypes[o].max;document.querySelectorAll('[data-seal-type="'+o+'"].dropped-seal').length<g?("cubes"==o||"numbers"==o?((p=document.createElement("div")).classList.add("draggable-cubes"),p.setAttribute("data-seal-type",o),"numbers"==o&&(p.setAttribute("data-number-design",u),p.setAttribute("data-number-value",v)),p.innerHTML=`\n          <div class="cube-outer drag-area" data-index="0" data-seal-type="${o}">\n            <div class="cube"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>\n          <div class="detach-btn"></div>\n          `,p.addEventListener("dblclick",initCubes.remove,!1),p.addEventListener("click",initCubes.detachUI,!1)):((p=document.createElement("img")).src=l,p.width=d,p.height=c,p.classList.add("dropped-seal"),p.classList.add("drag-area"),p.setAttribute("data-seal-type",o),p.addEventListener("dblclick",e=>{p.remove()},!1)),p.setAttribute("data-id",++initDrag.draggablesId),p.style.zIndex=++initMove.dragParentzIndex,p.style.left=i.offsetX-e+"px",p.style.top=i.offsetY-t+"px",p.classList.add("draggable"),cvOuter.appendChild(p),initDrag.dropElHeight=p.getBoundingClientRect().height,initMove.init(p,"add"),cvOuter.removeEventListener("dragenter",a),cvOuter.removeEventListener("dragleave",r),cvOuter.removeEventListener("dragover",s),cvOuter.removeEventListener("drop",n)):alert("You can only place max "+g+" of "+o+" seal type.")};return{start:function(i){e=i.offsetX,t=i.offsetY,i.dataTransfer.setData("src",i.target.src),i.dataTransfer.setData("width",i.target.getBoundingClientRect().width),i.dataTransfer.setData("height",i.target.getBoundingClientRect().height),i.dataTransfer.setData("sealType",i.target.dataset.sealType),i.target.dataset.numberDesign&&(i.dataTransfer.setData("sealDesign",i.target.dataset.numberDesign),i.dataTransfer.setData("sealValue",i.target.dataset.numberValue)),cvOuter.addEventListener("dragenter",a,!1),cvOuter.addEventListener("dragleave",r,!1),cvOuter.addEventListener("dragover",s,!1),cvOuter.addEventListener("drop",n,!1)},draggablesId:0,dropElHeight:0}}(),fetchSeals=function(){for(var e in sealTypes){var t=document.querySelector('[data-panel="'+e+'"] .content');if(sealTypes.hasOwnProperty(e)){var a=sealTypes[e].values;if("numbers"==e)for(var r in a)for(var s=0;s<a[r].length;s++){var n=a[r][s][0],i=a[r][s][1],o=document.createElement("img");o.classList.add("draggable-seal"),o.setAttribute("data-seal-type",e),o.setAttribute("data-number-design",r),o.setAttribute("data-number-value",i),o.src="./_assets/img/"+n,t.appendChild(o)}else a.forEach(a=>{var r=document.createElement("img");r.classList.add("draggable-seal"),r.setAttribute("data-seal-type",e),r.src="./_assets/img/"+a,t.appendChild(r)})}}}(),initPanel=function(e){var t=oldPanel=panelType=panelBtn=panelPosObj=panelCloseBtn=panelScaleFlipBtn=panelScaleBtn=draggableSeals=rotateBtns=null,a=function(e){e.type?(t=this.closest(".draggable"),panelType=t.dataset.panel):(panelType=e,t=document.querySelector('[data-panel="'+panelType+'"]')),panelBtn=document.querySelector('[data-panel-btn="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelFlipBtn=t.querySelector(".flip-btn"),panelScaleBtn=t.querySelector(".scale-btn"),panelScaleFlipBtn=t.querySelector(".scale-flip-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),t.classList.remove("active"),panelBtn.classList.remove("active"),rotateBtns=t.querySelectorAll(".rotate-btn"),panelCloseBtn.removeEventListener("click",a,!1),initMove.init(t,"remove");for(var i=0;i<draggableSeals.length;i++)draggableSeals[i].removeEventListener("dragstart",initDrag.start,!1);for(i=0;i<rotateBtns.length;i++)rotateBtns[i].removeEventListener("mousedown",initRotate.start,!1),rotateBtns[i].classList.contains("rotate-compass-draw")&&rotateBtns[i].removeEventListener("mousedown",initDraw.start,!1);if(panelScaleBtn&&panelScaleBtn.removeEventListener("mousedown",initScale.start,!1),panelFlipBtn&&panelFlipBtn.removeEventListener("click",s,!1),panelScaleFlipBtn&&panelScaleFlipBtn.removeEventListener("click",n,!1),"calculator"==panelType){var o=t.querySelectorAll("[data-button-type]");for(i=0;i<o.length;i++)o[i].removeEventListener("click",initCalc.calculate,!1)}if("abacus"==panelType){var l=document.querySelectorAll('[data-panel="abacus"] .bead'),d=document.getElementById("leftCol");for(i=0;i<l.length;i++)l[i].removeEventListener("click",initAbacus.changePos,!1);d.removeEventListener("mousedown",initAbacus.resetStart,!1)}if(t.classList.contains("draggable-seal")&&t.removeEventListener("click",r,!1),"scale"==panelType.substr(0,5)){var c=document.querySelectorAll('[data-tool-group-type="scale"].secondary.active'),u=document.querySelector('[data-tool-group-type="scale"]');c.length<1&&u.classList.remove("active")}else if("set-square"==panelType.substr(0,10)){c=document.querySelectorAll('[data-tool-group-type="set-square"].secondary.active'),u=document.querySelector('[data-tool-group-type="set-square"]');c.length<1&&u.classList.remove("active")}t.dataset.panelSet&&(initTools.currSetType=null)},r=function(e){t=this.closest(".draggable"),oldPanel!=t&&(t.style.zIndex=++initMove.dragParentzIndex,t.dataset.panelSet&&(initTools.currSetType=t.dataset.panel)),oldPanel=t},s=function(e){t.classList.contains("flipped")?t.classList.remove("flipped"):t.classList.add("flipped")},n=function(e){console.log("scale flipping")};return{toggle:function(e){if(panelType=e.dataset.panelBtn,e.classList.contains("active"))a(panelType);else{t=document.querySelector('[data-panel="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelScaleBtn=t.querySelector(".scale-btn"),panelFlipBtn=t.querySelector(".flip-btn"),rotateBtns=t.querySelectorAll(".rotate-btn"),panelScaleFlipBtn=t.querySelector(".scale-flip-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),e.classList.add("active"),t.classList.add("active"),t.style.zIndex=++initMove.dragParentzIndex,initMove.dragParent=t,initMove.oldDragParent=t,panelCloseBtn.addEventListener("click",a,!1),initMove.init(t,"add");for(var i=0;i<draggableSeals.length;i++)draggableSeals[i].addEventListener("dragstart",initDrag.start,!1);for(i=0;i<rotateBtns.length;i++)rotateBtns[i].addEventListener("mousedown",initRotate.start,!1),rotateBtns[i].classList.contains("rotate-compass-draw")&&rotateBtns[i].addEventListener("mousedown",initDraw.start,!1);if(panelScaleBtn&&panelScaleBtn.addEventListener("mousedown",initScale.start,!1),panelFlipBtn&&panelFlipBtn.addEventListener("click",s,!1),panelScaleFlipBtn&&panelScaleFlipBtn.addEventListener("click",n,!1),"abacus"==panelType){var o=document.querySelectorAll('[data-panel="abacus"] .bead');for(i=0;i<o.length;i++)o[i].addEventListener("click",initAbacus.changePos,!1);document.getElementById("leftCol").addEventListener("mousedown",initAbacus.resetStart,!1)}if("calculator"==panelType){var l=t.querySelectorAll("[data-button-type]");for(i=0;i<l.length;i++)l[i].addEventListener("click",initCalc.calculate,!1)}if(t.classList.contains("draggable-seal")&&t.addEventListener("click",r,!1),t.dataset.panelSet){var d=document.querySelector(".draggable-set.highlight");d&&d.classList.remove("highlight"),initTools.currSetType=t.dataset.panel,t.classList.add("highlight")}}},trashPanel:function(e,a,r){var s=math.getMousePosition(e,cv);if("start"==a){var n=(t=document.querySelector('[data-panel="'+r+'"]')).getBoundingClientRect();panelPosObj={x1:n.left,x2:n.left+n.width,y1:n.top,y2:n.top+n.height}}if("move"==a&&(t.style.zIndex=initMove.dragParentzIndex,t.classList.add("trash")),s.x>panelPosObj.x1&&s.x<panelPosObj.x2&&s.y>panelPosObj.y1&&s.y<panelPosObj.y2?t.classList.add("trash-active"):t.classList.remove("trash-active"),"end"==a)return t.classList.remove("trash"),!!t.classList.contains("trash-active")&&(t.classList.remove("trash-active"),!0)}}}(),initCubes=function(e){var t={},a=3,r=3,s=dragParentTop=shortestDist=snapType=dragParent=dropParent=cubeLimit=cubeOuter=null,n=null,i=function(){var e=whichTransitionEvent(),t=dragParent.querySelector("[data-seal-type]").dataset.sealType,n=dragParent.querySelector("img").src,i=dragParent.querySelector("img").width,o=dragParent.querySelector("img").height;if("numbers"==t&&(a=10,r=0),cubeLimit="vertical"==snapType?a:r,"vertical"==snapType)var l=dropParent.querySelectorAll(".drag-area").length,d=dragParent.querySelectorAll(".drag-area").length;else l=dropParent.querySelectorAll(".cube-outer").length,d=dragParent.querySelectorAll(".cube-outer").length;var c=l+d;if(c<=cubeLimit){if(cubeOuter="","vertical"==snapType){for(var u=0;u<d;u++)cubeOuter+=`\n            <div class="cube-outer drag-area" data-index="${l+u}" data-seal-type="${t}">\n              <div class="cube"><img src="${n}" style="width: ${i}px; height: ${o}px;"></div>\n            </div>        \n          `;initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent}else if("horizontal"==snapType){cubeOuter="";for(var v=0;v<c;v++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${v}" data-seal-type="${t}">`;for(u=0;u<a;u++)cubeOuter+=`<div class="cube"><img src="${n}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+="</div>"}cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>\n          <div class="detach-btn"></div>     \n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,initMove.init(dropParent,"add")}if("horizontal"==snapType&&dropParent.classList.add("horizontal"),(c=dropParent.querySelectorAll(".cube-outer").length)==cubeLimit){if("numbers"==t){for(u=0;u<a;u++)dropParent.querySelector('[data-index="'+u+'"]').remove();cubeOuter=`\n            <div class="cube-outer drag-area" data-index="0" data-seal-type="numbers">\n              <div class="cube"><img src="${"_assets/img/number-"+dropParent.dataset.numberDesign+"-"+10*dropParent.dataset.numberValue+".svg"}" style="width: ${i}px; height: ${o}px;"></div>\n            </div>        \n          `,dropParent.classList.remove("vertical"),dropParent.classList.remove("detach"),dropParent.setAttribute("data-number-value",10*dropParent.dataset.numberValue),dropParent.innerHTML+=cubeOuter}else if("cubes"==t)if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${n}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+='\n              </div>\n              <div class="dot dot-top"></div>\n              <div class="dot dot-bottom"></div>\n              <div class="dot dot-left"></div>\n              <div class="dot dot-right"></div>     \n              <div class="detach-btn"></div>\n            ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical")}else"horizontal"==snapType&&(dropParent=initMove.dropParent,dropParent.classList.add("complete"));console.log("limit reached!!!!!!!!!!")}initMove.init(dropParent,"add"),dragParent.remove(),dropParent.style.zIndex=++initMove.dragParentzIndex}else if(c>cubeLimit){var p=cubeLimit-l,g=d-p;if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${n}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>     \n          <div class="detach-btn"></div>\n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical");for(var m=0;m<p;m++)dragParent.querySelector('[data-index="'+(d-1-m)+'"].cube-outer').remove()}else if("horizontal"==snapType){cubeOuter="";for(v=0;v<p;v++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${l+v}" data-seal-type="${t}">`;for(u=0;u<a;u++)cubeOuter+=`<div class="cube"><img src="${n}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+="</div>"}if(initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent,1==g){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${n}" style="width: ${i}px; height: ${o}px;"></div>\n          `;cubeOuter+='\n            </div> \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n            <div class="detach-btn"></div>\n          ',initMove.dragParent.innerHTML=cubeOuter,dragParent=initMove.dragParent,initMove.init(dragParent,"add"),dragParent.classList.remove("horizontal")}else for(m=0;m<p;m++)dragParent.querySelector('[data-index="'+(d-1-m)+'"].cube-outer').remove()}initMove.init(dropParent,"add"),dragParent.style.left=s,dragParent.style.top=dragParentTop,initMove.init(dragParent,"add"),dragParent.classList.add("cant-snap"),console.log("limit reached!!!!!!!!!!")}dragParent.addEventListener(e,function t(){dragParent.removeEventListener(e,t);dragParent.classList.remove("cant-snap")}),dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight")},o=function(e){var t,r=dragParent.style.left,s=dragParent.style.top,i=parseFloat(r),d=parseFloat(s),c=dragParent.querySelector(".drag-area").getBoundingClientRect().height,u=dragParent.querySelector(".drag-area").getBoundingClientRect().width,v=dragParent.dataset.sealType,p=dragParent.querySelector("img").src,g=dragParent.querySelector("img").width,m=dragParent.querySelector("img").height;if(e.target.classList.contains("detach-btn"))if("vertical"==n){if((h=dragParent.querySelectorAll(".drag-area").length)==a)dragParent.querySelector(".cube-outer").remove(),dragParent.classList.remove("detach"),dragParent.classList.remove("vertical"),t=`\n            <div class="cube-outer drag-area" data-index="0" data-seal-type="${v}">\n            <div class="cube"><img src="${p}" style="width: ${g}px; height: ${m}px;"></div>  \n          `,dragParent.innerHTML+=t,initMove.init(dragParent,"add"),dragParent.addEventListener("dblclick",l,!1);else for(var y=1;y<h;y++)dragParent.querySelector('[data-index="'+y+'"]').remove(),dragParent.classList.remove("detach"),dragParent.classList.remove("vertical");for(y=1;y<h;y++){(L=document.createElement("div")).classList.add("draggable-cubes"),L.classList.add("draggable"),L.setAttribute("data-id",++initDrag.draggablesId),L.setAttribute("data-seal-type",v),L.style.left=i+"px",L.style.top=parseFloat(s)+c*y+30*y+"px",L.style.zIndex=++initMove.dragParentzIndex,"numbers"==v&&(L.setAttribute("data-number-design",dragParent.dataset.numberDesign),L.setAttribute("data-number-value",dragParent.dataset.numberValue)),t=`\n            <div class="cube-outer drag-area" data-index="0" data-seal-type="${v}">\n            <div class="cube"><img src="${p}" style="width: ${g}px; height: ${m}px;"></div>\n            </div>        \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n            <div class="detach-btn"></div>     \n          `,L.innerHTML=t,cvOuter.appendChild(L),initMove.init(L,"add"),L.addEventListener("dblclick",l,!1),L.addEventListener("click",o,!1)}}else{for(var h=dragParent.querySelectorAll(".drag-area").length,b=0;b<h;b++)dragParent.querySelector('[data-index="'+b+'"]').remove();dragParent.classList.remove("detach"),dragParent.classList.add("vertical"),dragParent.classList.remove("complete"),dragParent.classList.remove("horizontal"),t='<div class="cube-outer">';for(var f=0;f<a;f++)t+=`<div class="cube drag-area" data-index="${f}" data-seal-type="${v}"><img src="${p}" style="width: ${g}px; height: ${m}px;"></div>`;t+="</div>",dragParent.innerHTML+=t,initMove.init(dragParent,"add"),dragParent.addEventListener("dblclick",l,!1);for(y=1;y<h;y++){var L;(L=document.createElement("div")).classList.add("draggable-cubes"),L.classList.add("draggable"),L.setAttribute("data-id",++initDrag.draggablesId),L.setAttribute("data-seal-type",v),L.style.left=parseFloat(r)+u*y+30*y+"px",L.style.top=d+"px",L.style.zIndex=++initMove.dragParentzIndex,t='<div class="cube-outer">';for(f=0;f<a;f++)t+=`<div class="cube drag-area" data-index="${f}" data-seal-type="${v}"><img src="${p}" style="width: ${g}px; height: ${m}px;"></div>`;t+='\n          </div>        \n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>     \n          <div class="detach-btn"></div>     \n          ',L.innerHTML=t,cvOuter.appendChild(L),L.classList.add("vertical"),initMove.init(L,"add"),L.addEventListener("dblclick",l,!1),L.addEventListener("click",o,!1)}}else dragParent.querySelectorAll(".drag-area").length>1&&(initMove.mousemove||(dragParent.classList.contains("detach")?dragParent.classList.remove("detach"):dragParent.classList.add("detach")))},l=function(e){e.target.closest(".draggable").remove()};return{isSnapping:!1,snapDist:40,shortestDist:shortestDist,getCoords:function(){dragParent=initMove.dragParent,snapType=dragParent.classList.contains("vertical")?"horizontal":"vertical",n=dragParent.classList.contains("horizontal")?"horizontal":"vertical",t={};var e=dropDotCoord_1=null,a=document.querySelectorAll(".draggable-cubes");for(let s=0;s<a.length;s++)if(a[s]!=dragParent){"vertical"==snapType?(e=a[s].querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=a[s].querySelector(".dot-bottom").getBoundingClientRect()):(e=a[s].querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=a[s].querySelector(".dot-right").getBoundingClientRect());var r=a[s].dataset.id,i={0:{x:e.x,y:e.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}};t[r]=i}s=dragParent.style.left,dragParentTop=dragParent.style.top},getShortestDist:function(){var e=null;console.log(snapType,dragParent,dropParent),{i:0,j:0,id:""},"vertical"==snapType?(dropDotCoord_0=dragParent.querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-bottom").getBoundingClientRect()):(dropDotCoord_0=dragParent.querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-right").getBoundingClientRect());for(var a={0:{x:dropDotCoord_0.x,y:dropDotCoord_0.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}},r=0;r<1;r++)for(var s in t){var n=0==r?1:0;if(t.hasOwnProperty(s)){var i=a[r].x,o=a[r].y,l=i-t[s][n].x,d=o-t[s][n].y,c=parseFloat(Math.sqrt(l*l+d*d).toFixed(2));(null==e||e>c)&&(e=c,{i:0==r?0:1,j:0==n?0:1,id:s},initCubes.shortestDist=e,dropParent=initMove.dropParent=document.querySelector('[data-id="'+s+'"'),"vertical"==snapType&&dropParent.classList.contains("horizontal")&&(initCubes.shortestDist=null),"horizontal"==snapType&&(dragParent.classList.contains("vertical")&&dropParent.classList.contains("vertical")||(initCubes.shortestDist=null)))}}dropParent&&("cubes"==dragParent.dataset.sealType?dragParent.dataset.sealType!=dropParent.dataset.sealType&&(initCubes.shortestDist=null):"numbers"==dragParent.dataset.sealType&&(dragParent.dataset.numberDesign==dropParent.dataset.numberDesign&&dragParent.dataset.numberValue==dropParent.dataset.numberValue||(initCubes.shortestDist=null)),"10000"==dragParent.dataset.numberValue&&(initCubes.shortestDist=null))},highlight:function(e){if(e){var t=document.querySelector(".draggable-cubes.highlight");t&&t.classList.remove("highlight"),dragParent.classList.add("highlight"),dropParent.classList.add("highlight")}else dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight")},snap:i,snap:i,detachUI:o,detachUI:o,remove:l,remove:l}}(),initRotate=function(){var e,t,a,r,s=mousemoveRotate=!1,n=null,i=null,o=null,l=null,c=!1,u=null,v=null,p=null,g=0,m=null,y={x:0,y:0},h=180/Math.PI,b=function(e){s=mousemoveRotate=!1,cvOuter.classList.remove("pe-none"),initTools.currToolType=m,cvOuter.removeEventListener("mousemove",f,!1),cvOuter.removeEventListener("mouseup",b,!1)},f=function(l){s&&mousemoveRotate&&(l.preventDefault(),a=l.clientX-y.x,r=l.clientY-y.y,(g=Math.floor(h*Math.atan2(r,a)))<0&&(g=360-Math.abs(g)),(i=g-n)<0&&(i=360+g-Math.abs(n)),"clock"==p?u.style.transform="translateY(-50%) rotate("+d+"deg)":"compass"==p&&o.classList.contains("rotate-hand")?(isNaN(t)||(g-=t),o.classList.contains("rotate-pencil")?g>130?g=130:g<95&&(g=95):o.classList.contains("rotate-point"),e.classList.contains("flipped")&&(g=g<=180?180-g:360-g+180),u.style.transform="translateY(-50%) rotate("+g+"deg)"):u.style.transform="rotate("+i+"deg)"),mousemoveRotate=!0};return{start:function(i){var d,g,L,P,x;i.preventDefault(),s=!0,o=i.target,e=o.closest(".draggable"),p=e.dataset.panel,u=o.closest(".rotatable"),v!=e&&(n=null),v=e,x=u,"compass"==p&&(o.classList.contains("rotate-compass")?(o.classList.contains("rotate-compass-draw")&&(m=initTools.currToolType,initTools.currToolType="arc",cvOuter.classList.add("pe-none")),x=e.querySelector(".rotate-compass-ref")):o.classList.contains("rotate-hand")&&(x=e.querySelector(".rotate-hand-ref"))),refObj=x.getBoundingClientRect(),L=refObj.top,g=refObj.left,d=refObj.height,P=refObj.width,y={x:g+P/2,y:L+d/2},a=i.clientX-y.x,r=i.clientY-y.y,"compass"==p?(c=l!=o,l!=o&&(l=o),o.classList.contains("rotate-hand")||o.classList.contains("rotate-compass")&&(o.classList.contains("rotate-compass-only")?void 0==e.dataset.angleCompassOnly||c?((n=Math.floor(h*Math.atan2(r,a)))<0&&(n=360-Math.abs(n)),e.setAttribute("data-angle-compass-only",n)):n=e.dataset.angleCompassOnly:o.classList.contains("rotate-compass-draw")&&(void 0==e.dataset.angleCompassDraw||c?((n=Math.floor(h*Math.atan2(r,a)))<0&&(n=360-Math.abs(n)),e.setAttribute("data-angle-compass-draw",n)):n=e.dataset.angleCompassDraw)),n=parseFloat(n),t=(t=e.style.transform.substr(7)).substring(0,t.length-4),t=parseFloat(t),c&&!isNaN(t)&&(n-=t,n%=360,o.classList.contains("rotate-compass-only")?e.setAttribute("data-angle-compass-only",n):o.classList.contains("rotate-compass-draw")&&e.setAttribute("data-angle-compass-draw",n))):void 0==e.dataset.angle?((n=Math.floor(h*Math.atan2(r,a)))<0&&(n=360-Math.abs(n)),e.setAttribute("data-angle",n)):n=e.dataset.angle,cvOuter.addEventListener("mousemove",f,!1),cvOuter.addEventListener("mouseup",b,!1)}}}(),initScale=function(e){var t,a,r=document.querySelector('[data-panel="protractor"]'),s=null,n=null,i=null,o=null,l=function(e){e.preventDefault(),a=math.getMousePosition(e,cv),i=a.x-t.x,console.log(s,i,o,s+i,s*o),o>1&&(r.style.width=s+i+"px",r.style.height=n+i*o+"px")},d=function(e){cvOuter.removeEventListener("mousemove",l,!1),cvOuter.removeEventListener("mouseup",d,!1)};return{start:function(e){s=r.getBoundingClientRect().width,n=r.getBoundingClientRect().height,o=s/n,t=math.getMousePosition(e,cv),cvOuter.addEventListener("mousemove",l,!1),cvOuter.addEventListener("mouseup",d,!1)}}}(),initCalc=function(e){var num="",calculate=function(e){var result=document.querySelector('[data-panel="calculator"] #result'),buttonType=e.target.closest("g[data-button-type]").dataset.buttonType,buttonValue=e.target.closest("g[data-button-type]").dataset.buttonValue;if("num"==buttonType)num+=buttonValue,result.innerHTML=num;else if("func"==buttonType){switch(buttonValue){case"=":num=eval(num).toString();break;case"<-":num=num.slice(0,-1);break;case"c":case"ac":num="";break;case"*":case"/":case"+":case"-":num+=" "+buttonValue+" "}result.innerHTML=num}};return{calculate:calculate}}(),initAbacus=function(){var e=document.querySelector('[data-panel="abacus"]'),t=function(e){var t=e.target.closest(".bead");if(t)if("up"==t.dataset.layer)t.setAttribute("transform","translate(0, 0)"),t.dataset.state="down";else for(var a=t.parentNode.querySelectorAll(".bead"),r=a.length,s=(t.dataset.pos,0);s<r;s++)a[s].setAttribute("transform","translate(0, 0)"),a[s].dataset.state="down"},a=function(r){e.removeEventListener("mousemove",t,!1),cvOuter.removeEventListener("mouseup",a,!1),cvOuter.removeEventListener("mouseleave",a,!1)};return{changePos:function(){var e=this.dataset.layer,t=this.dataset.state;if("up"==e)"down"==t?(this.setAttribute("transform","translate(0, -20)"),this.dataset.state="up"):(this.setAttribute("transform","translate(0, 0)"),this.dataset.state="down");else{var a=this.parentNode.querySelectorAll(".bead"),r=this.dataset.pos;if("down"==t)for(var s=0;s<=r;s++)a[s].setAttribute("transform","translate(0,-43)"),a[s].dataset.state="up";else{var n=a.length;for(s=r;s<n;s++)a[s].setAttribute("transform","translate(0, 0)"),a[s].dataset.state="down"}}},resetStart:function(r){e.addEventListener("mousemove",t,!1),cvOuter.addEventListener("mouseup",a,!1),cvOuter.addEventListener("mouseleave",a,!1)}}}(),math=function(e){var t=0,a=!1,r=function(e){return{left:e.getBoundingClientRect().left,right:e.getBoundingClientRect().top}},s=function(e){var t=(e.p2.y-e.p1.y)/(e.p2.x-e.p1.x);return math.parseToFloat(t,2)},n=function(e,t,a){return a==1/0||a==-1/0?Math.abs(e.p1.x-t.x):Math.abs((a*t.x-t.y+e.p1.y-a*e.p1.x)/Math.sqrt(1+a*a))};return{parseToFloat:function(e,t){return parseFloat(e.toFixed(t))},getMousePosition:function(e,t){var a=r(t),s={x:0,y:0};return s.x=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientX:e.clientX)-a.left).toFixed(2)),s.y=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientY:e.clientY)-a.right).toFixed(2)),s},sideAndRange:function(e){var r,i=function(e){var t={},a=math.getSetPoints(initTools.currSetType),r=Object.size(a);for(let e=1;e<=r;e++){var s=e==r?1:e+1,n={p1:a[e],p2:a[s]};t["l"+e+s]=n}return t}(),o=(e.x-i.l12.p1.x)*(i.l12.p2.y-i.l12.p1.y)-(e.y-i.l12.p1.y)*(i.l12.p2.x-i.l12.p1.x),l=(e.x-i.l34.p1.x)*(i.l34.p2.y-i.l34.p1.y)-(e.y-i.l34.p1.y)*(i.l34.p2.x-i.l34.p1.x),d=(e.x-i.l23.p1.x)*(i.l23.p2.y-i.l23.p1.y)-(e.y-i.l23.p1.y)*(i.l23.p2.x-i.l23.p1.x),c=(e.x-i.l41.p1.x)*(i.l41.p2.y-i.l41.p1.y)-(e.y-i.l41.p1.y)*(i.l41.p2.x-i.l41.p1.x),u="";if(o<0&&l<0||o>0&&l>0||d<0&&c<0||d>0&&c>0){if("12_34"==(o<0&&l<0||o>0&&l>0?"12_34":"23_41")){t=s(i.l23);var v=n(i.l23,e,t),p=n(i.l41,e,t);v<p?(r=v,nearestLine=i.l23,u=2,startPoint=e):(r=p,nearestLine=i.l41,u=4)}else{t=s(i.l12);var g=n(i.l12,e,t),m=n(i.l34,e,t);g<m?(r=g,nearestLine=i.l12,u=1):(r=m,nearestLine=i.l34,u=3)}a=50>=r&&(1==u||3==u)}else a=!1;return{inRange:a,side:u,slope:t,slope:t}},getSetPoints:function(e){var t={},a=document.querySelector('[data-panel="'+e+'"]').querySelectorAll(".point"),s=r(cv);for(let e=0;e<a.length;e++){var n={x:"",y:""},i=s.left,o=s.right,l=a[e].getBoundingClientRect().left,d=a[e].getBoundingClientRect().top,c=a[e].getBoundingClientRect().width,u=a[e].getBoundingClientRect().height;n.x=parseFloat((l+c/2-i).toFixed(2)),n.y=parseFloat((d+u/2-o).toFixed(2)),t[e+1]=n}return t},getCoords:function(e,t,a,r){var s,n,i=initDraw.strokeWidth/2;return 0==r?(i=1==t?e[1].x<e[3].x?-i:i:e[1].x<e[3].x?i:-i,s=a.x,n=e[t].y+i):r==1/0||r==-1/0?(i=1==t?e[1].x<e[3].x?-i:i:e[1].x<e[3].x?i:-i,s=e[t].x+i,n=a.y):(x1=(a.x/r+r*e[t].x+a.y-e[t].y)/(r+1/r),y1=r*(x1-e[t].x)+e[t].y,r=-1/r,e[1].x>e[4].x?(1==t?s=x1+Math.sqrt(i*i/(1+r*r)):3==t&&(s=x1-Math.sqrt(i*i/(1+r*r))),n=r*(s-x1)+y1):(1==t?s=x1-Math.sqrt(i*i/(1+r*r)):3==t&&(s=x1+Math.sqrt(i*i/(1+r*r))),n=r*(s-x1)+y1)),{x:s,y:n}}}}();
//# sourceMappingURL=script.min.js.map
