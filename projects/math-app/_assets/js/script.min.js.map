{"version":3,"sources":["script.js"],"names":["cv","document","getElementById","cvOuter","whichTransitionEvent","t","el","createElement","transitions","transition","OTransition","MozTransition","WebkitTransition","undefined","style","getElPosition","left","getBoundingClientRect","right","top","getMousePosition","e","pos","point","x","y","parseFloat","type","touches","clientX","toFixed","clientY","Object","size","obj","key","hasOwnProperty","initTools","toolsUniverse","toolsPlanets","querySelectorAll","toolsPlanetSets","toolsPlanetPens","minimizeToggleBtn","offsetWidth","toolsPlanetSetsBtn","toolsPlanetPensBtn","currToolType","currSetType","forEach","toolsPlanet","toolsSatellites","id","toolsSatellitesWidth","querySelector","toolsPlanetWidth","totalOffset","length","toolsSatellite","i","n","Math","round","cos","PI","sin","classList","contains","toolGroupType","dataset","rotation","radius","toString","add","updateToolType1","target","oldToolBtn","remove","removeEventListener","initDraw","drawStart","toolType1","addEventListener","updateToolType2","strokeColor","value","updateToolsGroup","isPrimary","isSecondary","parent","substr","setAttribute","strokeOpacity","strokeWidth","src","getAttribute","toolType2","ispanelBtn","panelBtn","undo","redo","clear","initPanel","toggle","startPoint","polyline","points","m","strokeOpacityEl","strokeWidthEl","currId","index","currPoint","undoStack","redoStack","inRangeObj","inStartedInRange","pointsObj","targetPoint","draw","preventDefault","math","sideAndRange","inRange","getCoords","side","drawEnd","push","Elements","Id","Action","ele","lastAction","pop","parentNode","removeChild","appendChild","shape","clearedEles","innerHTML","polylineTag","strokeColorPen","strokeWidthPen","strokeWidthMarker","getSetPoints","slope","initMove","startX","startY","endX","endY","dragParent","dropParent","oldDragParent","init","draggable","listener","dragAreas","dragArea","start","closest","zIndex","dragParentzIndex","panelSet","panel","initCubes","move","end","initDrag","sealType","trashPanel","offsetLeft","offsetBottom","height","offsetTop","bottom","getShortestDist","shortestDist","snapDist","highlight","snap","dragEloffsetX","dragEloffsetY","enter","leave","over","drop","dataTransfer","getData","width","numberDesign","numberValue","totalSealsAllowed","sealTypes","detachUI","draggablesId","offsetX","offsetY","dropElHeight","alert","setData","fetchSeals","sealPanelContent","values","numType","numValue","oldPanel","panelType","panelPosObj","panelCloseBtn","panelScaleBtn","draggableSeals","rotateBtns","close","this","getElementsByClassName","initRotate","initScale","buttons","initCalc","calculate","bringInFront","console","log","mode","mousePosObj","panelPos","x1","x2","y1","y2","dropCoords","row","col","dragParentLeft","dragParentTop","snapType","cubeLimit","cubeOuter","detachType","transitionEvent","dropParentCubeCount","dragParentCubeCount","totalCubes","r","c","canBeAddedCubes","remainingCubes","transitionEndCallback","cubeHeight","cubesToDetach","isSnapping","dropDotCoord_0","dropDotCoord_1","draggableCubes","dropCoord","0","1","j","dragCoord","d","sqrt","flag","startAngle","rotateBtn","rotatable","refPoint","R2D","rotate","floor","atan2","transform","refEl","refObj","angleHand","angle","angleCompass","scale","num","result","buttonType","buttonValue","eval","slice","initAbacus","window","onload","mousedown","body","upper_part","a","evt","background","bind","event","lower_part","column_id","boxes","till","state","getSlope","line","p2","p1","calculatePerpendicularDistFromLine","Infinity","abs","perpendicularDist","lines","pointsLength","getLines","check12","l12","check34","l34","check23","l23","check41","l41","d23","d41","nearestLine","d12","d34","pointsEl","canvasPosition","pointObj","cvLeft","cvTop","pointLeft","pointTop","pointWidth","pointHeight","s","click"],"mappings":"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","sourcesContent":["/*******************************/\r\n//     HTML elements\r\n/*******************************/\r\nvar cv = document.getElementById('cv');\r\nvar cvOuter = document.getElementById('cvOuter');\r\n\r\n/*******************************/\r\n//     functions - helping\r\n/*******************************/\r\n// returns object length\r\nObject.size = function (obj) {\r\n  var size = 0, key;\r\n  for (key in obj) {\r\n    if (obj.hasOwnProperty(key)) size++;\r\n  }\r\n  return size;\r\n};\r\n\r\nfunction whichTransitionEvent() {\r\n  var t,\r\n    el = document.createElement(\"fakeelement\");\r\n\r\n  var transitions = {\r\n    \"transition\": \"transitionend\",\r\n    \"OTransition\": \"oTransitionEnd\",\r\n    \"MozTransition\": \"transitionend\",\r\n    \"WebkitTransition\": \"webkitTransitionEnd\"\r\n  }\r\n\r\n  for (t in transitions) {\r\n    if (el.style[t] !== undefined) {\r\n      return transitions[t];\r\n    }\r\n  }\r\n}\r\n\r\n// returns 'left' and 'right' position of given element\r\nfunction getElPosition(el) {\r\n  var pos = { left: el.getBoundingClientRect().left, right: el.getBoundingClientRect().top };\r\n  return pos;\r\n}\r\n\r\n// returns the mouse position w.r.t given element\r\nfunction getMousePosition(e, el) {\r\n  var pos = getElPosition(el);\r\n  var point = { x: 0, y: 0 };\r\n  point.x = parseFloat((((e.type == 'touchstart' || e.type == 'touchmove') ? e.touches[0].clientX : e.clientX) - pos.left).toFixed(2));\r\n  point.y = parseFloat((((e.type == 'touchstart' || e.type == 'touchmove') ? e.touches[0].clientY : e.clientY) - pos.right).toFixed(2));\r\n  return point;\r\n}\r\n\r\n/*******************************/\r\n//     functions - specific\r\n/*******************************/\r\n// init tools satellite UI and and tool events\r\nvar initTools = (function () {\r\n  // console.log('init')\r\n  var toolsUniverse = document.getElementById('toolsUniverse');\r\n  var toolsPlanets = toolsUniverse.querySelectorAll('.tools-planet');\r\n  var toolsPlanetSets = document.getElementById('toolsPlanetSets');\r\n  var toolsPlanetPens = document.getElementById('toolsPlanetPens');\r\n  var toolsUniverseWidth = toolsUniverse.offsetWidth;\r\n\r\n  var minimizeToggleBtn = document.getElementById('minimizeToggleBtn');\r\n  var toolsPlanetSetsBtn = document.getElementById('toolsPlanetSetsBtn');\r\n  var toolsPlanetPensBtn = document.getElementById('toolsPlanetPensBtn');\r\n\r\n  var currToolType = currSetType = null;\r\n\r\n  // draw satellite circles\r\n  toolsPlanets.forEach(function (toolsPlanet) {\r\n    var toolsSatellites = toolsPlanet.querySelectorAll('#' + toolsPlanet.id + '>.tools-satellite.primary');\r\n    var toolsSatellitesWidth = toolsPlanet.querySelector('.tools-satellite:first-child').offsetWidth;\r\n    var toolsPlanetWidth = toolsPlanet.offsetWidth;\r\n    var totaltoolsSatellites = toolsSatellites.length;\r\n    // var rotation = 360 / totaltoolsSatellites;\r\n    var rotation = 30;\r\n    // var radius = (toolsUniverseWidth - toolsSatellitesWidth) / 2;\r\n    var radius = 110;\r\n    var totalOffset = (toolsPlanetWidth - toolsSatellitesWidth) / 2;\r\n    // var totalOffset = 60;\r\n\r\n    toolsSatellites.forEach(function (toolsSatellite, i) { // place primary tools\r\n      var n = i - 3; // to start from top side instead of rigth side\r\n      var x = Math.round(Math.cos((rotation * n) * (Math.PI / 180)) * radius);\r\n      var y = Math.round(Math.sin((rotation * n) * (Math.PI / 180)) * radius);\r\n      var left = Math.round(x + totalOffset);\r\n      var top = Math.round(y + totalOffset);\r\n      toolsSatellite.style.left = left + \"px\";\r\n      toolsSatellite.style.top = top + \"px\";\r\n\r\n      if (toolsSatellite.classList.contains('has-child')) { // place secondary tools if any\r\n        let toolGroupType = toolsSatellite.dataset.toolGroupType;\r\n        let toolsSatellites = toolsPlanet.querySelectorAll('[data-tool-group-type=\"' + toolGroupType + '\"].secondary');\r\n        let rotation = 19;\r\n        let radius = 165;\r\n\r\n        toolsSatellites.forEach(function (toolsSatellite, i) {\r\n          let n = i - 4.5;\r\n\r\n          switch (toolGroupType) {\r\n            case \"pastel1\": n = i + .7;\r\n              break;\r\n            case \"pastel2\": n = i + 2.2;\r\n              break;\r\n            case \"stroke\": n = i + 3.8;\r\n              break;\r\n            case \"opacity\": n = i + 5.2;\r\n              break;\r\n            case \"scale\": n = i - 4.5;\r\n              break;\r\n          }\r\n\r\n          let y = Math.sin((rotation * n) * (Math.PI / 180)) * radius;\r\n          let x = Math.cos((rotation * n) * (Math.PI / 180)) * radius;\r\n          toolsSatellite.style.top = (y + totalOffset).toString() + \"px\";\r\n          toolsSatellite.style.left = (x + totalOffset).toString() + \"px\";\r\n        })\r\n      }\r\n    });\r\n  });\r\n  // add 'active' class to one of the 'tools-planet'\r\n  toolsPlanetSets.classList.add('active');\r\n  toolsPlanetSetsBtn.classList.add('active');\r\n  toolsPlanetSetsBtn.classList.add('temp-active');\r\n\r\n  var clickHandler = function (e) {\r\n    // console.log(e.target.dataset);\r\n\r\n    var target = e.target;\r\n    var id = target.id;\r\n    var toolType1 = target.dataset.toolType1; // pen, marker, eraser\r\n    var toolType2 = target.dataset.toolType2; // pastels 1-4\r\n    var toolGroupType = target.dataset.toolGroupType;\r\n    var isPrimary = target.classList.contains('primary');\r\n    var isSecondary = target.classList.contains('secondary');\r\n    var ispanelBtn = target.dataset.panelBtn;\r\n\r\n    if (id == \"minimizeToggleBtn\") {\r\n      if (document.querySelector('.tools-planet.active')) {\r\n        minimizeToggleBtn.classList.add('active');\r\n        toolsUniverse.classList.remove('active');\r\n        toolsPlanetSetsBtn.classList.remove('active');\r\n        toolsPlanetPensBtn.classList.remove('active');\r\n        document.querySelector('.tools-planet.active').classList.add('temp-active');\r\n        document.querySelector('.tools-planet.active').classList.remove('active');\r\n      } else {\r\n        toolsUniverse.classList.add('active');\r\n        minimizeToggleBtn.classList.remove('active');\r\n        document.querySelector('.tools-toggle .temp-active').classList.add('active');\r\n        document.querySelector('.tools-planet.temp-active').classList.add('active');\r\n        document.querySelector('.tools-planet.temp-active').classList.remove('temp-active');\r\n      }\r\n    } else if (id == \"toolsPlanetPensBtn\") {\r\n      toolsPlanetSetsBtn.classList.remove('active');\r\n      toolsPlanetSetsBtn.classList.remove('temp-active');\r\n      toolsPlanetSets.classList.remove('active');\r\n\r\n      toolsPlanetPensBtn.classList.add('active');\r\n      toolsPlanetPensBtn.classList.add('temp-active');\r\n      toolsPlanetPens.classList.add('active');\r\n      toolsUniverse.classList.add('active');\r\n\r\n      minimizeToggleBtn.classList.remove('active');\r\n    } else if (id == \"toolsPlanetSetsBtn\") {\r\n      toolsPlanetPensBtn.classList.remove('active');\r\n      toolsPlanetPensBtn.classList.remove('temp-active');\r\n      toolsPlanetPens.classList.remove('active');\r\n\r\n      toolsPlanetSetsBtn.classList.add('active');\r\n      toolsPlanetSetsBtn.classList.add('temp-active');\r\n      toolsPlanetSets.classList.add('active');\r\n      toolsUniverse.classList.add('active');\r\n\r\n      minimizeToggleBtn.classList.remove('active');\r\n    } else if (id == 'undo') {\r\n      initDraw.undo();\r\n    } else if (id == 'redo') {\r\n      initDraw.redo();\r\n    } else if (id == 'clear') {\r\n      initDraw.clear();\r\n    } else if (toolType1) {\r\n      updateToolType1(target);\r\n    } else if (toolType2) {\r\n      updateToolType2(target);\r\n    } else if (ispanelBtn) {\r\n      initPanel.toggle(target);\r\n    }\r\n    if (toolGroupType) {\r\n      updateToolsGroup(toolGroupType, target, isPrimary, isSecondary);\r\n    }\r\n  }\r\n\r\n  // // pen, marker, eraser\r\n  var updateToolType1 = function (target) {\r\n    // console.log('updateToolType1');\r\n\r\n    // remove 'active' class from previous 'active' button\r\n    // and make 'currToolType' null\r\n    var oldToolBtn = document.querySelector('#toolsPlanetPens [data-tool-type1].active');\r\n    if (oldToolBtn) {\r\n      oldToolBtn.classList.remove('active');\r\n      initTools.currToolType = null;\r\n      cv.removeEventListener('mousedown', initDraw.drawStart, false);\r\n    }\r\n    // add 'active' class to current 'clicked' button if it is not the 'active' button already\r\n    // and update 'currToolType' value\r\n    if (oldToolBtn != target) {\r\n      target.classList.add('active');\r\n      initTools.currToolType = target.dataset.toolType1;\r\n      cv.addEventListener('mousedown', initDraw.drawStart, false);\r\n    }\r\n  }\r\n\r\n  // four pastels buttons\r\n  var updateToolType2 = function (target) {\r\n    // console.log('updateToolType2')\r\n\r\n    // remove 'active' class from previous 'active' button\r\n    var oldToolBtn = document.querySelector('#toolsPlanetPens [data-tool-type2].active');\r\n    if (oldToolBtn && oldToolBtn != target) {\r\n      oldToolBtn.classList.remove('active');\r\n      target.classList.add('active');\r\n    }\r\n\r\n    initDraw.strokeColor = target.dataset.value;\r\n  }\r\n\r\n  // handling of satellite buttons which has childrens\r\n  var updateToolsGroup = function (toolGroupType, target, isPrimary, isSecondary) {\r\n    // console.log('updateToolsGroup');\r\n\r\n    if (isPrimary) {\r\n      // console.log('isPrimary')\r\n\r\n      // remove 'show-child' class if present\r\n      if (target.classList.contains('show-child')) {\r\n        target.classList.remove('show-child')\r\n      } else { // add 'show-child' on clicked element before that remove from other element if present\r\n        if (document.querySelector('.has-child.show-child')) {\r\n          document.querySelector('.has-child.show-child').classList.remove('show-child');\r\n        }\r\n        target.classList.add('show-child');\r\n      }\r\n    } else if (isSecondary) {\r\n      // console.log('isSecondary');\r\n\r\n      var parent = document.querySelector('[data-tool-group-type=\"' + toolGroupType + '\"].primary');\r\n      var oldToolBtn = document.querySelector('[data-tool-group-type=\"' + toolGroupType + '\"].secondary.active');\r\n\r\n      // make pastel group behave like first two pastel buttons\r\n      if (toolGroupType.substr(0, 6) == 'pastel') {\r\n        document.querySelector('[data-tool-type2].primary.active').classList.remove('active');\r\n        parent.setAttribute('data-tool-type2', 'pastel');\r\n        toolGroupType = \"pastel\";\r\n      }\r\n\r\n      // remove 'active' class from old child having 'active' class\r\n      if (oldToolBtn && toolGroupType != 'scale') {\r\n        oldToolBtn.classList.remove('active');\r\n      }\r\n\r\n      if(toolGroupType == 'scale') {\r\n        var scaleSecButtons = document.querySelectorAll('[data-tool-group-type=\"scale\"].secondary.active');\r\n        if(scaleSecButtons.length > 0) {\r\n          parent.classList.add('active');\r\n        } else {\r\n          parent.classList.remove('active');\r\n        }\r\n      } else {\r\n        target.classList.add('active');\r\n        parent.classList.add('active');\r\n      }\r\n      parent.classList.remove('show-child');\r\n\r\n\r\n      switch (toolGroupType) {\r\n        case \"opacity\": initDraw.strokeOpacity = parseFloat(target.dataset.value);\r\n          break;\r\n        case \"stroke\": initDraw.strokeWidth = parseFloat(target.dataset.value);\r\n          break;\r\n        case \"pastel\":\r\n          var src = target.querySelector('img').getAttribute('src');\r\n          parent.querySelector('img').setAttribute('src', src);\r\n          parent.setAttribute('data-value', target.dataset.value)\r\n          initDraw.strokeColor = target.dataset.value;\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // click listener on tools\r\n  toolsUniverse.addEventListener('click', clickHandler, false);\r\n\r\n  return {\r\n    currToolType: currToolType,\r\n    currSetType: currSetType\r\n  }\r\n})();\r\n\r\n// draw, undo, redo, clear functions\r\nvar initDraw = (function () {\r\n  // console.log('initDraw');\r\n\r\n  // initial stroke properties from HTML elements\r\n  var strokeOpacityEl = document.querySelector('[data-tool-group-type=\"opacity\"].secondary.active');\r\n  var strokeOpacity = parseFloat(strokeOpacityEl.dataset.value);\r\n\r\n  var strokeWidthEl = document.querySelector('[data-tool-group-type=\"stroke\"].secondary.active');\r\n  var strokeWidth = parseFloat(strokeWidthEl.dataset.value);\r\n  // var strokeWidth = 50;\r\n\r\n  var strokeColorEl = document.querySelector('[data-tool-type2=\"pastel\"].primary.active');\r\n  var strokeColor = strokeColorEl.dataset.value;\r\n\r\n  var currId = null;\r\n  var index = 0;\r\n  var startPoint;\r\n  var currPoint = null;\r\n  var undoStack = [];\r\n  var redoStack = [];\r\n  var inRangeObj = false;\r\n  var inStartedInRange = false;\r\n  var pointsObj = null;\r\n  var currToolType, currSetType = null;\r\n  var polyline, points;\r\n  var m;\r\n  var targetPoint = null;\r\n\r\n\r\n  // Undo last action\r\n  var Undo = function () {\r\n    // console.log('undo');\r\n    if (undoStack.length > 0) {\r\n      var lastAction = undoStack.pop();\r\n      var ele, clearedEles;\r\n      switch (lastAction.Action) {\r\n        case 'draw':\r\n          ele = document.getElementById(lastAction.Id);\r\n          lastAction.Elements.push(ele);\r\n          ele.parentNode.removeChild(ele);\r\n          break;\r\n        case 'erase':\r\n          cv.appendChild(lastAction.Elements[0]);\r\n          break;\r\n        case 'clear':\r\n          clearedEles = lastAction.Elements;\r\n          clearedEles.forEach(function (shape) {\r\n            cv.appendChild(shape);\r\n            index++;\r\n          });\r\n          break;\r\n      }\r\n      redoStack.push(lastAction);\r\n    }\r\n  }\r\n\r\n  // Redo last undoed action \r\n  var Redo = function () {\r\n    // console.log('redo');\r\n    if (redoStack.length > 0) {\r\n      var lastAction = redoStack.pop();\r\n      var ele;\r\n      switch (lastAction.Action) {\r\n        case 'draw':\r\n          ele = lastAction.Elements[0];\r\n          cv.appendChild(ele);\r\n          break;\r\n        case 'erase':\r\n          ele = lastAction.Elements[0];\r\n          ele.parentNode.removeChild(ele);\r\n          break;\r\n        case 'clear':\r\n          lastAction.Elements.forEach(function (ele) {\r\n            ele.parentNode.removeChild(ele);\r\n          });\r\n          break;\r\n      }\r\n      undoStack.push(lastAction);\r\n    }\r\n  }\r\n\r\n  // clears everything\r\n  var Clear = function () {\r\n    // console.log('clear')\r\n    index = 0;\r\n    var clearedEles = document.querySelectorAll('.drawing');\r\n    redoStack = [];\r\n    undoStack.push({\r\n      Elements: clearedEles,\r\n      Id: null,\r\n      Action: 'clear'\r\n    });\r\n    cv.innerHTML = \"\";\r\n  }\r\n\r\n  // start drawing or erasing\r\n  var drawStart = function (e) {\r\n    // console.log('drawStart')\r\n    e.preventDefault();\r\n\r\n    var strokeOpacity = initDraw.strokeOpacity;\r\n\r\n    var strokeColorPen = initDraw.strokeColor;\r\n    var strokeWidthPen = initDraw.strokeWidth;\r\n\r\n    var strokeColorMarker = 'rgba(0, 255, 0, .5)';\r\n    var strokeWidthMarker = initDraw.strokeWidth + 10;\r\n\r\n    var polylineTag;\r\n    \r\n    currPoint = getMousePosition(e, cv);\r\n    currId = 'shape' + index;\r\n    currToolType = initTools.currToolType;\r\n    currSetType = initTools.currSetType;\r\n\r\n    if(currSetType) {\r\n      pointsObj = math.getSetPoints(initTools.currSetType);\r\n  \r\n      // check if drawing point is inRange with currentSetType\r\n      inRangeObj = math.sideAndRange(currPoint);\r\n      inStartedInRange = inRangeObj.inRange;\r\n      m = inRangeObj.slope\r\n\r\n      // update starting coordinates of drawing if set is in range\r\n      if(inStartedInRange) {\r\n        targetPoint = math.getCoords(pointsObj, inRangeObj.side, currPoint, m);\r\n        currPoint.x = targetPoint.x;\r\n        currPoint.y = targetPoint.y;\r\n      }\r\n    }\r\n\r\n\r\n    if (currToolType == \"pen\" || currToolType == \"marker\") {\r\n      if (currToolType == \"pen\") {\r\n        polylineTag = '<polyline class=\"drawing\" id=\"' + currId + '\" style=\"opacity:' + strokeOpacity + ';fill:none;stroke-linecap:round;stroke:' + strokeColorPen + ';stroke-width:' + strokeWidthPen + '\" points=\"' + currPoint.x + ',' + currPoint.y + '\" />';;\r\n      } else if (currToolType == \"marker\") {\r\n        polylineTag = '<polyline class=\"drawing\" id=\"' + currId + '\" style=\"fill:none;stroke-linecap:round;stroke:' + strokeColorMarker + ';stroke-width:' + strokeWidthMarker + '\" points=\"' + currPoint.x + ',' + currPoint.y + '\" />';;\r\n      }\r\n      cv.innerHTML += polylineTag;\r\n    }\r\n\r\n    \r\n    cv.addEventListener('mousemove', draw, false);\r\n    cv.addEventListener('mouseup', drawEnd, false);\r\n    \r\n    index++;\r\n    startPoint = currPoint;\r\n\r\n  }\r\n\r\n  // keep drawing or erasing\r\n  var draw = function (e) {\r\n    // console.log('draw')\r\n    e.preventDefault();\r\n    \r\n    currPoint = getMousePosition(e, cv);\r\n\r\n    if (currToolType == \"pen\" || currToolType == \"marker\") {\r\n      polyline = document.getElementById(currId);\r\n      points = polyline.getAttribute('points');\r\n\r\n      if (currToolType == \"marker\") {\r\n        points = startPoint.x + ',' + startPoint.y + ' ' + currPoint.x + ',' + currPoint.y;\r\n      } else if (currToolType == \"pen\") {\r\n        if (inStartedInRange) { // if set is in range\r\n\r\n          // to check if cursor went outside of range\r\n          inRangeObj = math.sideAndRange(currPoint);\r\n          \r\n          if(inRangeObj.inRange) { // if drawing on some side \r\n            targetPoint = math.getCoords(pointsObj, inRangeObj.side, currPoint, m);\r\n\r\n            currPoint.x = targetPoint.x;\r\n            currPoint.y = targetPoint.y;\r\n            \r\n            points += ' ' + currPoint.x + ',' + currPoint.y;\r\n          } else { // else stop drawing\r\n            cv.removeEventListener('mousemove', draw, false);\r\n            cv.removeEventListener('mouseup', drawEnd, false);            \r\n          }\r\n        } else { // simple drawing\r\n          points += ' ' + currPoint.x + ',' + currPoint.y;\r\n        }\r\n      }\r\n      polyline.setAttribute('points', points);\r\n    } else if (currToolType == \"eraser\") {\r\n      var target = e.target;\r\n      if (target.classList.contains('drawing')) {\r\n        redoStack = [];\r\n        undoStack.push({\r\n          Elements: [target],\r\n          Id: target.id,\r\n          Action: 'erase'\r\n        });\r\n        target.remove();\r\n      }\r\n    }\r\n\r\n    cv.addEventListener('mouseleave', drawEnd, false);\r\n  }\r\n\r\n  // stop drawing or erasing\r\n  var drawEnd = function () {\r\n    // console.log('drawEnd')\r\n\r\n    if (currId !== null && document.getElementById(currId) != null) {\r\n      undoStack.push({\r\n        Elements: [],\r\n        Id: currId,\r\n        Action: 'draw'\r\n      });\r\n    }\r\n\r\n    cv.removeEventListener('mousemove', draw, false);\r\n    cv.removeEventListener('mouseup', drawEnd, false);\r\n    cv.removeEventListener('mouseleave', drawEnd, false);\r\n  }\r\n\r\n  return {\r\n    undo: Undo,\r\n    redo: Redo,\r\n    clear: Clear,\r\n    strokeOpacity: strokeOpacity,\r\n    strokeWidth: strokeWidth,\r\n    strokeColor: strokeColor,\r\n    drawStart: drawStart\r\n  }\r\n})();\r\n\r\n// move behaviour of elements - tools/panels/sets\r\nvar initMove = (function () {\r\n  var startX = 0, startY = 0, endX = 0, endY = 0;\r\n  var dragParentzIndex = 0; // update only if drag parent is different each dragging time\r\n  var dragParent = dropParent = oldDragParent = null;\r\n\r\n  var init = function (draggable, listener) {\r\n    // console.log('init drag')\r\n\r\n    var dragAreas = draggable.querySelectorAll('.drag-area');\r\n\r\n    if (listener == \"add\") { // ADD EVENT LISTENERS\r\n      // console.log('adding')\r\n\r\n\r\n      if (dragAreas.length > 0) { // if `dragArea` is available, use that to drag\r\n        // if(draggable.classList.contains('drag-area')) {\r\n        //   draggable.addEventListener('mousedown', start, false);\r\n        // }\r\n        dragAreas.forEach(function (dragArea) {\r\n          dragArea.addEventListener('mousedown', start, false);\r\n        })\r\n      } else { // otherwise move the element anywhere from with in element\r\n        draggable.addEventListener('mousedown', start, false);\r\n      }\r\n    } else if (listener == \"remove\") { // REMOVE EVENT LISTENERS\r\n      // console.log('removing')\r\n      if (dragAreas.length > 0) {\r\n        dragAreas.forEach(function (dragArea) {\r\n          dragArea.removeEventListener('mousedown', start, false);\r\n        })\r\n      } else {\r\n        draggable.removeEventListener('mousedown', start, false);\r\n      }\r\n    }\r\n  }\r\n\r\n  var start = function (e) {\r\n    // console.log('moveStart');\r\n\r\n    var currPoint = getMousePosition(e, cv);\r\n    initMove.dragParent = e.target.closest('.draggable');\r\n    var dragParent = initMove.dragParent;\r\n    // var oldDragParent = initMove.oldDragParent;\r\n\r\n    // drag only if current element has class 'drag-area'\r\n    if (e.target.classList.contains('drag-area')) {\r\n      // if(e.target.closest('.drag-area')) {\r\n\r\n      cvOuter.classList.add('dragging');\r\n\r\n      startX = currPoint.x;\r\n      startY = currPoint.y;\r\n\r\n      if (dragParent != initMove.oldDragParent) {\r\n        dragParent.style.zIndex = ++initMove.dragParentzIndex;\r\n      }\r\n      initMove.oldDragParent = initMove.dragParent;\r\n\r\n      // update current geometry set type\r\n      if (dragParent.dataset.panelSet) {\r\n        initTools.currSetType = dragParent.dataset.panel;\r\n      }\r\n\r\n      // get coordinates of nearby draggable cubes\r\n      if (dragParent.classList.contains('draggable-cubes')) {\r\n        initCubes.getCoords();\r\n      }\r\n\r\n      cvOuter.addEventListener('mousemove', move, false);\r\n      cvOuter.addEventListener('mouseup', end, false);\r\n      dragParent.addEventListener('dragstart', initDrag.start, false);\r\n    }\r\n\r\n    // bring TRASH can on top if sealType is present\r\n    if (dragParent.dataset.sealType) {\r\n      initPanel.trashPanel(e, 'start', dragParent.dataset.sealType);\r\n    }\r\n  }\r\n\r\n  var move = function (e) {\r\n    // console.log('move')\r\n    e.preventDefault();\r\n\r\n    var currPoint = getMousePosition(e, cv);\r\n    var dragParent = initMove.dragParent;\r\n\r\n    // calculate the new cursor position:\r\n    endX = startX - currPoint.x;\r\n    endY = startY - currPoint.y;\r\n    startX = currPoint.x;\r\n    startY = currPoint.y;\r\n\r\n    // set the element's new position:\r\n    dragParent.style.left = (dragParent.offsetLeft - endX) + \"px\";\r\n    if (dragParent == toolsUniverse) {\r\n      var H = cvOuter.getBoundingClientRect().height;\r\n      var h = dragParent.getBoundingClientRect().height;\r\n      var o = dragParent.offsetTop;\r\n      var offsetBottom = H - h - o;\r\n      dragParent.style.bottom = (offsetBottom + endY) + \"px\";\r\n    } else {\r\n      dragParent.style.top = (dragParent.offsetTop - endY) + \"px\";\r\n    }\r\n\r\n    // highligh if 'draggable-cube' is in range\r\n    if (dragParent.classList.contains('draggable-cubes')) {\r\n      // initCubes.isSnapping = true;\r\n      initCubes.getShortestDist();\r\n      // highlight groups accordingly\r\n      if (initCubes.shortestDist != null) {\r\n        if (initCubes.shortestDist < initCubes.snapDist) {\r\n          initCubes.highlight(true);\r\n        } else {\r\n          initCubes.highlight(false);\r\n        }\r\n      }\r\n    }\r\n\r\n    // highlight TRASH cubes if mouse is in\r\n    if (dragParent.dataset.sealType) {\r\n      initPanel.trashPanel(e, 'move');\r\n    }\r\n  }\r\n\r\n  var end = function (e) {\r\n    // console.log('moveEnd')\r\n    e.preventDefault();\r\n\r\n    var dragParent = initMove.dragParent;\r\n\r\n    cvOuter.classList.remove('dragging');\r\n\r\n    // snap cubes if in range\r\n    if (dragParent.classList.contains('draggable-cubes')) {\r\n      if (initCubes.shortestDist != null && initCubes.shortestDist < initCubes.snapDist) {\r\n        initCubes.snap();\r\n        initCubes.shortestDist = null;\r\n      }\r\n    }\r\n    // initCubes.isSnapping = false;\r\n\r\n    // delete dragParent if dropped on TRASH panel\r\n    if (dragParent.dataset.sealType) {\r\n      if (initPanel.trashPanel(e, 'end')) {\r\n        dragParent.remove();\r\n      }\r\n    }\r\n\r\n    // dragParent.classList.remove('detach');\r\n\r\n    cvOuter.removeEventListener('mousemove', move, false);\r\n    cvOuter.removeEventListener('mouseup', end, false);\r\n    dragParent.removeEventListener('dragstart', initDrag.start, false);\r\n  }\r\n\r\n  init(toolsUniverse, 'add');\r\n\r\n  return {\r\n    dragParentzIndex: dragParentzIndex,\r\n    dragParent: dragParent,\r\n    dropParent: dropParent,\r\n    oldDragParent: oldDragParent,\r\n    init: init\r\n  }\r\n})();\r\n\r\n// drag behaviour of seals - cubes/money/numbers/flowers\r\nvar initDrag = (function () {\r\n  var dragEloffsetX, dragEloffsetY;\r\n  var draggablesId = 0;\r\n  var dropElHeight = 0;\r\n  var dragParent = null;\r\n\r\n  var start = function (e) {\r\n    // console.log('dragStart');\r\n\r\n    dragEloffsetX = e.offsetX;\r\n    dragEloffsetY = e.offsetY;\r\n    e.dataTransfer.setData(\"src\", e.target.src);\r\n    e.dataTransfer.setData(\"width\", e.target.getBoundingClientRect().width);\r\n    e.dataTransfer.setData(\"height\", e.target.getBoundingClientRect().height);\r\n    e.dataTransfer.setData(\"sealType\", e.target.dataset.sealType);\r\n    if (e.target.dataset.numberDesign) {\r\n      e.dataTransfer.setData(\"sealDesign\", e.target.dataset.numberDesign);\r\n      e.dataTransfer.setData(\"sealValue\", e.target.dataset.numberValue);\r\n    }\r\n\r\n    cvOuter.addEventListener('dragenter', enter, false);\r\n    cvOuter.addEventListener('dragleave', leave, false);\r\n    cvOuter.addEventListener('dragover', over, false);\r\n    cvOuter.addEventListener('drop', drop, false);\r\n  }\r\n  var enter = function (e) { e.preventDefault(); }\r\n  var leave = function (e) { e.preventDefault(); }\r\n  var over = function (e) {\r\n    e.preventDefault();\r\n    cvOuter.classList.add('dropping');\r\n  }\r\n  var drop = function (e) {\r\n    // console.log('drop');\r\n    e.preventDefault();\r\n\r\n    var sealType = e.dataTransfer.getData('sealType');\r\n    var src = e.dataTransfer.getData('src');\r\n    var width = e.dataTransfer.getData('width');\r\n    var height = e.dataTransfer.getData('height');\r\n    var numberDesign = e.dataTransfer.getData(\"sealDesign\");\r\n    var numberValue = e.dataTransfer.getData(\"sealValue\");\r\n\r\n    cvOuter.classList.remove('dropping');\r\n\r\n    var totalSealsAllowed = sealTypes[sealType]['max'];\r\n    var totalSealsPlaced = document.querySelectorAll('[data-seal-type=\"' + sealType + '\"].dropped-seal').length;\r\n\r\n    if (totalSealsPlaced < totalSealsAllowed) {\r\n      var draggable;\r\n      if (sealType == \"cubes\" || sealType == \"numbers\") { // generate new draggable group\r\n        draggable = document.createElement('div');\r\n        draggable.classList.add('draggable-cubes');\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n        if (sealType == 'numbers') {\r\n          draggable.setAttribute('data-number-design', numberDesign);\r\n          draggable.setAttribute('data-number-value', numberValue);\r\n        }\r\n        draggable.innerHTML = `\r\n          <div class=\"cube-outer drag-area\" data-index=\"0\" data-seal-type=\"${sealType}\">\r\n            <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          </div>\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>\r\n          <div class=\"detach-btn\"></div>\r\n          `;\r\n\r\n        draggable.addEventListener('dblclick', initCubes.remove, false);\r\n        // draggable.addEventListener('click', initCubes.detach, false);\r\n        draggable.addEventListener('click', initCubes.detachUI, false);\r\n      } else { // generate a seal\r\n        draggable = document.createElement('img');\r\n        draggable.src = src;\r\n        draggable.width = width;\r\n        draggable.height = height;\r\n        draggable.classList.add('dropped-seal');\r\n        draggable.classList.add('drag-area');\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n\r\n        draggable.addEventListener('dblclick', (e) => { draggable.remove(); }, false);\r\n      }\r\n\r\n      draggable.setAttribute('data-id', ++initDrag.draggablesId);\r\n      draggable.style.zIndex = ++initMove.dragParentzIndex;\r\n      draggable.style.left = e.offsetX - dragEloffsetX + 'px';\r\n      draggable.style.top = e.offsetY - dragEloffsetY + 'px';\r\n      draggable.classList.add('draggable');\r\n\r\n      cvOuter.appendChild(draggable);\r\n\r\n      initDrag.dropElHeight = draggable.getBoundingClientRect().height;\r\n\r\n      initMove.init(draggable, 'add');\r\n\r\n      cvOuter.removeEventListener('dragenter', enter)\r\n      cvOuter.removeEventListener('dragleave', leave)\r\n      cvOuter.removeEventListener('dragover', over)\r\n      cvOuter.removeEventListener('drop', drop)\r\n    } else {\r\n      alert('You can only place max ' + totalSealsAllowed + ' of ' + sealType + ' seal type.');\r\n    }\r\n  }\r\n\r\n  return {\r\n    start: start,\r\n    draggablesId: draggablesId,\r\n    dropElHeight: dropElHeight\r\n  }\r\n})();\r\n\r\n// fetch seals from 'settings.json' file\r\nvar fetchSeals = (function () {\r\n  // console.log('fetching seals');\r\n\r\n  for (var sealType in sealTypes) {\r\n    var sealPanelContent = document.querySelector('[data-panel=\"' + sealType + '\"] .content');\r\n    if (sealTypes.hasOwnProperty(sealType)) {\r\n      var values = sealTypes[sealType].values;\r\n      if (sealType == \"numbers\") {\r\n        for (var type in values) {\r\n          // console.log(values[type])\r\n          for (var i = 0; i < values[type].length; i++) {\r\n            // console.log(values[type][i][0], values[type][i][1])\r\n            var numType = values[type][i][0];\r\n            var numValue = values[type][i][1];\r\n            var el = document.createElement('img');\r\n            el.classList.add('draggable-seal');\r\n            el.setAttribute('data-seal-type', sealType);\r\n            el.setAttribute('data-number-design', type);\r\n            el.setAttribute('data-number-value', numValue);\r\n            el.src = './_assets/img/' + numType;\r\n            sealPanelContent.appendChild(el);\r\n          }\r\n        }\r\n      } else {\r\n        values.forEach(value => {\r\n          var el = document.createElement('img');\r\n          el.classList.add('draggable-seal');\r\n          el.setAttribute('data-seal-type', sealType);\r\n          el.src = './_assets/img/' + value;\r\n          sealPanelContent.appendChild(el);\r\n        });\r\n      }\r\n    }\r\n  }\r\n})();\r\n\r\n// init panel functions - open/close/drag-panel/drag-seals\r\nvar initPanel = (function (e) {\r\n  var panel = oldPanel = panelType = panelBtn = panelPosObj =\r\n    panelCloseBtn = panelScaleBtn = draggableSeals = rotateBtns = null;\r\n\r\n  var toggle = function (target) {\r\n    panelType = target.dataset.panelBtn;\r\n\r\n    // open panel\r\n    if (!target.classList.contains('active')) {\r\n      // console.log('open panel');\r\n\r\n      panel = document.querySelector('[data-panel=\"' + panelType + '\"]');\r\n      panelCloseBtn = panel.querySelector('.close-btn');\r\n      panelScaleBtn = panel.querySelector('.scale-btn');\r\n      rotateBtns = panel.querySelectorAll('.rotate-btn');\r\n      draggableSeals = panel.getElementsByClassName('draggable-seal');\r\n\r\n      target.classList.add('active');\r\n      panel.classList.add('active');\r\n      panel.style.zIndex = ++initMove.dragParentzIndex;\r\n\r\n      initMove.dragParent = panel;\r\n      initMove.oldDragParent = panel;\r\n\r\n      // ADD EVENT LISTENERS\r\n      panelCloseBtn.addEventListener('click', close, false);\r\n      initMove.init(panel, 'add');\r\n      for (var i = 0; i < draggableSeals.length; i++) {\r\n        draggableSeals[i].addEventListener('dragstart', initDrag.start, false);\r\n      }\r\n      for (var i = 0; i < rotateBtns.length; i++) {\r\n        rotateBtns[i].addEventListener('mousedown', initRotate.start, false);\r\n      }\r\n      if (panelScaleBtn) {\r\n        panelScaleBtn.addEventListener('mousedown', initScale.start, false);\r\n      }\r\n      if (panelType == \"calculator\") {\r\n        var buttons = panel.querySelectorAll('[data-button-type]');\r\n        for (var i = 0; i < buttons.length; i++) {\r\n          buttons[i].addEventListener('click', initCalc.calculate, false);\r\n        }\r\n      }\r\n      if (panel.classList.contains('draggable-seal')) {\r\n        panel.addEventListener('click', bringInFront, false);\r\n      }\r\n\r\n\r\n      // update current geometry set type\r\n      if (panel.dataset.panelSet) {\r\n        initTools.currSetType = panel.dataset.panel;\r\n      }\r\n    } else { // close panel if already open\r\n      close(panelType);\r\n    }\r\n  }\r\n  var close = function (e) {\r\n    // console.log('close panel')\r\n\r\n    // clicked on closed button and 'type' property exist\r\n    if (e.type) {\r\n      panel = this.closest('.draggable');\r\n      panelType = panel.dataset.panel;\r\n    } else { // clicked on panel btn itself and called 'closePanel' function so 'e.type' not defined\r\n      panelType = e;\r\n      panel = document.querySelector('[data-panel=\"' + panelType + '\"]');;\r\n    }\r\n    panelBtn = document.querySelector('[data-panel-btn=\"' + panelType + '\"]');\r\n    panelCloseBtn = panel.querySelector('.close-btn');\r\n    panelScaleBtn = panel.querySelector('.scale-btn');\r\n\r\n    draggableSeals = panel.getElementsByClassName('draggable-seal');\r\n    panel.classList.remove('active');\r\n    panelBtn.classList.remove('active');\r\n    rotateBtns = panel.querySelectorAll('.rotate-btn');\r\n\r\n    // REMOVE EVENT LISTENERS\r\n    panelCloseBtn.removeEventListener('click', close, false);\r\n    initMove.init(panel, 'remove');\r\n    for (var i = 0; i < draggableSeals.length; i++) {\r\n      draggableSeals[i].removeEventListener('dragstart', initDrag.start, false);\r\n    }\r\n    for (var i = 0; i < rotateBtns.length; i++) {\r\n      rotateBtns[i].addEventListener('mousedown', initRotate.start, false);\r\n    }\r\n    if (panelScaleBtn) {\r\n      panelScaleBtn.removeEventListener('mousedown', initScale.start, false);\r\n    }\r\n    if (panelType == \"calculator\") {\r\n      var buttons = panel.querySelectorAll('[data-button-type]');\r\n      for (var i = 0; i < buttons.length; i++) {\r\n        buttons[i].removeEventListener('click', initCalc.calculate, false);\r\n      }\r\n    }\r\n    if (panel.classList.contains('draggable-seal')) {\r\n      panel.removeEventListener('click', bringInFront, false);\r\n    }\r\n\r\n    // update current geometry set type to null\r\n    if (panel.dataset.panelSet) {\r\n      initTools.currSetType = null;\r\n    }\r\n  }\r\n  var bringInFront = function (e) {\r\n    panel = this.closest('.draggable');\r\n\r\n    if (oldPanel != panel) {\r\n      panel.style.zIndex = ++initMove.dragParentzIndex;\r\n      // update current geometry set type to the front one\r\n      if (panel.dataset.panelSet) {\r\n        initTools.currSetType = panel.dataset.panel;\r\n      }      \r\n    }\r\n    console.log('changing')\r\n    oldPanel = panel;\r\n  }\r\n  var trashPanel = function (e, mode, sealType) {\r\n    var mousePosObj = getMousePosition(e, cv);\r\n\r\n    // bring trash can on top if draggin cubes\r\n    if (mode == \"start\") {\r\n      panel = document.querySelector('[data-panel=\"' + sealType + '\"]');\r\n      var panelPos = panel.getBoundingClientRect();\r\n      panelPosObj = {\r\n        x1: panelPos.left,\r\n        x2: panelPos.left + panelPos.width,\r\n        y1: panelPos.top,\r\n        y2: panelPos.top + panelPos.height\r\n      }\r\n    }\r\n\r\n    if (mode == \"move\") {\r\n      panel.style.zIndex = initMove.dragParentzIndex;\r\n      panel.classList.add('trash');\r\n    }\r\n\r\n    // highlight trash cubes if mouse is in\r\n    if (mousePosObj.x > panelPosObj.x1 && mousePosObj.x < panelPosObj.x2 &&\r\n      mousePosObj.y > panelPosObj.y1 && mousePosObj.y < panelPosObj.y2) {\r\n      panel.classList.add('trash-active');\r\n    } else {\r\n      panel.classList.remove('trash-active');\r\n    }\r\n\r\n    // delete dragParent if dropped on trash panel\r\n    if (mode == 'end') {\r\n      panel.classList.remove('trash')\r\n      if (panel.classList.contains('trash-active')) {\r\n        panel.classList.remove('trash-active')\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    toggle: toggle,\r\n    trashPanel: trashPanel\r\n  }\r\n})();\r\n\r\n// cubes/numbers - highlighting/snapping/detaching\r\nvar initCubes = (function (e) {\r\n  var dropCoords = {};\r\n  var isSnapping = false; // REMOVE LATER IF NOT REQUIRED\r\n  var snapDist = 40;\r\n  var snapInfo = { i: 0, j: 0, id: '' };\r\n  var row = 3;\r\n  var col = 3;\r\n  var dragParentLeft = dragParentTop = shortestDist = snapType = dragParent = dropParent = cubeLimit = cubeOuter = null;\r\n  var detachType = null;\r\n\r\n  // wrt dragParent\r\n  // 0 == top | 1 == bottom\r\n  // 0 == left | 1 == right\r\n  var getCoords = function () {\r\n    // console.log('geting Coordingates');\r\n\r\n    dragParent = initMove.dragParent;\r\n\r\n    snapType = (dragParent.classList.contains('vertical')) ? 'horizontal' : 'vertical';\r\n    detachType = (dragParent.classList.contains('horizontal')) ? 'horizontal' : 'vertical';\r\n    dropCoords = {};\r\n    var dropDotCoord_0 = dropDotCoord_1 = null;\r\n\r\n    var draggableCubes = document.querySelectorAll('.draggable-cubes');\r\n\r\n\r\n    for (let i = 0; i < draggableCubes.length; i++) {\r\n      if (draggableCubes[i] == dragParent) { continue; }\r\n\r\n      if (snapType == 'vertical') {\r\n        // console.log('vertical snapping')\r\n        dropDotCoord_0 = draggableCubes[i].querySelector('.dot-top').getBoundingClientRect();\r\n        dropDotCoord_1 = draggableCubes[i].querySelector('.dot-bottom').getBoundingClientRect();\r\n      } else {\r\n        // console.log('horizontal snapping')\r\n        dropDotCoord_0 = draggableCubes[i].querySelector('.dot-left').getBoundingClientRect();\r\n        dropDotCoord_1 = draggableCubes[i].querySelector('.dot-right').getBoundingClientRect();\r\n      }\r\n      var id = draggableCubes[i].dataset.id;\r\n\r\n      var dropCoord = {\r\n        0: {\r\n          x: dropDotCoord_0.x,\r\n          y: dropDotCoord_0.y\r\n        },\r\n        1: {\r\n          x: dropDotCoord_1.x,\r\n          y: dropDotCoord_1.y\r\n        }\r\n      }\r\n      dropCoords[id] = dropCoord;\r\n    }\r\n\r\n    dragParentLeft = dragParent.style.left;\r\n    dragParentTop = dragParent.style.top;\r\n  }\r\n  var getShortestDist = function () {\r\n    // console.log('geting shortest dist');\r\n\r\n    var shortestDist = null;\r\n    // console.log(dragParent, dropParent)\r\n\r\n    snapInfo = { i: 0, j: 0, id: '' };\r\n\r\n    if (snapType == 'vertical') {\r\n      dropDotCoord_0 = dragParent.querySelector('.dot-top').getBoundingClientRect();\r\n      dropDotCoord_1 = dragParent.querySelector('.dot-bottom').getBoundingClientRect();\r\n    } else {\r\n      dropDotCoord_0 = dragParent.querySelector('.dot-left').getBoundingClientRect();\r\n      dropDotCoord_1 = dragParent.querySelector('.dot-right').getBoundingClientRect();\r\n    }\r\n\r\n    var dragCoord = {\r\n      0: {\r\n        x: dropDotCoord_0.x,\r\n        y: dropDotCoord_0.y\r\n      },\r\n      1: {\r\n        x: dropDotCoord_1.x,\r\n        y: dropDotCoord_1.y\r\n      }\r\n    }\r\n\r\n    // wrt dragParent\r\n    // 0 == top | 1 == bottom\r\n    // 0 == left | 1 == right\r\n    // for(var i = 0; i < 2; i++) { // 0,1 -> snap using BOTH sides (top and botton || left and right)\r\n    // for(var i = 1; i < 2; i++) {  // 1 -> snap using only one side (bottom || right)\r\n    for (var i = 0; i < 1; i++) {  // 0 -> snap using only one side (top || left)\r\n      for (var dropCoord in dropCoords) {\r\n        // if drag is 'top' || 'left compare with 'bottom' || 'right' dots of drop respectivily\r\n        var j = (i == 0) ? 1 : 0;\r\n        if (dropCoords.hasOwnProperty(dropCoord)) {\r\n\r\n          // gettting coordinates to calcualte dist\r\n          var x1 = dragCoord[i].x;\r\n          var y1 = dragCoord[i].y;\r\n          var x2 = dropCoords[dropCoord][j].x;\r\n          var y2 = dropCoords[dropCoord][j].y;\r\n\r\n          // calculating dist btw points\r\n          var x = x1 - x2;\r\n          var y = y1 - y2;\r\n          var d = parseFloat((Math.sqrt(x * x + y * y)).toFixed(2));\r\n\r\n          // if shortest dist is not defined, make it equal to first calculated dist\r\n          if (shortestDist == null || shortestDist > d) {\r\n            shortestDist = d;\r\n            snapInfo = {\r\n              i: (i == 0) ? 0 : 1, // to save if it was top or bottom of dragged element\r\n              j: (j == 0) ? 0 : 1, // to save if it was top or bottom of dropped element\r\n              id: dropCoord // id of element who's j value is saved\r\n            }\r\n\r\n            initCubes.shortestDist = shortestDist;\r\n            dropParent = initMove.dropParent = document.querySelector('[data-id=\"' + dropCoord + '\"');\r\n\r\n            // no highlighting if element has already enought cubes in column\r\n            if (snapType == 'vertical') {\r\n              if (dropParent.classList.contains('vertical')) {\r\n                // initCubes.shortestDist = null\r\n              }\r\n            }\r\n            if (snapType == 'horizontal') {\r\n              if (!dragParent.classList.contains('vertical') || !dropParent.classList.contains('vertical')) {\r\n                initCubes.shortestDist = null\r\n              }\r\n            }\r\n          };\r\n        }\r\n      }\r\n    }\r\n    // make 'shortestDist' null if dragParent and dropParent is not of same type\r\n    if(dropParent) {\r\n      if (dragParent.dataset.sealType == 'cubes') {\r\n        if (dragParent.dataset.sealType != dropParent.dataset.sealType) {\r\n          initCubes.shortestDist = null;\r\n        }\r\n      } else if (dragParent.dataset.sealType == 'numbers') {\r\n        if (dragParent.dataset.numberDesign != dropParent.dataset.numberDesign ||\r\n          dragParent.dataset.numberValue != dropParent.dataset.numberValue) {\r\n          initCubes.shortestDist = null;\r\n        }\r\n      }\r\n      if(dragParent.dataset.numberValue == \"10000\") {\r\n        initCubes.shortestDist = null;\r\n      }\r\n    }\r\n  }\r\n  var highlight = function (flag) {\r\n    if (flag) {\r\n      // console.log('highlighting')\r\n      dragParent.classList.add('highlight');\r\n      dropParent.classList.add('highlight');\r\n    } else {\r\n      dragParent.classList.remove('highlight');\r\n      dropParent.classList.remove('highlight');\r\n    }\r\n  }\r\n  var snap = function () {\r\n    // console.log('snapping');\r\n\r\n    var transitionEvent = whichTransitionEvent();\r\n\r\n    var sealType = dragParent.querySelector('[data-seal-type]').dataset.sealType;\r\n    var src = dragParent.querySelector('img').src;\r\n    var width = dragParent.querySelector('img').width;\r\n    var height = dragParent.querySelector('img').height;\r\n\r\n    // update 'row' and 'col' for numbers sealTypes\r\n    if (sealType == 'numbers') {\r\n      row = 4;\r\n      col = 0;\r\n    }\r\n    cubeLimit = (snapType == \"vertical\") ? row : col;\r\n\r\n    if (snapType == \"vertical\") {\r\n      var dropParentCubeCount = dropParent.querySelectorAll('.drag-area').length;\r\n      var dragParentCubeCount = dragParent.querySelectorAll('.drag-area').length;\r\n    } else {\r\n      var dropParentCubeCount = dropParent.querySelectorAll('.cube-outer').length;\r\n      var dragParentCubeCount = dragParent.querySelectorAll('.cube-outer').length;\r\n    }\r\n    var totalCubes = dropParentCubeCount + dragParentCubeCount;\r\n\r\n    // console.log('snapType: ', snapType);\r\n    // console.log('dropParentCubeCount: ', dropParentCubeCount);\r\n    // console.log('dragParentCubeCount: ', dragParentCubeCount);\r\n    // console.log('totalCubes: ', totalCubes);\r\n    // console.log('cubeLimit: ', cubeLimit);\r\n\r\n    // if possible to add more cubes (both vertical and horizontal)\r\n    if (totalCubes <= cubeLimit) {\r\n      // console.log('totalCubes <= cubeLimit');\r\n\r\n      cubeOuter = '';\r\n      if (snapType == \"vertical\") {\r\n        for (var r = 0; r < dragParentCubeCount; r++) {\r\n          cubeOuter += `\r\n            <div class=\"cube-outer drag-area\" data-index=\"${dropParentCubeCount + r}\" data-seal-type=\"${sealType}\">\r\n              <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n            </div>        \r\n          `;\r\n        }\r\n        initMove.dropParent.innerHTML += cubeOuter;\r\n        dropParent = initMove.dropParent;\r\n      } else if (snapType == \"horizontal\") {\r\n        cubeOuter = '';\r\n        for (var c = 0; c < totalCubes; c++) {\r\n          cubeOuter += `<div class=\"cube-outer drag-area\" data-index=\"${c}\" data-seal-type=\"${sealType}\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n          }\r\n          cubeOuter += '</div>';\r\n        }\r\n        cubeOuter += `\r\n          </div>\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>\r\n          <div class=\"detach-btn\"></div>     \r\n        `;\r\n        initMove.dropParent.innerHTML = cubeOuter;\r\n        dropParent = initMove.dropParent;\r\n        initMove.init(dropParent, 'add');\r\n      }\r\n\r\n      if (snapType == \"horizontal\") dropParent.classList.add('horizontal');\r\n\r\n      totalCubes = dropParent.querySelectorAll('.cube-outer').length;\r\n\r\n      // if vertical limit reached\r\n      if (totalCubes == cubeLimit) {\r\n        // console.log('totalCubes == cubeLimit');\r\n\r\n        if (sealType == 'numbers') {\r\n          // dropParent.querySelector('.cube-outer').remove();\r\n          for (var r = 0; r < row; r++) {\r\n            dropParent.querySelector('[data-index=\"' + r + '\"]').remove();\r\n          }\r\n\r\n          cubeOuter = `\r\n            <div class=\"cube-outer drag-area\" data-index=\"0\" data-seal-type=\"numbers\">\r\n              <div class=\"cube\"><img src=\"${'_assets/img/number-' + dropParent.dataset.numberDesign + '-' + dropParent.dataset.numberValue * 10 + '.svg'}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n            </div>        \r\n          `;\r\n          dropParent.classList.remove('vertical');\r\n          dropParent.classList.remove('detach');\r\n          dropParent.setAttribute('data-number-value', dropParent.dataset.numberValue * 10)\r\n          dropParent.innerHTML += cubeOuter;\r\n        } else if (sealType == \"cubes\") {\r\n          if (snapType == \"vertical\") {\r\n            // make vertical complete group (layout needs to update)\r\n            cubeOuter = `<div class=\"cube-outer\">`;\r\n            for (var r = 0; r < row; r++) {\r\n              cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n            }\r\n            cubeOuter += `\r\n              </div>\r\n              <div class=\"dot dot-top\"></div>\r\n              <div class=\"dot dot-bottom\"></div>\r\n              <div class=\"dot dot-left\"></div>\r\n              <div class=\"dot dot-right\"></div>     \r\n              <div class=\"detach-btn\"></div>\r\n            `;\r\n\r\n            initMove.dropParent.innerHTML = cubeOuter;\r\n            dropParent = initMove.dropParent;\r\n            dropParent.classList.add('vertical');\r\n          } else if (snapType == \"horizontal\") {\r\n            dropParent = initMove.dropParent;\r\n          }\r\n        }\r\n\r\n        console.log('limit reached!!!!!!!!!!');\r\n      }\r\n      // console.log(dropParent);\r\n      initMove.init(dropParent, 'add');\r\n      dragParent.remove();\r\n    } else if (totalCubes > cubeLimit) {\r\n      // console.log('totalCubes > cubeLimit');\r\n\r\n      var canBeAddedCubes = cubeLimit - dropParentCubeCount;\r\n      var remainingCubes = dragParentCubeCount - canBeAddedCubes;\r\n\r\n      if (snapType == \"vertical\") {\r\n        // make vertical complete group (layout needs to update)\r\n        cubeOuter = `<div class=\"cube-outer\">`;\r\n        for (var r = 0; r < row; r++) {\r\n          cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n        }\r\n        cubeOuter += `\r\n          </div>\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>     \r\n          <div class=\"detach-btn\"></div>\r\n        `;\r\n\r\n        initMove.dropParent.innerHTML = cubeOuter;\r\n        dropParent = initMove.dropParent;\r\n        dropParent.classList.add('vertical');\r\n\r\n        // remove cubes from dragParent\r\n        for (var i = 0; i < canBeAddedCubes; i++) {\r\n          dragParent.querySelector('[data-index=\"' + (dragParentCubeCount - 1 - i) + '\"].cube-outer').remove();\r\n        }\r\n\r\n      } else if (snapType == \"horizontal\") {\r\n        // make horizontal complete group \r\n        cubeOuter = \"\";\r\n        for (var c = 0; c < canBeAddedCubes; c++) {\r\n          cubeOuter += `<div class=\"cube-outer drag-area\" data-index=\"${dropParentCubeCount + c}\" data-seal-type=\"${sealType}\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n          }\r\n          cubeOuter += '</div>';\r\n        }\r\n        initMove.dropParent.innerHTML += cubeOuter;\r\n        dropParent = initMove.dropParent;\r\n        // dropParent.classList.remove('vertical');\r\n\r\n        if (remainingCubes == 1) {\r\n          cubeOuter = `<div class=\"cube-outer\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          `;\r\n          }\r\n          cubeOuter += `\r\n            </div> \r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n            <div class=\"detach-btn\"></div>\r\n          `;\r\n\r\n          initMove.dragParent.innerHTML = cubeOuter;\r\n          dragParent = initMove.dragParent;\r\n          initMove.init(dragParent, 'add');\r\n          dragParent.classList.remove('horizontal');\r\n        } else {\r\n          // remove cubes from dragParent\r\n          for (var i = 0; i < canBeAddedCubes; i++) {\r\n            dragParent.querySelector('[data-index=\"' + (dragParentCubeCount - 1 - i) + '\"].cube-outer').remove();\r\n          }\r\n        }\r\n      }\r\n\r\n      initMove.init(dropParent, 'add');\r\n\r\n\r\n      dragParent.style.left = dragParentLeft;\r\n      dragParent.style.top = dragParentTop;\r\n      initMove.init(dragParent, 'add');\r\n      dragParent.classList.add('cant-snap');\r\n\r\n      console.log('limit reached!!!!!!!!!!');\r\n    }\r\n\r\n    dragParent.addEventListener(transitionEvent, transitionEndCallback);\r\n    function transitionEndCallback() {\r\n      dragParent.removeEventListener(transitionEvent, transitionEndCallback);\r\n      dragParent.classList.remove('cant-snap');\r\n    }\r\n    dragParent.classList.remove('highlight');\r\n    dropParent.classList.remove('highlight');\r\n  }\r\n  // code logic NOT NEEDED for now \r\n  var detach = function (e) {\r\n    // console.log('detaching');\r\n\r\n    if (detachType == 'vertical') {  // vertical detach\r\n      var target = e.target;\r\n\r\n      var index = parseInt(target.dataset.index);\r\n      var totalCubes = dragParent.querySelectorAll('.drag-area').length;\r\n      var detachCubes = totalCubes - index;\r\n\r\n      var sealType = dragParent.querySelector('[data-seal-type]').dataset.sealType;\r\n      var src = dragParent.querySelector('img').src;\r\n      var width = dragParent.querySelector('img').width;\r\n      var height = dragParent.querySelector('img').height;\r\n\r\n      dragParentLeft = dragParent.style.left;\r\n      dragParentTop = dragParent.style.top;\r\n\r\n      // console.log('target: ', target);\r\n      // console.log('index: ', index);\r\n      // console.log('detachCubes: ', detachCubes);\r\n      // console.log('totalCubes: ', totalCubes);\r\n\r\n      if (totalCubes == 1 && !dragParent.classList.contains('vertical')) {\r\n        dragParent.remove();\r\n      } else if (index) {\r\n        // top\r\n        if (!dragParent.classList.contains('vertical')) { // detaching vertical group when INCOMPLETE\r\n          for (var r = index; r < totalCubes; r++) {\r\n            dragParent.querySelector('[data-index=\"' + r + '\"]').remove();\r\n          }\r\n        } else { // detaching vertical group when COMPLETE\r\n          cubeOuter = '';\r\n          for (var r = 0; r < index; r++) {\r\n            cubeOuter += `\r\n              <div class=\"cube-outer drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\">\r\n                <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n              </div>        \r\n            `;\r\n          }\r\n          cubeOuter += `\r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;\r\n          initMove.dragParent.innerHTML = cubeOuter;\r\n          dragParent = initMove.dragParent;\r\n          dragParent.classList.remove('vertical');\r\n\r\n          initMove.init(dragParent, 'add');\r\n          dragParent.addEventListener('dblclick', detach, false);\r\n        }\r\n\r\n        var left = parseFloat(dragParentLeft);\r\n        var top = parseFloat(dragParentTop) + dragParent.getBoundingClientRect().height + 30;\r\n        // bottom\r\n        var draggable = document.createElement('div');\r\n        draggable.classList.add('draggable-cubes');\r\n        draggable.classList.add('draggable');\r\n        draggable.setAttribute('data-id', ++initDrag.draggablesId);\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n        draggable.style.left = left + 'px';\r\n        draggable.style.top = top + 'px';\r\n        draggable.style.zIndex = ++initMove.dragParentzIndex;\r\n\r\n        cubeOuter = '';\r\n        for (var r = 0; r < detachCubes; r++) {\r\n          cubeOuter += `\r\n          <div class=\"cube-outer drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\">\r\n            <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          </div>        \r\n        `;\r\n        }\r\n        cubeOuter += `\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>     \r\n        `;\r\n\r\n        draggable.innerHTML = cubeOuter;\r\n        cvOuter.appendChild(draggable);\r\n\r\n        initMove.init(draggable, 'add');\r\n        draggable.addEventListener('dblclick', detach, false);\r\n      } else {\r\n        console.warn(\"Can't remove from here!\");\r\n      }\r\n    } else if (detachType == 'horizontal') { // horizontal detach\r\n      var target = e.target;\r\n\r\n      var index = parseInt(target.dataset.index);\r\n      var totalCubes = dragParent.querySelectorAll('.drag-area').length;\r\n      var detachCubes = totalCubes - index;\r\n\r\n      var sealType = dragParent.querySelector('[data-seal-type]').dataset.sealType;\r\n      var src = dragParent.querySelector('img').src;\r\n      var width = dragParent.querySelector('img').width;\r\n      var height = dragParent.querySelector('img').height;\r\n\r\n      dragParentLeft = dragParent.style.left;\r\n      dragParentTop = dragParent.style.top;\r\n\r\n      // console.log('target: ', target);\r\n      // console.log('index: ', index); // 1\r\n      // console.log('detachCubes: ', detachCubes); // 2\r\n      // console.log('totalCubes: ', totalCubes); // 3\r\n\r\n      if (index) {\r\n        // left\r\n        if (index == 1) {\r\n          cubeOuter = `<div class=\"cube-outer\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          `;\r\n          }\r\n          cubeOuter += `\r\n            </div> \r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;\r\n\r\n          initMove.dragParent.innerHTML = cubeOuter;\r\n          dragParent = initMove.dragParent;\r\n          initMove.init(dragParent, 'add');\r\n          dragParent.classList.remove('horizontal');\r\n        } else {\r\n          for (var r = index; r < totalCubes; r++) {\r\n            dragParent.querySelector('[data-index=\"' + r + '\"]').remove();\r\n          }\r\n        }\r\n\r\n        var left = parseFloat(dragParentLeft) + dragParent.getBoundingClientRect().width + 30;\r\n        var top = parseFloat(dragParentTop);\r\n\r\n        // right\r\n        var draggable = document.createElement('div');\r\n        draggable.classList.add('draggable-cubes');\r\n        draggable.classList.add('draggable');\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n        draggable.setAttribute('data-id', ++initDrag.draggablesId);\r\n        draggable.style.left = left + 'px';\r\n        draggable.style.top = top + 'px';\r\n        draggable.style.zIndex = ++initMove.dragParentzIndex;\r\n\r\n        if (detachCubes == 1) { // detach partion is only 1\r\n          cubeOuter = `<div class=\"cube-outer\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          `;\r\n          }\r\n          cubeOuter += `\r\n            </div> \r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;\r\n\r\n        } else { // detach partion - more than 1\r\n          cubeOuter = '';\r\n          for (var c = 0; c < detachCubes; c++) {\r\n            cubeOuter += `<div class=\"cube-outer drag-area\" data-index=\"${c}\" data-seal-type=\"${sealType}\">`;\r\n            for (var r = 0; r < row; r++) {\r\n              cubeOuter += `<div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n            }\r\n            cubeOuter += `</div>`;\r\n          }\r\n          cubeOuter += `\r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;\r\n          draggable.classList.add('horizontal');\r\n        }\r\n\r\n        initMove.dropParent = draggable;\r\n        // dropParent = initMove.dropParent;\r\n\r\n        draggable.classList.add('vertical');\r\n        draggable.innerHTML = cubeOuter;\r\n        cvOuter.appendChild(draggable);\r\n\r\n        initMove.init(draggable, 'add');\r\n        draggable.addEventListener('dblclick', detach, false);\r\n      } else {\r\n        console.warn(\"Can't remove from here!\");\r\n      }\r\n    }\r\n  }\r\n  var detachUI = function (e) {\r\n    // console.log('detachUI');\r\n\r\n    var dragParentLeft = dragParent.style.left;\r\n    var dragParentTop = dragParent.style.top;\r\n    var left = parseFloat(dragParentLeft);\r\n    // var top = parseFloat(dragParentTop) + dragParent.getBoundingClientRect().height;\r\n    var cubeHeight = dragParent.querySelector('.drag-area').getBoundingClientRect().height;\r\n    var cubeOuter;\r\n    //  console.lo\r\n    var sealType = dragParent.dataset.sealType;\r\n    var src = dragParent.querySelector('img').src;\r\n    var width = dragParent.querySelector('img').width;\r\n    var height = dragParent.querySelector('img').height;    \r\n\r\n    if (e.target.classList.contains('detach-btn')) { // detach all cubes\r\n      // console.log('detaching All');\r\n\r\n      if (detachType == 'vertical') {\r\n        console.log('vertical detaching all')\r\n\r\n        var cubesToDetach = dragParent.querySelectorAll('.drag-area').length;\r\n        // dragParent.querySelector('.detach-btn').remove();\r\n\r\n        // top one\r\n        for (var i = 1; i < cubesToDetach; i++) {\r\n          dragParent.querySelector('[data-index=\"' + i + '\"]').remove();\r\n          dragParent.classList.remove('detach')\r\n        }\r\n\r\n        // bottom cubes\r\n        for (var i = 1; i < cubesToDetach; i++) {\r\n          var draggable = document.createElement('div');\r\n          draggable.classList.add('draggable-cubes');\r\n          draggable.classList.add('draggable');\r\n          draggable.setAttribute('data-id', ++initDrag.draggablesId);\r\n          draggable.setAttribute('data-seal-type', sealType);\r\n          draggable.style.left = left + 'px';\r\n          draggable.style.top = parseFloat(dragParentTop) + cubeHeight * i + 30 * i + 'px';\r\n          draggable.style.zIndex = ++initMove.dragParentzIndex;\r\n          if(sealType == 'numbers') {\r\n            draggable.setAttribute('data-number-design', dragParent.dataset.numberDesign);\r\n            draggable.setAttribute('data-number-value', dragParent.dataset.numberValue);\r\n          }\r\n\r\n          cubeOuter = `\r\n            <div class=\"cube-outer drag-area\" data-index=\"0\" data-seal-type=\"${sealType}\">\r\n            <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n            </div>        \r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n            <div class=\"detach\"></div>     \r\n          `;\r\n\r\n          draggable.innerHTML = cubeOuter;\r\n          cvOuter.appendChild(draggable);\r\n\r\n          initMove.init(draggable, 'add');\r\n          draggable.addEventListener('dblclick', remove, false);\r\n        }\r\n\r\n      } else {\r\n        console.log('horizontal detaching all')\r\n\r\n      }\r\n    } else { // toggle 'detach-btn'\r\n      if (dragParent.querySelectorAll('.drag-area').length > 1) {\r\n        if (dragParent.classList.contains('detach')) {\r\n          dragParent.classList.remove('detach');\r\n        } else {\r\n          dragParent.classList.add('detach');\r\n        }\r\n      }\r\n    }\r\n  }\r\n  var remove = function (e) {\r\n    // console.log('deleting');\r\n\r\n    // delete complete 'draggable' group\r\n    e.target.closest('.draggable').remove();\r\n  }\r\n\r\n  return {\r\n    isSnapping: isSnapping,\r\n    snapDist: snapDist,\r\n    shortestDist: shortestDist,\r\n    getCoords: getCoords,\r\n    getShortestDist: getShortestDist,\r\n    highlight: highlight,\r\n    snap, snap,\r\n    detachUI, detachUI,\r\n    remove, remove\r\n  }\r\n})();\r\n\r\n// rotate behaviour of tools/widgets/seals\r\nvar initRotate = (function () {\r\n  var startAngle = null;\r\n  var panelRotation = null;\r\n  var rotation = null;\r\n  var rotateBtn = null;\r\n  var rotatable = null;\r\n  var panel;\r\n  var oldPanel = null;\r\n  var panelType = null;\r\n  var d, x, y;\r\n  var refPoint = {\r\n    x: 0,\r\n    y: 0\r\n  };\r\n  var R2D = 180 / Math.PI;\r\n\r\n  var start = function (e) {\r\n    // console.log('start');\r\n    e.preventDefault();\r\n\r\n    var height, left, top, width, refEl;\r\n    rotateBtn = e.target;\r\n    panel = rotateBtn.closest('.draggable');\r\n    panelType = panel.dataset.panel;\r\n    rotatable = rotateBtn.closest('.rotatable');\r\n\r\n    // reset 'startAngle' if panel is different each time\r\n    if (oldPanel != panel) {\r\n      startAngle = null;\r\n    }\r\n    oldPanel = panel;\r\n\r\n    cvOuter.classList.add('rotating');\r\n\r\n    refEl = rotatable;\r\n\r\n    if(panelType == \"compass\") {\r\n      if(rotateBtn.classList.contains('rotate-point') || rotateBtn.classList.contains('rotate-pencil')) {\r\n        refEl = panel.querySelector('.rotate-hand-ref');\r\n      } else if(rotateBtn.classList.contains('rotate-compass')) {\r\n        refEl = panel.querySelector('.rotate-compass-ref');\r\n      }\r\n    }\r\n\r\n    refObj = refEl.getBoundingClientRect();\r\n    \r\n    top = refObj.top,\r\n    left = refObj.left,\r\n    height = refObj.height,\r\n    width = refObj.width;\r\n    \r\n    refPoint = {\r\n      x: left + (width / 2),\r\n      y: top + (height / 2)\r\n    };\r\n\r\n    x = e.clientX - refPoint.x;\r\n    y = e.clientY - refPoint.y;\r\n\r\n\r\n    if(panelType == 'compass') {\r\n      if(rotateBtn.classList.contains('rotate-point') || rotateBtn.classList.contains('rotate-pencil')) {\r\n        if (panel.dataset.angleHand == undefined) {\r\n          startAngle = Math.floor(R2D * Math.atan2(y, x));\r\n          panel.setAttribute('data-angle-hand', startAngle);\r\n        } else {\r\n          startAngle = panel.dataset.angleHand;\r\n        }\r\n      } else if(rotateBtn.classList.contains('btn') || rotateBtn.classList.contains('rotate-compass')) {\r\n        if (panel.dataset.angle == undefined) {\r\n          startAngle = Math.floor(R2D * Math.atan2(y, x));\r\n          panel.setAttribute('data-angle', startAngle);\r\n        } else {\r\n          startAngle = panel.dataset.angle;\r\n        }          \r\n      } else if(rotateBtn.classList.contains('rotate-compass')) {\r\n        if (panel.dataset.angleCompass == undefined) {\r\n          startAngle = Math.floor(R2D * Math.atan2(y, x));\r\n          panel.setAttribute('data-angle-compass', startAngle);\r\n        } else {\r\n          startAngle = panel.dataset.angleCompass;\r\n        }     \r\n        panel.classList.add('point-ref');        \r\n      }\r\n    } else {\r\n      if (panel.dataset.angle == undefined) {\r\n        startAngle = Math.floor(R2D * Math.atan2(y, x));\r\n        panel.setAttribute('data-angle', startAngle);\r\n      } else {\r\n        startAngle = panel.dataset.angle;\r\n      }\r\n    }\r\n\r\n    cvOuter.addEventListener('mousemove', rotate, false);\r\n    cvOuter.addEventListener('mouseup', end, false);\r\n  };\r\n\r\n  var rotate = function (e) {\r\n    // console.log('rotate');\r\n\r\n    e.preventDefault();\r\n\r\n    x = e.clientX - refPoint.x;\r\n    y = e.clientY - refPoint.y;\r\n    d = Math.floor(R2D * Math.atan2(y, x));\r\n\r\n    rotation = d - startAngle;\r\n    // console.log(d, startAngle, rotation)\r\n    \r\n    if (panelType == 'clock') {\r\n      rotatable.style.transform = \"translateY(-50%) rotate(\" + d + \"deg)\";\r\n    } else if(panelType == \"compass\") {\r\n      if(rotateBtn.classList.contains('rotate-point')) {\r\n        // if(d > 85) d = 85; else\r\n        // if(d < 50) d = 50;\r\n        // d = d + panelRotation;\r\n        rotatable.style.transform = \"translateY(-50%) rotate(\" + d + \"deg)\";\r\n      } else if(rotateBtn.classList.contains('rotate-pencil')) {\r\n        // if(d > 130) d = 130; else\r\n        // if(d < 95) d = 95;\r\n        rotatable.style.transform = \"translateY(-50%) rotate(\" + d + \"deg)\";\r\n      } else if(rotateBtn.classList.contains('rotate-compass')){\r\n        rotatable.style.transform = \"rotate(\" + rotation + \"deg)\";\r\n      } else {\r\n        rotatable.style.transform = \"rotate(\" + rotation + \"deg)\";\r\n      }\r\n    } else {\r\n      rotatable.style.transform = \"rotate(\" + rotation + \"deg)\";\r\n    }\r\n  };\r\n\r\n  var end = function (e) {\r\n    // console.log('end');\r\n\r\n    if(rotateBtn.classList.contains('rotate-compass')){\r\n      panel.classList.add('point-ref');\r\n    }\r\n\r\n    cvOuter.classList.remove('rotating');\r\n\r\n    cvOuter.removeEventListener('mousemove', rotate, false);\r\n    cvOuter.removeEventListener('mouseup', end, false);\r\n  };\r\n\r\n  // Explicitly reveal public pointers to the private functions \r\n  // that we want to reveal publicly\r\n\r\n  return {\r\n    start: start\r\n  }\r\n})();\r\n\r\n// scale sets logics\r\nvar initScale = (function (e) {\r\n  // console.log('scaling');\r\n\r\n  var start = function (e) {\r\n    console.log('start');\r\n\r\n    cvOuter.addEventListener('mousemove', scale, false);\r\n    cvOuter.addEventListener('mouseup', end, false);\r\n  }\r\n  var scale = function (e) {\r\n    console.log('scale');\r\n    e.preventDefault();\r\n  }\r\n  var end = function (e) {\r\n    console.log('end');\r\n\r\n    cvOuter.removeEventListener('mousemove', scale, false);\r\n    cvOuter.removeEventListener('mouseup', end, false);\r\n  }\r\n\r\n  return {\r\n    start: start\r\n  }\r\n})()\r\n\r\n// calculator logic\r\nvar initCalc = (function (e) {\r\n\r\n  var num = \"\";\r\n  var calculate = function (e) {\r\n    // console.log('calculating');\r\n\r\n    var result = document.querySelector('[data-panel=\"calculator\"] #result');\r\n    var buttonType = e.target.closest('g[data-button-type]').dataset.buttonType;\r\n    var buttonValue = e.target.closest('g[data-button-type]').dataset.buttonValue;\r\n\r\n    if (buttonType == \"num\") {\r\n      num += buttonValue;\r\n      result.innerHTML = num;\r\n    } else if (buttonType == \"func\") {\r\n      switch (buttonValue) {\r\n        case \"=\":\r\n          num = eval(num).toString();\r\n          break;\r\n        case \"<-\":\r\n          num = num.slice(0, -1);\r\n          break;\r\n        case \"c\":\r\n        case \"ac\":\r\n          num = \"\";\r\n          break;\r\n        case \"*\":\r\n        case \"/\":\r\n        case \"+\":\r\n        case \"-\":\r\n          num += \" \" + buttonValue + \" \";\r\n          break;\r\n      }\r\n      result.innerHTML = num;\r\n    }\r\n\r\n  }\r\n\r\n  return {\r\n    calculate: calculate\r\n  }\r\n})();\r\n\r\n// abacus logic\r\nvar initAbacus = function () {\r\n  window.onload = init\r\n  function init() {\r\n    mousedown = 0;\r\n    body = document.querySelector('body');\r\n    body.addEventListener('mousedown', function () {\r\n      mousedown = 1;\r\n    });\r\n    body.addEventListener('mouseup', function () {\r\n      mousedown = 0;\r\n    });\r\n    upper_part = document.querySelectorAll('.upper_layer');\r\n    upper_part.forEach(function (x) {\r\n      x.addEventListener('click', change_pos.bind(null, event, x));\r\n      x.addEventListener('mousemove', reset_upper_boxes.bind(null, event, x));\r\n    });\r\n    // check = document.querySelector(\"#Group_389\");\r\n    // check.setAttribute('transform','translate(0,-43)');\r\n\r\n    lower_part = document.querySelectorAll('.bottom_boxes');\r\n    lower_part.forEach(function (x) {\r\n      x.addEventListener('click', change_pos_lower.bind(null, event, x));\r\n      x.addEventListener('mousemove', reset_lower_boxes.bind(null, event, x));\r\n    });\r\n  }\r\n\r\n  function reset_lower_boxes(a, evt, c) {\r\n    column_id = evt.parentNode.getAttribute('id');\r\n    boxes = document.querySelectorAll('#' + column_id + ' .bottom_boxes');\r\n    if (mousedown) {\r\n      if (evt.dataset.state == \"up\") {\r\n        for (i = 0; i <= 3; ++i) {\r\n          boxes[i].setAttribute('transform', 'translate(0,0)');\r\n          boxes[i].dataset.state = \"down\";\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function reset_upper_boxes(a, evt, c) {\r\n    if (mousedown) {\r\n      evt.setAttribute('transform', 'translate(0,0)');\r\n    }\r\n  }\r\n\r\n  function change_pos_lower(a, evt, c) {\r\n    column_id = evt.parentNode.getAttribute('id');\r\n    boxes = document.querySelectorAll('#' + column_id + ' .bottom_boxes');\r\n    till = evt.dataset.pos;\r\n    if (evt.dataset.state == \"down\") {\r\n      for (i = 0; i <= till; ++i) {\r\n        boxes[i].setAttribute('transform', 'translate(0,-43)');\r\n        boxes[i].dataset.state = \"up\";\r\n      }\r\n    }\r\n    else {\r\n      for (i = till; i <= 3; ++i) {\r\n        boxes[i].setAttribute('transform', 'translate(0,0)');\r\n        boxes[i].dataset.state = \"down\";\r\n      }\r\n    }\r\n  }\r\n\r\n  function change_pos(a, evt, c) {\r\n    evt.style.background = 'red';\r\n    if (evt.dataset.pos == \"down\") {\r\n      evt.setAttribute('transform', 'translate(0,-20)');\r\n      evt.dataset.pos = \"up\";\r\n    }\r\n    else {\r\n      evt.setAttribute('transform', 'translate(0,0)');\r\n      evt.dataset.pos = \"down\";\r\n    }\r\n  }\r\n\r\n}\r\n// initAbacus();\r\n\r\n// math functions - mostly trigonometry\r\nvar math = (function(e) {\r\n  var toolDrawingOffset = 50;\r\n  var slope = 0;\r\n  var inRange = false;\r\n\r\n  var parseToFloat = function(number, decimal) {\r\n    return parseFloat(number.toFixed(decimal));\r\n  }\r\n\r\n  // not useing for now\r\n  var getLineEquation = function() {\r\n    // var m = slope;\r\n    // // y - y1 = m (x - x1) || mx - y + y1 - mx1 = 0\r\n    // // return `y-${lines.l12.p1.y} = ${m} (x-${lines.l12.p1.x})`;\r\n    // // y - mx = y1 - m*x1\r\n    // return `y - ${m}x = ${lines.l12.p1.y - (m * lines.l12.p1.x)}`;\r\n  }\r\n\r\n  // get points coordinates with in the set\r\n  var getSetPoints = function(currSetType) {\r\n    var pointsObj = {};\r\n    var set = document.querySelector('[data-panel=\"'+currSetType+'\"]');\r\n    var pointsEl = set.querySelectorAll('.point');\r\n    var canvasPosition = getElPosition(cv);\r\n    for (let i = 0; i < pointsEl.length; i++) {\r\n      var pointObj = {\r\n        x: '',\r\n        y: ''\r\n      };\r\n      var cvLeft = canvasPosition.left;\r\n      var cvTop = canvasPosition.right;\r\n      var pointLeft = pointsEl[i].getBoundingClientRect().left;\r\n      var pointTop = pointsEl[i].getBoundingClientRect().top;\r\n      var pointWidth = pointsEl[i].getBoundingClientRect().width;\r\n      var pointHeight = pointsEl[i].getBoundingClientRect().height;\r\n  \r\n      pointObj['x'] = parseFloat((pointLeft + (pointWidth / 2) - cvLeft).toFixed(2));\r\n      pointObj['y'] = parseFloat((pointTop + (pointHeight / 2) - cvTop).toFixed(2));\r\n      pointsObj[i + 1] = pointObj;\r\n    }\r\n    return pointsObj;\r\n  }\r\n\r\n  var getLines = function(e) {\r\n    var lines = {};\r\n    var pointsObj = math.getSetPoints(initTools.currSetType);\r\n\r\n    var pointsLength = Object.size(pointsObj);\r\n  \r\n    for (let i = 1; i <= pointsLength; i++) {\r\n      var j = (i == pointsLength) ? 1 : i + 1;\r\n      var line = {\r\n        'p1': pointsObj[i],\r\n        'p2': pointsObj[j]\r\n      };\r\n      lines['l' + i + j] = line;\r\n    }\r\n    return lines;\r\n  }\r\n\r\n  var getSlope = function(line) {\r\n    // m = (y2 - y1) / (x2 - x1)\r\n    var m = (line.p2.y - line.p1.y) / (line.p2.x - line.p1.x);\r\n    return parseToFloat(m, 2);\r\n  }\r\n  \r\n  var calculatePerpendicularDistFromLine = function(line, point, m) {\r\n    if (m == Infinity || m == -Infinity) return Math.abs(line.p1.x - point.x);\r\n    return Math.abs((m * point.x - point.y + line.p1.y - m * line.p1.x) / (Math.sqrt(1 + m * m)));\r\n  }\r\n\r\n  var getCoords = function(pointsObj, side, point, m) {\r\n    // console.log('getCoord');\r\n\r\n    // y = m (x - x1) + y1\r\n    // y = m (x - x2) + y2\r\n    // console.log('Eq1: ', `y = ${m}(x - ${startPoint.x}) + ${startPoint.y}`)\r\n    // console.log('Eq2: ', `y = ${-1/m}(x - ${currPoint.x}) + ${currPoint.y}`)    \r\n\r\n    // x coordinate of intersection of two lines\r\n    // var x = (m * (y2 - y1) + m * m * x1 - x2) / ((m * m) + m)\r\n\r\n    var x, y, _x;\r\n    var s = initDraw.strokeWidth/2;\r\n    \r\n    if (m == 0) {\r\n      if(side == 1) {\r\n        s = (pointsObj[1].x < pointsObj[3].x) ? -s : s;\r\n      } else {\r\n        s = (pointsObj[1].x < pointsObj[3].x) ? s : -s;\r\n      }\r\n      x = point.x;\r\n      y = pointsObj[side].y + s;\r\n    } else if (m == Infinity || m == -Infinity) {\r\n      if(side == 1) {\r\n        s = (pointsObj[1].x < pointsObj[3].x) ? -s : s;\r\n      } else {\r\n        s = (pointsObj[1].x < pointsObj[3].x) ? s : -s;\r\n      }\r\n      x = pointsObj[side].x + s;\r\n      y = point.y;\r\n    } else {\r\n      // points coords on scale\r\n      x1 = ((point.x / m) + (m * pointsObj[side].x) + point.y - pointsObj[side].y) / (m + (1 / m));\r\n      y1 = m * (x1 - pointsObj[side].x) + pointsObj[side].y;\r\n      \r\n      // points coords modified as per stroke width\r\n      m = -1/m;\r\n      if(pointsObj[1].x > pointsObj[4].x) {\r\n        if(side == 1) {\r\n          x = x1 + Math.sqrt((s*s)/(1+m*m)); \r\n        } else if(side == 3) {\r\n          x = x1 - Math.sqrt((s*s)/(1+m*m)); \r\n        }\r\n        y = m*(x-x1)+y1\r\n      } else {\r\n        if(side == 1) {\r\n          x = x1 - Math.sqrt((s*s)/(1+m*m)); \r\n        } else if(side == 3) {\r\n          x = x1 + Math.sqrt((s*s)/(1+m*m)); \r\n        }\r\n        y = m*(x-x1)+y1\r\n      }\r\n    }\r\n    // console.log(`side: ${side} m: ${m}`)\r\n\r\n    return {\r\n      x: x,\r\n      y: y\r\n    }\r\n  }\r\n\r\n  var sideAndRange = function(currPoint) {\r\n    var lines = getLines();\r\n\r\n    // to check if point is between parallel lines\r\n    // d = (x−x1)(y2−y1)−(y−y1)(x2−x1)\r\n    var check12 = (currPoint.x - (lines.l12.p1.x)) * (lines.l12.p2.y - lines.l12.p1.y) - (currPoint.y - lines.l12.p1.y) * (lines.l12.p2.x - lines.l12.p1.x);\r\n    var check34 = (currPoint.x - (lines.l34.p1.x)) * (lines.l34.p2.y - lines.l34.p1.y) - (currPoint.y - lines.l34.p1.y) * (lines.l34.p2.x - lines.l34.p1.x);\r\n  \r\n    var check23 = (currPoint.x - (lines.l23.p1.x)) * (lines.l23.p2.y - lines.l23.p1.y) - (currPoint.y - lines.l23.p1.y) * (lines.l23.p2.x - lines.l23.p1.x);\r\n    var check41 = (currPoint.x - (lines.l41.p1.x)) * (lines.l41.p2.y - lines.l41.p1.y) - (currPoint.y - lines.l41.p1.y) * (lines.l41.p2.x - lines.l41.p1.x);\r\n  \r\n    var isInBtwParallelLines = ((check12 < 0 && check34 < 0) || (check12 > 0 && check34 > 0) || (check23 < 0 && check41 < 0) || (check23 > 0 && check41 > 0)) ? true : false;\r\n  \r\n    var line;\r\n    var perpendicularDist;\r\n    var side = '';\r\n    // to check if point lies between parallel lines\r\n    if (isInBtwParallelLines) {\r\n      line = ((check12 < 0 && check34 < 0) || (check12 > 0 && check34 > 0)) ? '12_34' : '23_41';\r\n      // checking nearest line\r\n      if (line == '12_34') {\r\n        slope = getSlope(lines.l23);\r\n        var d23 = calculatePerpendicularDistFromLine(lines.l23, currPoint, slope);\r\n        var d41 = calculatePerpendicularDistFromLine(lines.l41, currPoint, slope);\r\n        if (d23 < d41) {\r\n          perpendicularDist = d23;\r\n          nearestLine = lines.l23\r\n          side = 2;\r\n          startPoint = currPoint;\r\n        } else {\r\n          perpendicularDist = d41;\r\n          nearestLine = lines.l41;\r\n          side = 4;\r\n        }\r\n      } else {\r\n        slope = getSlope(lines.l12);\r\n        var d12 = calculatePerpendicularDistFromLine(lines.l12, currPoint, slope);\r\n        var d34 = calculatePerpendicularDistFromLine(lines.l34, currPoint, slope);\r\n        if (d12 < d34) {\r\n          perpendicularDist = d12;\r\n          nearestLine = lines.l12;\r\n          side = 1;\r\n        } else {\r\n          perpendicularDist = d34;\r\n          nearestLine = lines.l34\r\n          side = 3;\r\n        }\r\n      }\r\n      if (toolDrawingOffset >= perpendicularDist) {\r\n        if(side == 1 || side == 3) {\r\n          inRange = true;\r\n        } else {\r\n          inRange = false;\r\n        }\r\n      } else {\r\n        // make it false if not drawing\r\n        // if (!isDrawingModeOn) \r\n        inRange = false;\r\n      }\r\n    } else {\r\n      // if (!isDrawingModeOn) \r\n      inRange = false;\r\n    }\r\n\r\n    // just for debugging\r\n    // console.log(perpendicularDist, toolDrawingOffset)\r\n    // console.log('inRange, side, slope: ', inRange, side, math.slope);\r\n\r\n    return {\r\n      inRange: inRange,\r\n      side: side,\r\n      slope, slope\r\n    }\r\n  }  \r\n\r\n  return {\r\n    sideAndRange: sideAndRange,\r\n    getSetPoints: getSetPoints,\r\n    getCoords: getCoords\r\n  }\r\n})();\r\n\r\ndocument.querySelector('[data-tool-type1=\"pen\"]').click();"],"file":"script.min.js"}