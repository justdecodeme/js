{"version":3,"sources":["script.js"],"names":["cv","document","getElementById","cvOuter","pointsObj","linesss","isSetInRange","toolDrawingOffset","inRange","slope","isDrawingModeOn","isStartedInRange","nearestLineStarted","nearestLine","whichTransitionEvent","t","el","createElement","transitions","transition","OTransition","MozTransition","WebkitTransition","undefined","style","getElPosition","left","getBoundingClientRect","right","top","getMousePosition","e","pos","point","x","y","parseFloat","type","touches","clientX","toFixed","clientY","parseToFloat","number","decimal","getPointsCoordinates","pointsEl","querySelector","querySelectorAll","canvasPosition","i","length","pointObj","cvLeft","cvTop","pointLeft","pointTop","pointWidth","width","pointHeight","height","getLines","pointsLength","Object","size","j","line","p1","p2","getSlope","calculatePerpendicularDistFromLine","m","Infinity","Math","abs","sqrt","checkDrawingSide","currPoint","perpendicularDist","check12","l12","check34","l34","check23","l23","check41","l41","side","d23","d41","startPoint","d12","d34","console","log","obj","key","hasOwnProperty","initTools","toolsUniverse","toolsPlanets","toolsPlanetSets","toolsPlanetPens","minimizeToggleBtn","offsetWidth","toolsPlanetSetsBtn","toolsPlanetPensBtn","currToolType","currSetType","forEach","toolsPlanet","toolsSatellites","id","toolsSatellitesWidth","toolsPlanetWidth","totalOffset","toolsSatellite","n","round","cos","PI","sin","classList","contains","toolGroupType","dataset","rotation","radius","toString","add","updateToolType1","target","oldToolBtn","remove","removeEventListener","initDraw","drawStart","toolType1","addEventListener","updateToolType2","strokeColor","value","updateToolsGroup","isPrimary","isSecondary","parent","substr","setAttribute","strokeOpacity","strokeWidth","src","getAttribute","toolType2","ispanelBtn","panelBtn","undo","redo","clear","initPanel","toggle","strokeOpacityEl","strokeWidthEl","currId","index","undoStack","redoStack","draw","preventDefault","polyline","points","push","Elements","Id","Action","drawEnd","ele","lastAction","pop","parentNode","removeChild","appendChild","shape","clearedEles","innerHTML","polylineTag","strokeColorPen","strokeWidthPen","strokeWidthMarker","initMove","startX","startY","endX","endY","dragParent","dropParent","oldDragParent","init","draggable","listener","dragAreas","dragArea","start","closest","zIndex","dragParentzIndex","initCubes","getCoords","move","end","initDrag","sealType","trashPanel","offsetLeft","offsetBottom","offsetTop","bottom","getShortestDist","shortestDist","snapDist","highlight","snap","dragEloffsetX","dragEloffsetY","enter","leave","over","drop","dataTransfer","getData","totalSealsAllowed","sealTypes","detach","draggablesId","offsetX","offsetY","dropElHeight","alert","setData","fetchSeals","sealPanelContent","values","panel","oldPanel","panelType","panelPosObj","panelCloseBtn","panelScaleBtn","draggableSeals","rotateBtns","close","this","getElementsByClassName","bringInFront","rotateBtn","initRotate","initScale","panelSet","mode","mousePosObj","panelPos","x1","x2","y1","y2","dropCoords","dragParentLeft","dragParentTop","snapType","cubeLimit","cubeOuter","detachType","transitionEvent","dropParentCubeCount","dragParentCubeCount","totalCubes","r","c","canBeAddedCubes","remainingCubes","transitionEndCallback","parseInt","detachCubes","warn","isSnapping","dropDotCoord_0","dropDotCoord_1","draggableCubes","dropCoord","0","1","dragCoord","d","flag","startAngle","rotatable","refPoint","R2D","rotate","floor","atan2","transform","angle","_ref","scale","initCalc","calc","buttons","result","num","calculate","buttonType","buttonValue","eval","slice","button","initAbacus","window","onload","mousedown","body","upper_part","a","evt","background","bind","event","lower_part","column_id","boxes","till","state","click"],"mappings":"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","sourcesContent":["/*******************************/\r\n//     HTML elements\r\n/*******************************/\r\nvar cv = document.getElementById('cv');\r\nvar cvOuter = document.getElementById('cvOuter');\r\n\r\n///////////////////////////\r\nvar pointsObj = {};\r\nvar linesss = {};\r\nvar isSetInRange = false;\r\nvar toolDrawingOffset = 50;\r\nvar inRange = false;\r\nvar slope = 0;\r\nvar isDrawingModeOn = false;\r\nvar isStartedInRange = false;\r\nvar nearestLineStarted;\r\nvar nearestLine;\r\n///////////////////////////\r\n\r\n/*******************************/\r\n//     functions - helping\r\n/*******************************/\r\n// returns object length\r\nObject.size = function (obj) {\r\n  var size = 0, key;\r\n  for (key in obj) {\r\n    if (obj.hasOwnProperty(key)) size++;\r\n  }\r\n  return size;\r\n};\r\n\r\nfunction whichTransitionEvent() {\r\n  var t,\r\n    el = document.createElement(\"fakeelement\");\r\n\r\n  var transitions = {\r\n    \"transition\": \"transitionend\",\r\n    \"OTransition\": \"oTransitionEnd\",\r\n    \"MozTransition\": \"transitionend\",\r\n    \"WebkitTransition\": \"webkitTransitionEnd\"\r\n  }\r\n\r\n  for (t in transitions) {\r\n    if (el.style[t] !== undefined) {\r\n      return transitions[t];\r\n    }\r\n  }\r\n}\r\n\r\n// returns 'left' and 'right' position of given element\r\nfunction getElPosition(el) {\r\n  var pos = { left: el.getBoundingClientRect().left, right: el.getBoundingClientRect().top };\r\n  return pos;\r\n}\r\n\r\n// returns the mouse position w.r.t given element\r\nfunction getMousePosition(e, el) {\r\n  var pos = getElPosition(el);\r\n  var point = { x: 0, y: 0 };\r\n  point.x = parseFloat((((e.type == 'touchstart' || e.type == 'touchmove') ? e.touches[0].clientX : e.clientX) - pos.left).toFixed(2));\r\n  point.y = parseFloat((((e.type == 'touchstart' || e.type == 'touchmove') ? e.touches[0].clientY : e.clientY) - pos.right).toFixed(2));\r\n  return point;\r\n}\r\n\r\n///////////////////////////\r\nfunction parseToFloat(number, decimal) {\r\n  return parseFloat(number.toFixed(decimal));\r\n}\r\nfunction getPointsCoordinates() {\r\n  pointsObj = {};\r\n  var set = document.querySelector('#scale');\r\n  var pointsEl = set.querySelectorAll('.point');\r\n  var canvasPosition = getElPosition(cv);\r\n  for (let i = 0; i < pointsEl.length; i++) {\r\n    var pointObj = {\r\n      x: '',\r\n      y: ''\r\n    };\r\n    var cvLeft = canvasPosition.left;\r\n    var cvTop = canvasPosition.right;\r\n    var pointLeft = pointsEl[i].getBoundingClientRect().left;\r\n    var pointTop = pointsEl[i].getBoundingClientRect().top;\r\n    var pointWidth = pointsEl[i].getBoundingClientRect().width;\r\n    var pointHeight = pointsEl[i].getBoundingClientRect().height;\r\n\r\n    pointObj['x'] = parseFloat((pointLeft + (pointWidth / 2) - cvLeft).toFixed(2));\r\n    pointObj['y'] = parseFloat((pointTop + (pointHeight / 2) - cvTop).toFixed(2));\r\n    pointsObj[i + 1] = pointObj;\r\n  }\r\n}\r\nfunction getLines() {\r\n  var pointsLength = Object.size(pointsObj);\r\n  for (let i = 1; i <= pointsLength; i++) {\r\n    var j = (i == pointsLength) ? 1 : i + 1;\r\n    var line = {\r\n      'p1': pointsObj[i],\r\n      'p2': pointsObj[j]\r\n    };\r\n    linesss['l' + i + j] = line;\r\n  }\r\n}\r\nfunction getSlope(line) {\r\n  // m = (y2 - y1) / (x2 - x1)\r\n  var slope = (line.p2.y - line.p1.y) / (line.p2.x - line.p1.x);\r\n  return parseToFloat(slope, 2);\r\n}\r\n// function getLineEquation() {\r\n//   var m = slope;\r\n//   // y - y1 = m (x - x1) || mx - y + y1 - mx1 = 0\r\n//   // return `y-${linesss.l12.p1.y} = ${m} (x-${linesss.l12.p1.x})`;\r\n//   // y - mx = y1 - m*x1\r\n//   return `y - ${m}x = ${linesss.l12.p1.y - (m * linesss.l12.p1.x)}`;\r\n// }\r\nfunction calculatePerpendicularDistFromLine(line, point, m) {\r\n  if (m == Infinity || m == -Infinity) return Math.abs(line.p1.x - point.x);\r\n  return Math.abs((m * point.x - point.y + line.p1.y - m * line.p1.x) / (Math.sqrt(1 + m * m)));\r\n}\r\nfunction checkDrawingSide(currPoint) {\r\n  // to check if point is between parallel lines\r\n  // d = (x−x1)(y2−y1)−(y−y1)(x2−x1)\r\n  var check12 = (currPoint.x - (linesss.l12.p1.x)) * (linesss.l12.p2.y - linesss.l12.p1.y) - (currPoint.y - linesss.l12.p1.y) * (linesss.l12.p2.x - linesss.l12.p1.x);\r\n  var check34 = (currPoint.x - (linesss.l34.p1.x)) * (linesss.l34.p2.y - linesss.l34.p1.y) - (currPoint.y - linesss.l34.p1.y) * (linesss.l34.p2.x - linesss.l34.p1.x);\r\n\r\n  var check23 = (currPoint.x - (linesss.l23.p1.x)) * (linesss.l23.p2.y - linesss.l23.p1.y) - (currPoint.y - linesss.l23.p1.y) * (linesss.l23.p2.x - linesss.l23.p1.x);\r\n  var check41 = (currPoint.x - (linesss.l41.p1.x)) * (linesss.l41.p2.y - linesss.l41.p1.y) - (currPoint.y - linesss.l41.p1.y) * (linesss.l41.p2.x - linesss.l41.p1.x);\r\n\r\n  var isInBtwParallelLines = ((check12 < 0 && check34 < 0) || (check12 > 0 && check34 > 0) || (check23 < 0 && check41 < 0) || (check23 > 0 && check41 > 0)) ? true : false;\r\n\r\n  var line;\r\n  var perpendicularDist;\r\n  var side = '';\r\n  // to check if point lies between parallel lines\r\n  if (isInBtwParallelLines) {\r\n    line = ((check12 < 0 && check34 < 0) || (check12 > 0 && check34 > 0)) ? '12_34' : '23_41';\r\n    // checking nearest line\r\n    if (line == '12_34') {\r\n      slope = getSlope(linesss.l23);\r\n      var d23 = calculatePerpendicularDistFromLine(linesss.l23, currPoint, slope);\r\n      var d41 = calculatePerpendicularDistFromLine(linesss.l41, currPoint, slope);\r\n      if (d23 < d41) {\r\n        perpendicularDist = d23;\r\n        nearestLine = linesss.l23\r\n        side = 'Side 2';\r\n        startPoint = currPoint;\r\n      } else {\r\n        perpendicularDist = d41;\r\n        nearestLine = linesss.l41;\r\n        side = 'Side 4';\r\n      }\r\n    } else {\r\n      slope = getSlope(linesss.l12);\r\n      var d12 = calculatePerpendicularDistFromLine(linesss.l12, currPoint, slope);\r\n      var d34 = calculatePerpendicularDistFromLine(linesss.l34, currPoint, slope);\r\n      if (d12 < d34) {\r\n        perpendicularDist = d12;\r\n        nearestLine = linesss.l12;\r\n        side = 'Side 1';\r\n      } else {\r\n        perpendicularDist = d34;\r\n        nearestLine = linesss.l34\r\n        side = 'Side 3';\r\n      }\r\n    }\r\n    if (toolDrawingOffset >= perpendicularDist) {\r\n      inRange = true;\r\n    } else {\r\n      // make it false if not drawing\r\n      if (!isDrawingModeOn) inRange = false;\r\n    }\r\n  } else {\r\n    if (!isDrawingModeOn) inRange = false;\r\n  }\r\n  // just for debugging\r\n  if (inRange) console.log(side);\r\n}\r\n///////////////////////////\r\n\r\n/*******************************/\r\n//     functions - specific\r\n/*******************************/\r\n// init tools satellite UI and and tool events\r\nvar initTools = (function () {\r\n  // console.log('init')\r\n  var toolsUniverse = document.getElementById('toolsUniverse');\r\n  var toolsPlanets = toolsUniverse.querySelectorAll('.tools-planet');\r\n  var toolsPlanetSets = document.getElementById('toolsPlanetSets');\r\n  var toolsPlanetPens = document.getElementById('toolsPlanetPens');\r\n  var toolsUniverseWidth = toolsUniverse.offsetWidth;\r\n\r\n  var minimizeToggleBtn = document.getElementById('minimizeToggleBtn');\r\n  var toolsPlanetSetsBtn = document.getElementById('toolsPlanetSetsBtn');\r\n  var toolsPlanetPensBtn = document.getElementById('toolsPlanetPensBtn');\r\n\r\n  var currToolType = currSetType = null;\r\n  \r\n  // draw satellite circles\r\n  toolsPlanets.forEach(function (toolsPlanet) {\r\n    var toolsSatellites = toolsPlanet.querySelectorAll('#' + toolsPlanet.id + '>.tools-satellite.primary');\r\n    var toolsSatellitesWidth = toolsPlanet.querySelector('.tools-satellite:first-child').offsetWidth;\r\n    var toolsPlanetWidth = toolsPlanet.offsetWidth;\r\n    var totaltoolsSatellites = toolsSatellites.length;\r\n    // var rotation = 360 / totaltoolsSatellites;\r\n    var rotation = 30;\r\n    // var radius = (toolsUniverseWidth - toolsSatellitesWidth) / 2;\r\n    var radius = 110;\r\n    var totalOffset = (toolsPlanetWidth - toolsSatellitesWidth) / 2;\r\n    // var totalOffset = 60;\r\n\r\n    toolsSatellites.forEach(function (toolsSatellite, i) { // place primary tools\r\n      var n = i - 3; // to start from top side instead of rigth side\r\n      var x = Math.round(Math.cos((rotation * n) * (Math.PI / 180)) * radius);\r\n      var y = Math.round(Math.sin((rotation * n) * (Math.PI / 180)) * radius);\r\n      var left = Math.round(x + totalOffset);\r\n      var top = Math.round(y + totalOffset);\r\n      toolsSatellite.style.left = left + \"px\";\r\n      toolsSatellite.style.top = top + \"px\";\r\n      \r\n      if (toolsSatellite.classList.contains('has-child')) { // place secondary tools if any\r\n        let toolGroupType = toolsSatellite.dataset.toolGroupType;\r\n        let toolsSatellites = toolsPlanet.querySelectorAll('[data-tool-group-type=\"' + toolGroupType + '\"].secondary');\r\n        let rotation = 19;\r\n        let radius = 165;\r\n\r\n        toolsSatellites.forEach(function (toolsSatellite, i) {\r\n          let n = i - 4.5;\r\n\r\n          switch (toolGroupType) {\r\n            case \"pastel1\": n = i + .7; \r\n              break;\r\n            case \"pastel2\": n = i + 2.2; \r\n              break;\r\n            case \"stroke\": n = i + 3.8;\r\n              break;\r\n            case \"opacity\": n = i + 5.2; \r\n              break;\r\n            case \"scale\": n = i - 4.5; \r\n              break;\r\n          }\r\n\r\n          let y = Math.sin((rotation * n) * (Math.PI / 180)) * radius;\r\n          let x = Math.cos((rotation * n) * (Math.PI / 180)) * radius;\r\n          toolsSatellite.style.top = (y + totalOffset).toString() + \"px\";\r\n          toolsSatellite.style.left = (x + totalOffset).toString() + \"px\";\r\n        })\r\n      }\r\n    });\r\n  });\r\n  // add 'active' class to one of the 'tools-planet'\r\n  toolsPlanetSets.classList.add('active');\r\n  toolsPlanetSetsBtn.classList.add('active');\r\n  toolsPlanetSetsBtn.classList.add('temp-active');\r\n\r\n  var clickHandler = function(e) {\r\n    // console.log(e.target.dataset);\r\n\r\n    var target = e.target;\r\n    var id = target.id;\r\n    var toolType1 = target.dataset.toolType1; // pen, marker, eraser\r\n    var toolType2 = target.dataset.toolType2; // pastels 1-4\r\n    var toolGroupType = target.dataset.toolGroupType;\r\n    var isPrimary = target.classList.contains('primary');\r\n    var isSecondary = target.classList.contains('secondary');\r\n    var ispanelBtn = target.dataset.panelBtn;\r\n\r\n    if (id == \"minimizeToggleBtn\") {\r\n      if (document.querySelector('.tools-planet.active')) {\r\n        minimizeToggleBtn.classList.add('active');\r\n        toolsUniverse.classList.remove('active');\r\n        toolsPlanetSetsBtn.classList.remove('active');\r\n        toolsPlanetPensBtn.classList.remove('active');\r\n        document.querySelector('.tools-planet.active').classList.add('temp-active');\r\n        document.querySelector('.tools-planet.active').classList.remove('active');\r\n      } else {\r\n        toolsUniverse.classList.add('active');\r\n        minimizeToggleBtn.classList.remove('active');\r\n        document.querySelector('.tools-toggle .temp-active').classList.add('active');\r\n        document.querySelector('.tools-planet.temp-active').classList.add('active');\r\n        document.querySelector('.tools-planet.temp-active').classList.remove('temp-active');\r\n      }\r\n    } else if (id == \"toolsPlanetPensBtn\") {\r\n      toolsPlanetSetsBtn.classList.remove('active');\r\n      toolsPlanetSetsBtn.classList.remove('temp-active');\r\n      toolsPlanetSets.classList.remove('active');\r\n\r\n      toolsPlanetPensBtn.classList.add('active');\r\n      toolsPlanetPensBtn.classList.add('temp-active');\r\n      toolsPlanetPens.classList.add('active');\r\n      toolsUniverse.classList.add('active');\r\n      \r\n      minimizeToggleBtn.classList.remove('active');\r\n    } else if (id == \"toolsPlanetSetsBtn\") {\r\n      toolsPlanetPensBtn.classList.remove('active');\r\n      toolsPlanetPensBtn.classList.remove('temp-active');\r\n      toolsPlanetPens.classList.remove('active');\r\n\r\n      toolsPlanetSetsBtn.classList.add('active');\r\n      toolsPlanetSetsBtn.classList.add('temp-active');\r\n      toolsPlanetSets.classList.add('active');\r\n      toolsUniverse.classList.add('active');\r\n      \r\n      minimizeToggleBtn.classList.remove('active');\r\n    } else if (id == 'undo') {\r\n      initDraw.undo();\r\n    } else if (id == 'redo') {\r\n      initDraw.redo();\r\n    } else if (id == 'clear') {\r\n      initDraw.clear();\r\n    } else if(toolType1) {\r\n      updateToolType1(target);\r\n    } else if(toolType2) {\r\n      updateToolType2(target);\r\n    } else if(ispanelBtn) {\r\n      initPanel.toggle(target);\r\n    }\r\n    if(toolGroupType) {\r\n      updateToolsGroup(toolGroupType, target, isPrimary, isSecondary);\r\n    }\r\n  }\r\n\r\n  // // pen, marker, eraser\r\n  var updateToolType1 = function(target) {\r\n    // console.log('updateToolType1');\r\n\r\n    // remove 'active' class from previous 'active' button\r\n    // and make 'currToolType' null\r\n    var oldToolBtn = document.querySelector('#toolsPlanetPens [data-tool-type1].active');\r\n    if (oldToolBtn) {\r\n      oldToolBtn.classList.remove('active');\r\n      initTools.currToolType = null;\r\n      cv.removeEventListener('mousedown', initDraw.drawStart, false);\r\n    }\r\n    // add 'active' class to current 'clicked' button if it is not the 'active' button already\r\n    // and update 'currToolType' value\r\n    if(oldToolBtn != target) {\r\n      target.classList.add('active');\r\n      initTools.currToolType = target.dataset.toolType1;\r\n      cv.addEventListener('mousedown', initDraw.drawStart, false);\r\n    }\r\n  }  \r\n\r\n  // four pastels buttons\r\n  var updateToolType2 = function(target) {\r\n      // console.log('updateToolType2')\r\n      \r\n      // remove 'active' class from previous 'active' button\r\n      var oldToolBtn = document.querySelector('#toolsPlanetPens [data-tool-type2].active');\r\n      if (oldToolBtn && oldToolBtn != target) {\r\n        oldToolBtn.classList.remove('active');\r\n        target.classList.add('active');\r\n      }\r\n\r\n      initDraw.strokeColor = target.dataset.value;\r\n  }\r\n\r\n  // handling of satellite buttons which has childrens\r\n  var updateToolsGroup = function(toolGroupType, target, isPrimary, isSecondary) {\r\n    // console.log('updateToolsGroup');\r\n\r\n    if(isPrimary) { \r\n      // console.log('isPrimary')\r\n\r\n      // remove 'show-child' class if present\r\n      if(target.classList.contains('show-child')) {\r\n        target.classList.remove('show-child')\r\n      } else { // add 'show-child' on clicked element before that remove from other element if present\r\n        if(document.querySelector('.has-child.show-child')) {\r\n          document.querySelector('.has-child.show-child').classList.remove('show-child');\r\n        }        \r\n        target.classList.add('show-child');\r\n      }  \r\n    } else if(isSecondary) {\r\n      // console.log('isSecondary');\r\n\r\n      var parent = document.querySelector('[data-tool-group-type=\"' + toolGroupType + '\"].primary');\r\n      var oldToolBtn = document.querySelector('[data-tool-group-type=\"' + toolGroupType + '\"].secondary.active');\r\n\r\n      // make pastel group behave like first two pastel buttons\r\n      if(toolGroupType.substr(0, 6) == 'pastel') {\r\n        document.querySelector('[data-tool-type2].primary.active').classList.remove('active');\r\n        parent.setAttribute('data-tool-type2', 'pastel');\r\n        toolGroupType = \"pastel\";\r\n      }        \r\n\r\n      // remove 'active' class from old child having 'active' class\r\n      if(oldToolBtn) {\r\n        oldToolBtn.classList.remove('active');\r\n      }\r\n      \r\n      target.classList.add('active');\r\n      parent.classList.add('active');\r\n      parent.classList.remove('show-child');\r\n      \r\n      switch(toolGroupType) {\r\n        case \"opacity\": initDraw.strokeOpacity = parseFloat(target.dataset.value);\r\n        break;\r\n        case \"stroke\": initDraw.strokeWidth = parseFloat(target.dataset.value);\r\n        break;\r\n        case \"pastel\": \r\n          var src = target.querySelector('img').getAttribute('src');\r\n          parent.querySelector('img').setAttribute('src', src);\r\n          parent.setAttribute('data-value', target.dataset.value)\r\n          initDraw.strokeColor = target.dataset.value;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  \r\n  // click listener on tools\r\n  toolsUniverse.addEventListener('click', clickHandler, false);  \r\n\r\n  return {\r\n    currToolType: currToolType,\r\n    currSetType: currSetType\r\n  }\r\n})();\r\n\r\n// draw, undo, redo, clear functions\r\nvar initDraw = (function () {\r\n  // console.log('initDraw');\r\n\r\n  // initial stroke properties from HTML elements\r\n  var strokeOpacityEl = document.querySelector('[data-tool-group-type=\"opacity\"].secondary.active');\r\n  var strokeOpacity = parseFloat(strokeOpacityEl.dataset.value);\r\n\r\n  var strokeWidthEl = document.querySelector('[data-tool-group-type=\"stroke\"].secondary.active');\r\n  var strokeWidth = parseFloat(strokeWidthEl.dataset.value);\r\n\r\n  var strokeColorEl = document.querySelector('[data-tool-type2=\"pastel\"].primary.active');\r\n  var strokeColor = strokeColorEl.dataset.value;\r\n\r\n  var currId = null;\r\n  var index = 0;\r\n  var startPoint;\r\n  var currPoint;\r\n  var undoStack = [];\r\n  var redoStack = [];  \r\n\r\n  // Undo last action\r\n  var Undo = function() {\r\n    // console.log('undo');\r\n    if (undoStack.length > 0) {\r\n      var lastAction = undoStack.pop();\r\n      var ele, clearedEles;\r\n      switch (lastAction.Action) {\r\n        case 'draw':\r\n          ele = document.getElementById(lastAction.Id);\r\n          lastAction.Elements.push(ele);\r\n          ele.parentNode.removeChild(ele);\r\n          break;\r\n        case 'erase':\r\n          cv.appendChild(lastAction.Elements[0]);\r\n          break;\r\n        case 'clear':\r\n          clearedEles = lastAction.Elements;\r\n          clearedEles.forEach(function (shape) {\r\n            cv.appendChild(shape);\r\n            index++;\r\n          });\r\n          break;\r\n      }\r\n      redoStack.push(lastAction);\r\n    }\r\n  }\r\n\r\n  // Redo last undoed action \r\n  var Redo = function() {\r\n    // console.log('redo');\r\n    if (redoStack.length > 0) {\r\n      var lastAction = redoStack.pop();\r\n      var ele;\r\n      switch (lastAction.Action) {\r\n        case 'draw':\r\n          ele = lastAction.Elements[0];\r\n          cv.appendChild(ele);\r\n          break;\r\n        case 'erase':\r\n          ele = lastAction.Elements[0];\r\n          ele.parentNode.removeChild(ele);\r\n          break;\r\n        case 'clear':\r\n          lastAction.Elements.forEach(function (ele) {\r\n            ele.parentNode.removeChild(ele);\r\n          });\r\n          break;\r\n      }\r\n      undoStack.push(lastAction);\r\n    }\r\n  }\r\n\r\n  // clears everything\r\n  var Clear = function() {\r\n    // console.log('clear')\r\n    index = 0;\r\n    var clearedEles = document.querySelectorAll('.drawing');\r\n    redoStack = [];\r\n    undoStack.push({\r\n      Elements: clearedEles,\r\n      Id: null,\r\n      Action: 'clear'\r\n    });\r\n    cv.innerHTML = \"\";\r\n  }\r\n\r\n  // start drawing or erasing\r\n  var drawStart = function(e) {\r\n    // console.log('drawStart')\r\n    e.preventDefault();\r\n\r\n    var strokeOpacity = initDraw.strokeOpacity;\r\n\r\n    var strokeColorPen = initDraw.strokeColor;\r\n    var strokeWidthPen = initDraw.strokeWidth;\r\n\r\n    var strokeColorMarker = 'rgba(0, 255, 0, .5)';\r\n    var strokeWidthMarker = initDraw.strokeWidth + 10;\r\n\r\n    var polylineTag;    \r\n    var currToolType = initTools.currToolType;\r\n  \r\n    var currPoint = getMousePosition(e, cv);\r\n    currId = 'shape' + index;\r\n\r\n    ///////////////////////////\r\n    isDrawingModeOn = true;\r\n    getPointsCoordinates();\r\n    getLines();\r\n    checkDrawingSide(currPoint);\r\n    if (inRange) {\r\n      isStartedInRange = true;\r\n      nearestLineStarted = nearestLine;\r\n    } else {\r\n      isStartedInRange = false;\r\n    }\r\n    ///////////////////////////\r\n\r\n    if(currToolType == \"pen\" || currToolType == \"marker\") {\r\n      if(currToolType == \"pen\") {\r\n        polylineTag = '<polyline class=\"drawing\" id=\"' + currId + '\" style=\"opacity:'+strokeOpacity+';fill:none;stroke-linecap:round;stroke:' + strokeColorPen + ';stroke-width:' + strokeWidthPen + '\" points=\"' + currPoint.x + ',' + currPoint.y + '\" />';;\r\n      } else if(currToolType == \"marker\") {\r\n        polylineTag = '<polyline class=\"drawing\" id=\"' + currId + '\" style=\"fill:none;stroke-linecap:round;stroke:' + strokeColorMarker + ';stroke-width:' + strokeWidthMarker + '\" points=\"' + currPoint.x + ',' + currPoint.y + '\" />';;\r\n      }\r\n      cv.innerHTML += polylineTag;\r\n    }\r\n\r\n    cv.addEventListener('mousemove', draw, false);\r\n    cv.addEventListener('mouseup', drawEnd, false);\r\n\r\n    index++;\r\n    startPoint = currPoint;\r\n  }\r\n\r\n  // keep drawing or erasing\r\n  var draw = function (e) {\r\n    // console.log('draw')\r\n    e.preventDefault();\r\n\r\n    var currToolType = initTools.currToolType;\r\n    var currPoint = getMousePosition(e, cv);\r\n    var polyline, points;\r\n\r\n    ///////////////////////////\r\n    var x, y;\r\n    ///////////////////////////\r\n\r\n    if (currToolType == \"pen\" || currToolType == \"marker\") {\r\n      polyline = document.getElementById(currId);\r\n      points = polyline.getAttribute('points');\r\n\r\n      if (currToolType == \"marker\") {\r\n        points = startPoint.x + ',' + startPoint.y + ' ' + currPoint.x + ',' + currPoint.y;\r\n      } else if (currToolType == \"pen\") {\r\n\r\n        ///////////////////////////\r\n        if (isStartedInRange) {\r\n          if (nearestLineStarted != nearestLine) {\r\n            nearestLineStarted = nearestLine;\r\n            // startPoint = currPoint;\r\n            console.log('side updated')\r\n          }\r\n          checkDrawingSide(currPoint);\r\n        }\r\n        ///////////////////////////\r\n\r\n        if (inRange) { // drawing with set\r\n          var m = slope;\r\n          // console.log('inRange')\r\n          // y = m (x - x1) + y1\r\n          // y = m (x - x2) + y2\r\n          // console.log('Eq1: ', `y = ${slope}(x - ${startPoint.x}) + ${startPoint.y}`)\r\n          // console.log('Eq2: ', `y = ${-1/slope}(x - ${currPoint.x}) + ${currPoint.y}`)\r\n          // x coordinate of intersection of two lines\r\n          // var x = (m * (y2 - y1) + m * m * x1 - x2) / ((m * m) + m)\r\n          if (m == 0) {\r\n            x = currPoint.x;\r\n            y = startPoint.y;\r\n            console.log('111111111')\r\n          } else if (m == Infinity || m == -Infinity) {\r\n            x = startPoint.x;\r\n            y = currPoint.y;\r\n            console.log('2222222222')\r\n          } else {\r\n            console.log('3333333333')\r\n            x = ((currPoint.x / m) + (m * startPoint.x) + currPoint.y - startPoint.y) / (m + (1 / m));\r\n            y = 1 * (m * (x - startPoint.x) + startPoint.y);\r\n          }\r\n          points += ' ' + x + ',' + y;\r\n        } else { // simple drawing\r\n          points += ' ' + currPoint.x + ',' + currPoint.y;\r\n        }\r\n      }\r\n      polyline.setAttribute('points', points);\r\n    } else if (currToolType == \"eraser\") {\r\n      var target = e.target;\r\n      if (target.classList.contains('drawing')) {\r\n        redoStack = [];\r\n        undoStack.push({\r\n          Elements: [target],\r\n          Id: target.id,\r\n          Action: 'erase'\r\n        });\r\n        target.remove();\r\n      }\r\n    }\r\n\r\n    cv.addEventListener('mouseleave', drawEnd, false);\r\n  }\r\n\r\n  // stop drawing or erasing\r\n  var drawEnd = function() {\r\n    // console.log('drawEnd')\r\n\r\n    if (currId !== null && document.getElementById(currId) != null) {\r\n      undoStack.push({\r\n        Elements: [],\r\n        Id: currId,\r\n        Action: 'draw'\r\n      });\r\n    }\r\n\r\n    cv.removeEventListener('mousemove', draw, false);\r\n    cv.removeEventListener('mouseup', drawEnd, false);\r\n    cv.removeEventListener('mouseleave', drawEnd, false);\r\n  }\r\n\r\n  return {\r\n    undo: Undo,\r\n    redo: Redo,\r\n    clear: Clear,\r\n    strokeOpacity: strokeOpacity,\r\n    strokeWidth: strokeWidth,\r\n    strokeColor: strokeColor,\r\n    drawStart: drawStart\r\n  }  \r\n})();\r\n\r\n// move behaviour of elements - tools/panels/sets\r\nvar initMove = (function() {\r\n  var startX = 0, startY = 0, endX = 0, endY = 0;\r\n  var dragParentzIndex = 0; // update only if drag parent is different each dragging time\r\n  var dragParent = dropParent = oldDragParent = null;\r\n\r\n  var init = function(draggable, listener) {\r\n    // console.log('init drag')\r\n\r\n    var dragAreas = draggable.querySelectorAll('.drag-area');\r\n    \r\n    if(listener == \"add\") { // ADD EVENT LISTENERS\r\n      // console.log('adding')\r\n\r\n      \r\n      if (dragAreas.length > 0) { // if `dragArea` is available, use that to drag\r\n        // if(draggable.classList.contains('drag-area')) {\r\n        //   draggable.addEventListener('mousedown', start, false);\r\n        // }\r\n        dragAreas.forEach(function (dragArea) {\r\n          dragArea.addEventListener('mousedown', start, false);\r\n        })\r\n      } else { // otherwise move the element anywhere from with in element\r\n        draggable.addEventListener('mousedown', start, false);\r\n      }    \r\n    } else if(listener == \"remove\") { // REMOVE EVENT LISTENERS\r\n      // console.log('removing')\r\n      if (dragAreas.length > 0) {\r\n        dragAreas.forEach(function (dragArea) {\r\n          dragArea.removeEventListener('mousedown', start, false);\r\n        })\r\n      } else {\r\n        draggable.removeEventListener('mousedown', start, false);\r\n      }    \r\n    }\r\n  }\r\n\r\n  var start = function(e) {\r\n    // console.log('moveStart');\r\n\r\n    var currPoint = getMousePosition(e, cv);\r\n    initMove.dragParent = e.target.closest('.draggable');\r\n    var dragParent = initMove.dragParent;\r\n    // var oldDragParent = initMove.oldDragParent;\r\n    \r\n    // drag only if current element has class 'drag-area'\r\n    if (e.target.classList.contains('drag-area')) {\r\n      // if(e.target.closest('.drag-area')) {\r\n\r\n      cvOuter.classList.add('dragging');\r\n      \r\n      startX = currPoint.x;\r\n      startY = currPoint.y;\r\n        \r\n      if(dragParent != initMove.oldDragParent) {\r\n        dragParent.style.zIndex = ++initMove.dragParentzIndex;\r\n      } \r\n      initMove.oldDragParent = initMove.dragParent;\r\n\r\n      // get coordinates of nearby draggable cubes\r\n      if (dragParent.classList.contains('draggable-cubes')) {\r\n        initCubes.getCoords();\r\n      }\r\n\r\n      cvOuter.addEventListener('mousemove', move, false);\r\n      cvOuter.addEventListener('mouseup', end, false);\r\n      dragParent.addEventListener('dragstart', initDrag.start, false);\r\n    }\r\n\r\n    \r\n    // bring TRASH can on top if sealType is present\r\n    if(dragParent.dataset.sealType) {\r\n      initPanel.trashPanel(e, 'start', dragParent.dataset.sealType);\r\n    }  \r\n  }\r\n\r\n  var move = function(e) {\r\n    // console.log('move')\r\n    e.preventDefault();\r\n\r\n    var currPoint = getMousePosition(e, cv);\r\n    var dragParent = initMove.dragParent;\r\n\r\n    // calculate the new cursor position:\r\n    endX = startX - currPoint.x;\r\n    endY = startY - currPoint.y;\r\n    startX = currPoint.x;\r\n    startY = currPoint.y;\r\n\r\n    // set the element's new position:\r\n    dragParent.style.left = (dragParent.offsetLeft - endX) + \"px\";\r\n    if(dragParent == toolsUniverse) {\r\n      var H = cvOuter.getBoundingClientRect().height;\r\n      var h = dragParent.getBoundingClientRect().height;\r\n      var o = dragParent.offsetTop;\r\n      var offsetBottom = H - h - o;\r\n      dragParent.style.bottom = (offsetBottom + endY) + \"px\";\r\n    } else {\r\n      dragParent.style.top = (dragParent.offsetTop - endY) + \"px\";\r\n    }\r\n\r\n    // highligh if 'draggable-cube' is in range\r\n    if (dragParent.classList.contains('draggable-cubes')) {\r\n      // initCubes.isSnapping = true;\r\n      initCubes.getShortestDist();\r\n      // highlight groups accordingly\r\n      if (initCubes.shortestDist != null) {\r\n        if (initCubes.shortestDist < initCubes.snapDist) {\r\n          initCubes.highlight(true);\r\n        } else {\r\n          initCubes.highlight(false);\r\n        }\r\n      }\r\n    }  \r\n\r\n    // highlight TRASH cubes if mouse is in\r\n    if(dragParent.dataset.sealType) {\r\n      initPanel.trashPanel(e, 'move');\r\n    }  \r\n  }\r\n\r\n  var end = function(e) {\r\n    // console.log('moveEnd')\r\n    e.preventDefault();\r\n\r\n    var dragParent = initMove.dragParent;\r\n\r\n    cvOuter.classList.remove('dragging');\r\n\r\n    // snap cubes if in range\r\n    if (dragParent.classList.contains('draggable-cubes')) {\r\n      if (initCubes.shortestDist != null && initCubes.shortestDist < initCubes.snapDist) {\r\n        initCubes.snap();\r\n        initCubes.shortestDist = null;\r\n      }\r\n    }\r\n    // initCubes.isSnapping = false;\r\n\r\n    // delete dragParent if dropped on TRASH panel\r\n    if(dragParent.dataset.sealType) {\r\n      if(initPanel.trashPanel(e, 'end')) { \r\n        dragParent.remove();\r\n      }\r\n    }  \r\n\r\n    cvOuter.removeEventListener('mousemove', move, false);\r\n    cvOuter.removeEventListener('mouseup', end, false);\r\n    dragParent.removeEventListener('dragstart', initDrag.start, false);\r\n  }\r\n\r\n  init(toolsUniverse, 'add');\r\n\r\n  return {\r\n    dragParentzIndex: dragParentzIndex,\r\n    dragParent: dragParent,\r\n    dropParent: dropParent,\r\n    oldDragParent: oldDragParent,\r\n    init: init\r\n  }\r\n})();\r\n\r\n// drag behaviour of seals - cubes/money/numbers/flowers\r\nvar initDrag = (function () {\r\n  var dragEloffsetX, dragEloffsetY;\r\n  var draggablesId = 0;\r\n  var dropElHeight = 0;\r\n  var dragParent = null;\r\n\r\n  var start = function(e) {\r\n    // console.log('dragStart');\r\n\r\n    dragEloffsetX = e.offsetX;\r\n    dragEloffsetY = e.offsetY;\r\n    e.dataTransfer.setData(\"src\", e.target.src);\r\n    e.dataTransfer.setData(\"width\", e.target.getBoundingClientRect().width);\r\n    e.dataTransfer.setData(\"height\", e.target.getBoundingClientRect().height);\r\n    e.dataTransfer.setData(\"sealType\", e.target.dataset.sealType);\r\n    \r\n    cvOuter.addEventListener('dragenter', enter, false);\r\n    cvOuter.addEventListener('dragleave', leave, false);\r\n    cvOuter.addEventListener('dragover', over, false);\r\n    cvOuter.addEventListener('drop', drop, false);\r\n  }\r\n  var enter = function(e) { e.preventDefault(); }\r\n  var leave = function(e) { e.preventDefault(); }\r\n  var over = function(e) {\r\n    e.preventDefault();\r\n    cvOuter.classList.add('dropping');\r\n  }\r\n  var drop = function(e) {\r\n    // console.log('drop');\r\n    e.preventDefault();\r\n\r\n    var sealType = e.dataTransfer.getData('sealType');\r\n    var src = e.dataTransfer.getData('src');\r\n    var width = e.dataTransfer.getData('width');\r\n    var height = e.dataTransfer.getData('height');\r\n\r\n    cvOuter.classList.remove('dropping');\r\n\r\n    var totalSealsAllowed = sealTypes[sealType]['max'];\r\n    var totalSealsPlaced = document.querySelectorAll('[data-seal-type=\"' + sealType + '\"].dropped-seal').length;\r\n\r\n    if (totalSealsPlaced < totalSealsAllowed) {\r\n      var draggable;\r\n      if (sealType == \"cubes\") { // generate new draggable group\r\n        draggable = document.createElement('div');\r\n        // <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width-50}px; height: ${height-50}px;\"></div>\r\n        draggable.classList.add('draggable-cubes');\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n        draggable.innerHTML = `\r\n          <div class=\"cube-outer drag-area\" data-index=\"0\" data-seal-type=\"${sealType}\">\r\n            <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          </div>\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>\r\n          `;\r\n\r\n          draggable.addEventListener('dblclick', initCubes.detach, false);\r\n        } else { // generate a seal\r\n        draggable = document.createElement('img');\r\n        draggable.src = src;\r\n        draggable.width = width;\r\n        draggable.height = height;\r\n        draggable.classList.add('dropped-seal');\r\n        draggable.classList.add('drag-area');\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n\r\n        draggable.addEventListener('dblclick', (e) => { draggable.remove(); }, false);\r\n      }\r\n\r\n      draggable.setAttribute('data-id', ++initDrag.draggablesId);\r\n      draggable.style.zIndex = ++initMove.dragParentzIndex;\r\n      draggable.style.left = e.offsetX - dragEloffsetX + 'px';\r\n      draggable.style.top = e.offsetY - dragEloffsetY + 'px';\r\n      draggable.classList.add('draggable');\r\n      \r\n      cvOuter.appendChild(draggable);\r\n\r\n      initDrag.dropElHeight = draggable.getBoundingClientRect().height;\r\n\r\n      initMove.init(draggable, 'add');\r\n\r\n      cvOuter.removeEventListener('dragenter', enter)\r\n      cvOuter.removeEventListener('dragleave', leave)\r\n      cvOuter.removeEventListener('dragover', over)\r\n      cvOuter.removeEventListener('drop', drop)\r\n    } else {\r\n      alert('You can only place max ' + totalSealsAllowed + ' of ' + sealType + ' seal type.');\r\n    }\r\n  }\r\n\r\n  return {\r\n    start: start,\r\n    draggablesId: draggablesId,\r\n    dropElHeight: dropElHeight\r\n  }\r\n})();\r\n\r\n// fetch seals from 'settings.json' file\r\nvar fetchSeals = (function () {\r\n  // console.log('fetching seals');\r\n\r\n  for (var sealType in sealTypes) {\r\n    var sealPanelContent = document.querySelector('[data-panel=\"' + sealType + '\"] .content');\r\n    if (sealTypes.hasOwnProperty(sealType)) {\r\n      var values = sealTypes[sealType].values;\r\n      values.forEach(value => {\r\n        var el = document.createElement('img');\r\n        el.classList.add('draggable-seal');\r\n        el.setAttribute('data-seal-type', sealType);\r\n        el.src = './_assets/img/' + value;\r\n        sealPanelContent.appendChild(el);\r\n      });\r\n    }\r\n  }\r\n})();\r\n\r\n// init panel functions - open/close/drag-panel/drag-seals\r\nvar initPanel = (function (e) {\r\n  var panel = oldPanel = panelType = panelBtn = panelPosObj = \r\n      panelCloseBtn = panelScaleBtn = draggableSeals = rotateBtns = null;\r\n\r\n  var toggle = function(target) {\r\n    panelType = target.dataset.panelBtn;\r\n    \r\n    // open panel\r\n    if (!target.classList.contains('active')) {\r\n      // console.log('open panel');\r\n\r\n      panel = document.querySelector('[data-panel=\"' + panelType + '\"]');\r\n      panelCloseBtn = panel.querySelector('.close-btn');\r\n      panelScaleBtn = panel.querySelector('.scale-btn');\r\n      rotateBtns = panel.querySelectorAll('.rotate-btn');\r\n      draggableSeals = panel.getElementsByClassName('draggable-seal');\r\n\r\n      target.classList.add('active');\r\n      panel.classList.add('active');\r\n      panel.style.zIndex = ++initMove.dragParentzIndex;\r\n\r\n      initMove.dragParent = panel;\r\n      initMove.oldDragParent = panel;\r\n\r\n      // ADD EVENT LISTENERS\r\n      panel.addEventListener('click', bringInFront, false);\r\n      panelCloseBtn.addEventListener('click', close, false);\r\n      initMove.init(panel, 'add');\r\n      for (var i = 0; i < draggableSeals.length; i++) {\r\n        draggableSeals[i].addEventListener('dragstart', initDrag.start, false);\r\n      }\r\n      if (rotateBtns.length > 0) {\r\n        rotateBtns.forEach(rotateBtn => {\r\n          rotateBtn.addEventListener('mousedown', initRotate.start, false);\r\n        });\r\n      }\r\n      if(panelScaleBtn) {\r\n        panelScaleBtn.addEventListener('mousedown', initScale.start, false);\r\n      }\r\n\r\n      // update current geometry set type\r\n      if (panel.dataset.panelSet) {\r\n        currSetType = panel.dataset.panelSet;\r\n      }\r\n    } else { // close panel if already open\r\n      close(panelType);\r\n    }\r\n  }\r\n  var close = function(e) {\r\n    // console.log('close panel')\r\n\r\n    // clicked on closed button and 'type' property exist\r\n    if(e.type) {\r\n      panel = this.closest('.draggable');\r\n      panelType = panel.dataset.panel;\r\n    } else { // clicked on panel btn itself and called 'closePanel' function so 'e.type' not defined\r\n      panelType = e;\r\n      panel = document.querySelector('[data-panel=\"' + panelType + '\"]');;\r\n    }\r\n    panelBtn = document.querySelector('[data-panel-btn=\"' + panelType + '\"]');\r\n    panelCloseBtn = panel.querySelector('.close-btn');\r\n    panelScaleBtn = panel.querySelector('.scale-btn');\r\n\r\n    draggableSeals = panel.getElementsByClassName('draggable-seal');\r\n    panel.classList.remove('active');\r\n    panelBtn.classList.remove('active');\r\n    rotateBtns = panel.querySelectorAll('.rotate-btn');\r\n\r\n    // REMOVE EVENT LISTENERS\r\n    panel.removeEventListener('click', bringInFront, false);\r\n    panelCloseBtn.removeEventListener('click', close, false);\r\n    initMove.init(panel, 'remove');\r\n    for (var i = 0; i < draggableSeals.length; i++) {\r\n      draggableSeals[i].removeEventListener('dragstart', initDrag.start, false);\r\n    }\r\n    if (rotateBtns.length > 0) {\r\n      rotateBtns.forEach(rotateBtn => {\r\n        rotateBtn.removeEventListener('mousedown', initRotate.start, false);\r\n      });\r\n    }\r\n    if (panelScaleBtn) {\r\n      panelScaleBtn.removeEventListener('mousedown', initScale.start, false);\r\n    }\r\n\r\n    // update current geometry set type to null\r\n    if (panel.dataset.panelSet) {\r\n      currSetType = null;\r\n    }    \r\n  }\r\n  var bringInFront = function(e) {\r\n    panel = this.closest('.draggable');\r\n\r\n    if(oldPanel != panel) {\r\n      panel.style.zIndex = ++initMove.dragParentzIndex;\r\n    }\r\n    oldPanel = panel;\r\n  }\r\n  var trashPanel = function(e, mode, sealType) {\r\n    var mousePosObj = getMousePosition(e, cv);\r\n    \r\n    // bring trash can on top if draggin cubes\r\n    if(mode == \"start\") {\r\n      panel = document.querySelector('[data-panel=\"'+sealType+'\"]');\r\n      var panelPos = panel.getBoundingClientRect();\r\n      panelPosObj  = {\r\n        x1: panelPos.left,\r\n        x2: panelPos.left + panelPos.width,\r\n        y1: panelPos.top,\r\n        y2: panelPos.top + panelPos.height\r\n      }\r\n      panel.style.zIndex = initMove.dragParentzIndex;\r\n      panel.classList.add('trash');\r\n    }\r\n\r\n    // highlight trash cubes if mouse is in\r\n    if(mousePosObj.x > panelPosObj.x1 && mousePosObj.x < panelPosObj.x2 &&\r\n      mousePosObj.y > panelPosObj.y1 && mousePosObj.y < panelPosObj.y2) {\r\n      panel.classList.add('trash-active');\r\n    } else {\r\n      panel.classList.remove('trash-active');\r\n    }\r\n\r\n    // delete dragParent if dropped on trash panel\r\n    if(mode == 'end') {\r\n      panel.classList.remove('trash')\r\n      if(panel.classList.contains('trash-active')) {\r\n        panel.classList.remove('trash-active')\r\n        return true;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    toggle: toggle,\r\n    trashPanel: trashPanel\r\n  }\r\n})();\r\n\r\n// cubes - highlighting/snapping/detaching\r\nvar initCubes = (function (e) {\r\n  var dropCoords = {};\r\n  var isSnapping = false; // REMOVE LATER IF NOT REQUIRED\r\n  var snapDist = 40;\r\n  var snapInfo = { i: 0, j: 0, id: '' };\r\n  var row = 3;\r\n  var col = 3; \r\n  var dragParentLeft = dragParentTop = shortestDist = snapType = dragParent = dropParent = cubeLimit = cubeOuter = null;\r\n  var detachType = null;\r\n\r\n  // wrt dragParent\r\n  // 0 == top | 1 == bottom\r\n  // 0 == left | 1 == right\r\n  var getCoords = function() {\r\n    // console.log('geting Coordingates');\r\n\r\n    dragParent = initMove.dragParent;\r\n\r\n    snapType = (dragParent.classList.contains('vertical')) ? 'horizontal' : 'vertical';\r\n    detachType = (dragParent.classList.contains('horizontal')) ? 'horizontal' : 'vertical';\r\n    dropCoords = {};\r\n    var dropDotCoord_0 = dropDotCoord_1 = null;\r\n\r\n    var draggableCubes = document.querySelectorAll('.draggable-cubes');\r\n\r\n\r\n    for (let i = 0; i < draggableCubes.length; i++) {\r\n      if (draggableCubes[i] == dragParent) { continue; }\r\n\r\n      if (snapType == 'vertical') {\r\n        // console.log('vertical snapping')\r\n        dropDotCoord_0 = draggableCubes[i].querySelector('.dot-top').getBoundingClientRect();\r\n        dropDotCoord_1 = draggableCubes[i].querySelector('.dot-bottom').getBoundingClientRect();\r\n      } else {\r\n        // console.log('horizontal snapping')\r\n        dropDotCoord_0 = draggableCubes[i].querySelector('.dot-left').getBoundingClientRect();\r\n        dropDotCoord_1 = draggableCubes[i].querySelector('.dot-right').getBoundingClientRect();\r\n      }\r\n      var id = draggableCubes[i].dataset.id;\r\n\r\n      var dropCoord = {\r\n        0: {\r\n          x: dropDotCoord_0.x,\r\n          y: dropDotCoord_0.y\r\n        },\r\n        1: {\r\n          x: dropDotCoord_1.x,\r\n          y: dropDotCoord_1.y\r\n        }\r\n      }\r\n      dropCoords[id] = dropCoord;\r\n    }\r\n\r\n    dragParentLeft = dragParent.style.left;\r\n    dragParentTop = dragParent.style.top;\r\n  }\r\n  var getShortestDist = function() {\r\n    // console.log('geting shortest dist');\r\n    \r\n    var shortestDist = null;\r\n\r\n    snapInfo = { i: 0, j: 0, id: '' };\r\n\r\n    if (snapType == 'vertical') {\r\n      dropDotCoord_0 = dragParent.querySelector('.dot-top').getBoundingClientRect();\r\n      dropDotCoord_1 = dragParent.querySelector('.dot-bottom').getBoundingClientRect();\r\n    } else {\r\n      dropDotCoord_0 = dragParent.querySelector('.dot-left').getBoundingClientRect();\r\n      dropDotCoord_1 = dragParent.querySelector('.dot-right').getBoundingClientRect();\r\n    }\r\n\r\n    var dragCoord = {\r\n      0: {\r\n        x: dropDotCoord_0.x,\r\n        y: dropDotCoord_0.y\r\n      },\r\n      1: {\r\n        x: dropDotCoord_1.x,\r\n        y: dropDotCoord_1.y\r\n      }\r\n    }\r\n\r\n    // wrt dragParent\r\n    // 0 == top | 1 == bottom\r\n    // 0 == left | 1 == right\r\n    // for(var i = 0; i < 2; i++) { // 0,1 -> snap using BOTH sides (top and botton || left and right)\r\n    // for(var i = 1; i < 2; i++) {  // 1 -> snap using only one side (bottom || right)\r\n    for (var i = 0; i < 1; i++) {  // 0 -> snap using only one side (top || left)\r\n      for (var dropCoord in dropCoords) {\r\n        // if drag is 'top' || 'left compare with 'bottom' || 'right' dots of drop respectivily\r\n        var j = (i == 0) ? 1 : 0;\r\n        if (dropCoords.hasOwnProperty(dropCoord)) {\r\n\r\n          // gettting coordinates to calcualte dist\r\n          var x1 = dragCoord[i].x;\r\n          var y1 = dragCoord[i].y;\r\n          var x2 = dropCoords[dropCoord][j].x;\r\n          var y2 = dropCoords[dropCoord][j].y;\r\n\r\n          // calculating dist btw points\r\n          var x = x1 - x2;\r\n          var y = y1 - y2;\r\n          var d = parseFloat((Math.sqrt(x * x + y * y)).toFixed(2));\r\n\r\n          // if shortest dist is not defined, make it equal to first calculated dist\r\n          if (shortestDist == null || shortestDist > d) {\r\n            shortestDist = d;\r\n            snapInfo = {\r\n              i: (i == 0) ? 0 : 1, // to save if it was top or bottom of dragged element\r\n              j: (j == 0) ? 0 : 1, // to save if it was top or bottom of dropped element\r\n              id: dropCoord // id of element who's j value is saved\r\n            }\r\n\r\n            initCubes.shortestDist = shortestDist;\r\n            dropParent = initMove.dropParent = document.querySelector('[data-id=\"' + dropCoord + '\"');\r\n\r\n            // no highlighting if element has already enought cubes in column\r\n            if(snapType == 'vertical') {\r\n              if (dropParent.classList.contains('vertical')) {\r\n                // initCubes.shortestDist = null\r\n              }\r\n            }\r\n            if(snapType == 'horizontal') {\r\n              if (!dragParent.classList.contains('vertical') || !dropParent.classList.contains('vertical')) {\r\n                initCubes.shortestDist = null\r\n              }\r\n            }\r\n          };\r\n        }\r\n      }\r\n    }\r\n  }\r\n  var highlight = function(flag) {\r\n    if (flag) {\r\n      // console.log('highlighting')\r\n      dragParent.classList.add('highlight');\r\n      dropParent.classList.add('highlight');\r\n    } else {\r\n      dragParent.classList.remove('highlight');\r\n      dropParent.classList.remove('highlight');\r\n    }\r\n  }\r\n  var snap = function() {\r\n    // console.log('snapping');\r\n\r\n    var transitionEvent = whichTransitionEvent();\r\n\r\n    cubeLimit = (snapType == \"vertical\") ? row : col;\r\n\r\n    var sealType = dragParent.querySelector('[data-seal-type]').dataset.sealType;\r\n    var src = dragParent.querySelector('img').src;\r\n    var width = dragParent.querySelector('img').width;\r\n    var height = dragParent.querySelector('img').height;\r\n\r\n    if(snapType == \"vertical\") {\r\n      var dropParentCubeCount = dropParent.querySelectorAll('.drag-area').length;\r\n      var dragParentCubeCount = dragParent.querySelectorAll('.drag-area').length;\r\n    } else {\r\n      var dropParentCubeCount = dropParent.querySelectorAll('.cube-outer').length;\r\n      var dragParentCubeCount = dragParent.querySelectorAll('.cube-outer').length;\r\n    }\r\n    var totalCubes = dropParentCubeCount + dragParentCubeCount;\r\n\r\n    // console.log('snapType: ', snapType);\r\n    // console.log('dropParentCubeCount: ', dropParentCubeCount);\r\n    // console.log('dragParentCubeCount: ', dragParentCubeCount);\r\n    // console.log('totalCubes: ', totalCubes);\r\n    // console.log('cubeLimit: ', cubeLimit);\r\n\r\n    // if possible to add more cubes (both vertical and horizontal)\r\n    if (totalCubes <= cubeLimit) {\r\n      // console.log('totalCubes <= cubeLimit');\r\n\r\n      cubeOuter = '';\r\n      if (snapType == \"vertical\") {\r\n        for (var r = 0; r < dragParentCubeCount; r++) {\r\n          cubeOuter += `\r\n            <div class=\"cube-outer drag-area\" data-index=\"${dropParentCubeCount + r}\" data-seal-type=\"${sealType}\">\r\n              <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n            </div>        \r\n          `;\r\n        }\r\n        initMove.dropParent.innerHTML += cubeOuter;\r\n        dropParent = initMove.dropParent;\r\n      } else if (snapType == \"horizontal\") {\r\n        cubeOuter = '';\r\n        for (var c = 0; c < totalCubes; c++) {\r\n          cubeOuter += `<div class=\"cube-outer drag-area\" data-index=\"${c}\" data-seal-type=\"${sealType}\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n          }\r\n          cubeOuter += '</div>';\r\n        }\r\n        cubeOuter += `\r\n          </div>\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>     \r\n        `;        \r\n        initMove.dropParent.innerHTML = cubeOuter;  \r\n        dropParent = initMove.dropParent;\r\n        initMove.init(dropParent, 'add');\r\n      }\r\n      \r\n      if (snapType == \"horizontal\") dropParent.classList.add('horizontal');\r\n\r\n      totalCubes = dropParent.querySelectorAll('.cube-outer').length;\r\n      \r\n      // if vertical limit reached\r\n      if (totalCubes == cubeLimit) {\r\n        // console.log('totalCubes == cubeLimit');\r\n\r\n        if(snapType == \"vertical\") {\r\n          // make vertical complete group (layout needs to update)\r\n          cubeOuter = `<div class=\"cube-outer\">`;\r\n          for(var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n          }\r\n          cubeOuter += `\r\n            </div>\r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;\r\n\r\n          initMove.dropParent.innerHTML = cubeOuter;\r\n          dropParent = initMove.dropParent;\r\n          dropParent.classList.add('vertical');\r\n        } else if(snapType == \"horizontal\") {\r\n          dropParent = initMove.dropParent;\r\n        }\r\n        \r\n        console.log('limit reached!!!!!!!!!!');\r\n      }\r\n      // console.log(dropParent);\r\n      initMove.init(dropParent, 'add');\r\n      dragParent.remove();\r\n    } else if(totalCubes > cubeLimit) {\r\n      // console.log('totalCubes > cubeLimit');\r\n\r\n      var canBeAddedCubes = cubeLimit - dropParentCubeCount;\r\n      var remainingCubes = dragParentCubeCount - canBeAddedCubes;\r\n\r\n      if(snapType == \"vertical\") {\r\n        // make vertical complete group (layout needs to update)\r\n        cubeOuter = `<div class=\"cube-outer\">`;\r\n        for(var r = 0; r < row; r++) {\r\n          cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n        }\r\n        cubeOuter += `\r\n          </div>\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>     \r\n        `;\r\n        \r\n        initMove.dropParent.innerHTML = cubeOuter;\r\n        dropParent = initMove.dropParent;\r\n        dropParent.classList.add('vertical');\r\n\r\n        // remove cubes from dragParent\r\n        for (var i = 0; i < canBeAddedCubes; i++) {\r\n          dragParent.querySelector('[data-index=\"' + (dragParentCubeCount - 1 - i) + '\"].cube-outer').remove();\r\n        }\r\n\r\n      } else if(snapType == \"horizontal\") {\r\n        // make horizontal complete group \r\n        cubeOuter = \"\";\r\n        for (var c = 0; c < canBeAddedCubes; c++) {\r\n          cubeOuter += `<div class=\"cube-outer drag-area\" data-index=\"${dropParentCubeCount + c}\" data-seal-type=\"${sealType}\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n          }\r\n          cubeOuter += '</div>';\r\n        }\r\n        initMove.dropParent.innerHTML += cubeOuter;\r\n        dropParent = initMove.dropParent;\r\n        // dropParent.classList.remove('vertical');\r\n\r\n        if(remainingCubes == 1) {\r\n          cubeOuter = `<div class=\"cube-outer\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          `;\r\n          }\r\n          cubeOuter += `\r\n            </div> \r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;   \r\n  \r\n          initMove.dragParent.innerHTML = cubeOuter;\r\n          dragParent = initMove.dragParent;\r\n          initMove.init(dragParent, 'add');        \r\n          dragParent.classList.remove('horizontal');\r\n        } else {\r\n          // remove cubes from dragParent\r\n          for (var i = 0; i < canBeAddedCubes; i++) {\r\n            dragParent.querySelector('[data-index=\"' + (dragParentCubeCount - 1 - i) + '\"].cube-outer').remove();\r\n          }\r\n        }\r\n      }\r\n      \r\n      initMove.init(dropParent, 'add');\r\n\r\n      \r\n      dragParent.style.left = dragParentLeft;\r\n      dragParent.style.top = dragParentTop;\r\n      initMove.init(dragParent, 'add');\r\n      dragParent.classList.add('cant-snap');\r\n\r\n      console.log('limit reached!!!!!!!!!!');\r\n    }\r\n\r\n    dragParent.addEventListener(transitionEvent, transitionEndCallback);\r\n    function transitionEndCallback() {\r\n      dragParent.removeEventListener(transitionEvent, transitionEndCallback);\r\n      dragParent.classList.remove('cant-snap');\r\n    }\r\n    dragParent.classList.remove('highlight');\r\n    dropParent.classList.remove('highlight');\r\n  }\r\n  var detach = function(e) {\r\n    // console.log('detaching');\r\n\r\n    if (detachType == 'vertical') {  // vertical detach\r\n      var target = e.target;\r\n\r\n      var index = parseInt(target.dataset.index);\r\n      var totalCubes = dragParent.querySelectorAll('.drag-area').length;\r\n      var detachCubes = totalCubes - index;   \r\n\r\n      var sealType = dragParent.querySelector('[data-seal-type]').dataset.sealType;\r\n      var src = dragParent.querySelector('img').src;\r\n      var width = dragParent.querySelector('img').width;\r\n      var height = dragParent.querySelector('img').height;\r\n\r\n      dragParentLeft = dragParent.style.left;\r\n      dragParentTop = dragParent.style.top;\r\n\r\n      // console.log('target: ', target);\r\n      // console.log('index: ', index);\r\n      // console.log('detachCubes: ', detachCubes);\r\n      // console.log('totalCubes: ', totalCubes);\r\n\r\n      if (totalCubes == 1 && !dragParent.classList.contains('vertical')) {\r\n        dragParent.remove();\r\n      } else if(index) {\r\n        // top\r\n        if(!dragParent.classList.contains('vertical')) { // detaching vertical group when INCOMPLETE\r\n          for (var r = index; r < totalCubes; r++) {\r\n            dragParent.querySelector('[data-index=\"' + r + '\"]').remove();\r\n          }\r\n        } else { // detaching vertical group when COMPLETE\r\n          cubeOuter = '';\r\n          for (var r = 0; r < index; r++) {\r\n            cubeOuter += `\r\n              <div class=\"cube-outer drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\">\r\n                <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n              </div>        \r\n            `;\r\n          }\r\n          cubeOuter += `\r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;   \r\n          initMove.dragParent.innerHTML = cubeOuter;\r\n          dragParent = initMove.dragParent;          \r\n          dragParent.classList.remove('vertical');\r\n\r\n          initMove.init(dragParent, 'add');\r\n          dragParent.addEventListener('dblclick', detach, false);\r\n        }\r\n\r\n        var left = parseFloat(dragParentLeft);\r\n        var top = parseFloat(dragParentTop) + dragParent.getBoundingClientRect().height + 30;\r\n        // bottom\r\n        var draggable = document.createElement('div');\r\n        draggable.classList.add('draggable-cubes');\r\n        draggable.classList.add('draggable');\r\n        draggable.setAttribute('data-id', ++initDrag.draggablesId);\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n        draggable.style.left = left + 'px';\r\n        draggable.style.top = top + 'px';\r\n        draggable.style.zIndex = ++initMove.dragParentzIndex;\r\n  \r\n        cubeOuter = '';\r\n        for (var r = 0; r < detachCubes; r++) {\r\n          cubeOuter += `\r\n          <div class=\"cube-outer drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\">\r\n            <div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          </div>        \r\n        `;\r\n        }\r\n        cubeOuter += `\r\n          <div class=\"dot dot-top\"></div>\r\n          <div class=\"dot dot-bottom\"></div>\r\n          <div class=\"dot dot-left\"></div>\r\n          <div class=\"dot dot-right\"></div>     \r\n        `;          \r\n  \r\n        draggable.innerHTML = cubeOuter;\r\n        cvOuter.appendChild(draggable);\r\n  \r\n        initMove.init(draggable, 'add');\r\n        draggable.addEventListener('dblclick', detach, false);\r\n      } else {\r\n        console.warn(\"Can't remove from here!\");\r\n      }\r\n    } else { // horizontal detach\r\n      var target = e.target;\r\n\r\n      var index = parseInt(target.dataset.index);\r\n      var totalCubes = dragParent.querySelectorAll('.drag-area').length;\r\n      var detachCubes = totalCubes - index;   \r\n\r\n      var sealType = dragParent.querySelector('[data-seal-type]').dataset.sealType;\r\n      var src = dragParent.querySelector('img').src;\r\n      var width = dragParent.querySelector('img').width;\r\n      var height = dragParent.querySelector('img').height;\r\n\r\n      dragParentLeft = dragParent.style.left;\r\n      dragParentTop = dragParent.style.top;\r\n\r\n      // console.log('target: ', target);\r\n      // console.log('index: ', index); // 1\r\n      // console.log('detachCubes: ', detachCubes); // 2\r\n      // console.log('totalCubes: ', totalCubes); // 3\r\n\r\n      if(index) {\r\n        // left\r\n        if(index == 1) {\r\n          cubeOuter = `<div class=\"cube-outer\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          `;\r\n          }\r\n          cubeOuter += `\r\n            </div> \r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;   \r\n\r\n          initMove.dragParent.innerHTML = cubeOuter;\r\n          dragParent = initMove.dragParent;\r\n          initMove.init(dragParent, 'add');\r\n          dragParent.classList.remove('horizontal');\r\n        } else {\r\n          for (var r = index; r < totalCubes; r++) {\r\n            dragParent.querySelector('[data-index=\"' + r + '\"]').remove();\r\n          }\r\n        }\r\n\r\n        var left = parseFloat(dragParentLeft) + dragParent.getBoundingClientRect().width + 30;\r\n        var top = parseFloat(dragParentTop);\r\n\r\n        // right\r\n        var draggable = document.createElement('div');\r\n        draggable.classList.add('draggable-cubes');\r\n        draggable.classList.add('draggable');\r\n        draggable.setAttribute('data-seal-type', sealType);\r\n        draggable.setAttribute('data-id', ++initDrag.draggablesId);\r\n        draggable.style.left = left + 'px';\r\n        draggable.style.top = top + 'px';\r\n        draggable.style.zIndex = ++initMove.dragParentzIndex;\r\n  \r\n        if(detachCubes == 1) { // detach partion is only 1\r\n          cubeOuter = `<div class=\"cube-outer\">`;\r\n          for (var r = 0; r < row; r++) {\r\n            cubeOuter += `<div class=\"cube drag-area\" data-index=\"${r}\" data-seal-type=\"${sealType}\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>\r\n          `;\r\n          }\r\n          cubeOuter += `\r\n            </div> \r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;    \r\n                \r\n        } else { // detach partion - more than 1\r\n          cubeOuter = '';\r\n          for(var c = 0; c < detachCubes; c++) {\r\n            cubeOuter += `<div class=\"cube-outer drag-area\" data-index=\"${c}\" data-seal-type=\"${sealType}\">`;\r\n            for (var r = 0; r < row; r++) {\r\n              cubeOuter += `<div class=\"cube\"><img src=\"${src}\" style=\"width: ${width}px; height: ${height}px;\"></div>`;\r\n            }\r\n            cubeOuter += `</div>`;\r\n          }\r\n          cubeOuter += `\r\n            <div class=\"dot dot-top\"></div>\r\n            <div class=\"dot dot-bottom\"></div>\r\n            <div class=\"dot dot-left\"></div>\r\n            <div class=\"dot dot-right\"></div>     \r\n          `;          \r\n          draggable.classList.add('horizontal');\r\n        }\r\n\r\n        initMove.dropParent = draggable;\r\n        // dropParent = initMove.dropParent;\r\n\r\n        draggable.classList.add('vertical');\r\n        draggable.innerHTML = cubeOuter;\r\n        cvOuter.appendChild(draggable);\r\n  \r\n        initMove.init(draggable, 'add');\r\n        draggable.addEventListener('dblclick', detach, false);\r\n      } else {\r\n        console.warn(\"Can't remove from here!\");\r\n      }      \r\n    }\r\n  }\r\n\r\n  return {\r\n    isSnapping: isSnapping,\r\n    snapDist: snapDist,\r\n    shortestDist: shortestDist,\r\n    getCoords: getCoords,\r\n    getShortestDist: getShortestDist,\r\n    highlight: highlight,\r\n    snap, snap,\r\n    detach, detach\r\n  }\r\n})();\r\n\r\n// rotate behaviour of tools/widgets/seals\r\nvar initRotate = (function () {\r\n  var startAngle = null;\r\n  var rotation = null;\r\n  var rotatable = null;\r\n  var panel;\r\n  var oldPanel = null;\r\n  var panelType = null;\r\n  var refPoint = {\r\n    x: 0,\r\n    y: 0\r\n  };\r\n  var R2D = 180 / Math.PI;\r\n\r\n  var start = function (e) {\r\n    // console.log('start');\r\n    e.preventDefault();\r\n    \r\n    var rotateBtn = e.target;\r\n    panel = rotateBtn.closest('.draggable');\r\n    panelType = panel.dataset.panel;\r\n    rotatable = rotateBtn.closest('.rotatable');\r\n    // startAngle = panel.dataset.startAngle;\r\n\r\n    // reset 'startAngle' if panel is different each time\r\n    if (oldPanel != panel) {\r\n      startAngle = null;\r\n    }\r\n    oldPanel = panel;\r\n\r\n    cvOuter.classList.add('rotating');\r\n\r\n    var height, left, top, width, x, y, _ref;\r\n\r\n    \r\n    if (panelType == 'clock') {\r\n      _ref = rotateBtn.closest('.draggable').getBoundingClientRect();\r\n    } else {\r\n      _ref = rotatable.getBoundingClientRect();\r\n    }\r\n\r\n    top = _ref.top,\r\n      left = _ref.left,\r\n      height = _ref.height,\r\n      width = _ref.width;\r\n\r\n    refPoint = {\r\n      x: left + (width / 2),\r\n      y: top + (height / 2)\r\n    };\r\n\r\n    x = e.clientX - refPoint.x;\r\n    y = e.clientY - refPoint.y;\r\n\r\n    if (startAngle == null) {\r\n      startAngle = Math.floor(R2D * Math.atan2(y, x));\r\n    }\r\n\r\n    cvOuter.addEventListener('mousemove', rotate, false);\r\n    cvOuter.addEventListener('mouseup', end, false);\r\n  };\r\n\r\n  var rotate = function (e) {\r\n    // console.log('rotate');\r\n\r\n    var d, x, y;\r\n    e.preventDefault();\r\n\r\n    x = e.clientX - refPoint.x;\r\n    y = e.clientY - refPoint.y;\r\n    var d = Math.floor(R2D * Math.atan2(y, x));\r\n\r\n    rotation = d - startAngle;\r\n\r\n    console.log(panelType)\r\n\r\n    if (panelType == 'clock') {\r\n      rotatable.style.transform = \"translateY(-50%) rotate(\" + d + \"deg)\";\r\n    } else if(panelType == 'compass') {\r\n      rotatable.style.transform = \"translateX(-50%) rotate(\" + d + \"deg)\";\r\n    } else {\r\n      rotatable.style.transform = \"rotate(\" + rotation + \"deg)\";\r\n    }\r\n  };\r\n\r\n  var end = function (e) {\r\n    // console.log('end');\r\n\r\n    if (rotation < 0) {\r\n      panel.dataset.angle = (rotation + 360);\r\n    } else {\r\n      panel.dataset.angle = rotation;\r\n    }\r\n\r\n    cvOuter.classList.remove('rotating');\r\n\r\n    cvOuter.removeEventListener('mousemove', rotate, false);\r\n    cvOuter.removeEventListener('mouseup', end, false);\r\n  };\r\n\r\n  // Explicitly reveal public pointers to the private functions \r\n  // that we want to reveal publicly\r\n\r\n  return {\r\n    start: start\r\n  }\r\n})();\r\n\r\nvar initScale = (function (e) {\r\n  // console.log('scaling');\r\n\r\n  var start = function(e) {\r\n    console.log('start');\r\n\r\n    cvOuter.addEventListener('mousemove', scale, false);\r\n    cvOuter.addEventListener('mouseup', end, false);\r\n  }\r\n  var scale = function(e) {\r\n    console.log('scale');\r\n    e.preventDefault();\r\n  }\r\n  var end = function(e) {\r\n    console.log('end');\r\n\r\n    cvOuter.removeEventListener('mousemove', scale, false);\r\n    cvOuter.removeEventListener('mouseup', end, false);\r\n  }\r\n\r\n  return {\r\n    start: start\r\n  }\r\n})()\r\n\r\nvar initCalc = function (e) {\r\n  // console.log('calculating');\r\n\r\n  var calc = document.querySelector('[data-panel=\"calculator\"]');\r\n  var buttons = calc.querySelectorAll('[data-button-type]');\r\n  var result = document.getElementById('result');\r\n  var num = \"\";\r\n\r\n  buttons.forEach(button => {\r\n    button.addEventListener('click', calculate, false);\r\n  })\r\n\r\n  function calculate(e) {\r\n    var buttonType = e.target.closest('g[data-button-type]').dataset.buttonType;\r\n    var buttonValue = e.target.closest('g[data-button-type]').dataset.buttonValue;\r\n\r\n    if (buttonType == \"num\") {\r\n      num += buttonValue;\r\n      result.innerHTML = num;\r\n    } else if (buttonType == \"func\") {\r\n      switch (buttonValue) {\r\n        case \"=\":\r\n          num = eval(num).toString();\r\n          result.innerHTML = num;\r\n          break;\r\n        case \"<-\":\r\n          num = num.slice(0, -1);\r\n          result.innerHTML = num;\r\n          break;\r\n        case \"c\":\r\n        case \"ac\":\r\n          result.innerHTML = num = \"\";\r\n          break;\r\n        case \"*\":\r\n        case \"/\":\r\n        case \"+\":\r\n        case \"-\":\r\n          num += \" \" + buttonValue + \" \";\r\n          result.innerHTML = num;\r\n          break;\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n}\r\n// initCalc(e);\r\n\r\nvar initAbacus = function() {\r\n  window.onload = init\r\n  function init() {\r\n    mousedown = 0;\r\n    body = document.querySelector('body');\r\n    body.addEventListener('mousedown', function(){\r\n      mousedown = 1;\r\n    });\r\n    body.addEventListener('mouseup', function(){\r\n      mousedown = 0;\r\n    });\r\n    upper_part = document.querySelectorAll('.upper_layer');\r\n    upper_part.forEach(function(x){\r\n      x.addEventListener('click', change_pos.bind(null,event,x));\r\n      x.addEventListener('mousemove',reset_upper_boxes.bind(null,event,x));\r\n    });\r\n    // check = document.querySelector(\"#Group_389\");\r\n    // check.setAttribute('transform','translate(0,-43)');\r\n\r\n    lower_part = document.querySelectorAll('.bottom_boxes');\r\n    lower_part.forEach(function(x){\r\n      x.addEventListener('click',change_pos_lower.bind(null,event,x));\r\n      x.addEventListener('mousemove',reset_lower_boxes.bind(null,event,x));\r\n    });\r\n  }\r\n\r\n  function reset_lower_boxes(a,evt,c) {\r\n    column_id = evt.parentNode.getAttribute('id');\r\n    boxes = document.querySelectorAll('#'+column_id+' .bottom_boxes');\r\n    if(mousedown) {\r\n      if(evt.dataset.state==\"up\") {\r\n        for(i=0; i<=3; ++i) {\r\n          boxes[i].setAttribute('transform','translate(0,0)');\r\n          boxes[i].dataset.state = \"down\";\t\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function reset_upper_boxes(a,evt,c) {\r\n    if(mousedown) {\r\n      evt.setAttribute('transform','translate(0,0)');\r\n    }\r\n  }\r\n\r\n  function change_pos_lower(a,evt,c) {\r\n    column_id = evt.parentNode.getAttribute('id');\r\n    boxes = document.querySelectorAll('#'+column_id+' .bottom_boxes');\r\n    till = evt.dataset.pos;\r\n    if(evt.dataset.state == \"down\") {\r\n      for(i=0;i<=till;++i) {\r\n        boxes[i].setAttribute('transform','translate(0,-43)');\r\n        boxes[i].dataset.state = \"up\";\r\n      }\r\n    }\r\n    else {\r\n      for(i=till;i<=3;++i) {\r\n      boxes[i].setAttribute('transform','translate(0,0)');\r\n        boxes[i].dataset.state = \"down\";\t\r\n      }\r\n    }\r\n  }\r\n\r\n  function change_pos(a,evt,c) {\r\n    evt.style.background = 'red';\r\n    if(evt.dataset.pos == \"down\") {\r\n      evt.setAttribute('transform','translate(0,-20)');\r\n      evt.dataset.pos = \"up\";\r\n    }\r\n    else {\r\n      evt.setAttribute('transform','translate(0,0)');\r\n      evt.dataset.pos = \"down\";\t\r\n    }\r\n  }\r\n\r\n}\r\n// initAbacus();\r\n\r\ndocument.querySelector('[data-tool-type1=\"pen\"]').click();"],"file":"script.min.js"}