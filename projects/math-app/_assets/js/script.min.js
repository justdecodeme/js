var cv=document.getElementById("cv"),cvOuter=document.getElementById("cvOuter");function whichTransitionEvent(){var e,t=document.createElement("fakeelement"),a={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in a)if(void 0!==t.style[e])return a[e]}function getElPosition(e){return{left:e.getBoundingClientRect().left,right:e.getBoundingClientRect().top}}function getMousePosition(e,t){var a=getElPosition(t),r={x:0,y:0};return r.x=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientX:e.clientX)-a.left).toFixed(2)),r.y=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientY:e.clientY)-a.right).toFixed(2)),r}Object.size=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a};var initTools=function(){var e=document.getElementById("toolsUniverse"),t=e.querySelectorAll(".tools-planet"),a=document.getElementById("toolsPlanetSets"),r=document.getElementById("toolsPlanetPens"),n=(e.offsetWidth,document.getElementById("minimizeToggleBtn")),s=document.getElementById("toolsPlanetSetsBtn"),i=document.getElementById("toolsPlanetPensBtn"),o=currSetType=null;t.forEach(function(e){var t=e.querySelectorAll("#"+e.id+">.tools-satellite.primary"),a=e.querySelector(".tools-satellite:first-child").offsetWidth,r=e.offsetWidth,n=(t.length,(r-a)/2);t.forEach(function(t,a){var r=a-3,s=Math.round(110*Math.cos(30*r*(Math.PI/180))),i=Math.round(110*Math.sin(30*r*(Math.PI/180))),o=Math.round(s+n),l=Math.round(i+n);if(t.style.left=o+"px",t.style.top=l+"px",t.classList.contains("has-child")){let a=t.dataset.toolGroupType,r=19,s=165;e.querySelectorAll('[data-tool-group-type="'+a+'"].secondary').forEach(function(e,t){let i=t-4.5;switch(a){case"pastel1":i=t+.7;break;case"pastel2":i=t+2.2;break;case"stroke":i=t+3.8;break;case"opacity":i=t+5.2;break;case"scale":i=t-4.5}let o=Math.sin(r*i*(Math.PI/180))*s,l=Math.cos(r*i*(Math.PI/180))*s;e.style.top=(o+n).toString()+"px",e.style.left=(l+n).toString()+"px"})}})}),a.classList.add("active"),s.classList.add("active"),s.classList.add("temp-active");var l=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type1].active");t&&(t.classList.remove("active"),initTools.currToolType=null,cv.removeEventListener("mousedown",initDraw.drawStart,!1)),t!=e&&(e.classList.add("active"),initTools.currToolType=e.dataset.toolType1,cv.addEventListener("mousedown",initDraw.drawStart,!1))},d=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type2].active");t&&t!=e&&(t.classList.remove("active"),e.classList.add("active")),initDraw.strokeColor=e.dataset.value},c=function(e,t,a,r){if(a)t.classList.contains("show-child")?t.classList.remove("show-child"):(document.querySelector(".has-child.show-child")&&document.querySelector(".has-child.show-child").classList.remove("show-child"),t.classList.add("show-child"));else if(r){var n=document.querySelector('[data-tool-group-type="'+e+'"].primary'),s=document.querySelector('[data-tool-group-type="'+e+'"].secondary.active');switch("pastel"==e.substr(0,6)&&(document.querySelector("[data-tool-type2].primary.active").classList.remove("active"),n.setAttribute("data-tool-type2","pastel"),e="pastel"),s&&s.classList.remove("active"),t.classList.add("active"),n.classList.add("active"),n.classList.remove("show-child"),e){case"opacity":initDraw.strokeOpacity=parseFloat(t.dataset.value);break;case"stroke":initDraw.strokeWidth=parseFloat(t.dataset.value);break;case"pastel":var i=t.querySelector("img").getAttribute("src");n.querySelector("img").setAttribute("src",i),n.setAttribute("data-value",t.dataset.value),initDraw.strokeColor=t.dataset.value}}};return e.addEventListener("click",function(t){var o=t.target,u=o.id,v=o.dataset.toolType1,p=o.dataset.toolType2,g=o.dataset.toolGroupType,m=o.classList.contains("primary"),y=o.classList.contains("secondary"),h=o.dataset.panelBtn;"minimizeToggleBtn"==u?document.querySelector(".tools-planet.active")?(n.classList.add("active"),e.classList.remove("active"),s.classList.remove("active"),i.classList.remove("active"),document.querySelector(".tools-planet.active").classList.add("temp-active"),document.querySelector(".tools-planet.active").classList.remove("active")):(e.classList.add("active"),n.classList.remove("active"),document.querySelector(".tools-toggle .temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.remove("temp-active")):"toolsPlanetPensBtn"==u?(s.classList.remove("active"),s.classList.remove("temp-active"),a.classList.remove("active"),i.classList.add("active"),i.classList.add("temp-active"),r.classList.add("active"),e.classList.add("active"),n.classList.remove("active")):"toolsPlanetSetsBtn"==u?(i.classList.remove("active"),i.classList.remove("temp-active"),r.classList.remove("active"),s.classList.add("active"),s.classList.add("temp-active"),a.classList.add("active"),e.classList.add("active"),n.classList.remove("active")):"undo"==u?initDraw.undo():"redo"==u?initDraw.redo():"clear"==u?initDraw.clear():v?l(o):p?d(o):h&&initPanel.toggle(o),g&&c(g,o,m,y)},!1),{currToolType:o,currSetType:currSetType}}(),initDraw=function(){var e,t,a,r,n,s=document.querySelector('[data-tool-group-type="opacity"].secondary.active'),i=parseFloat(s.dataset.value),o=document.querySelector('[data-tool-group-type="stroke"].secondary.active'),l=null,d=0,c=null,u=[],v=[],p=!1,g=!1,m=null,y=null,h=function(s){if(s.preventDefault(),c=getMousePosition(s,cv),"pen"==t||"marker"==t)a=document.getElementById(l),r=a.getAttribute("points"),"marker"==t?r=e.x+","+e.y+" "+c.x+","+c.y:"pen"==t&&(g?(p=math.sideAndRange(c)).inRange?(y=math.getCoords(m,p.side,c,n),c.x=y.x,c.y=y.y,r+=" "+c.x+","+c.y):(cv.removeEventListener("mousemove",h,!1),cv.removeEventListener("mouseup",b,!1)):r+=" "+c.x+","+c.y),a.setAttribute("points",r);else if("eraser"==t){var i=s.target;i.classList.contains("drawing")&&(v=[],u.push({Elements:[i],Id:i.id,Action:"erase"}),i.remove())}cv.addEventListener("mouseleave",b,!1)},b=function(){null!==l&&null!=document.getElementById(l)&&u.push({Elements:[],Id:l,Action:"draw"}),cv.removeEventListener("mousemove",h,!1),cv.removeEventListener("mouseup",b,!1),cv.removeEventListener("mouseleave",b,!1)};return{undo:function(){if(u.length>0){var e,t=u.pop();switch(t.Action){case"draw":e=document.getElementById(t.Id),t.Elements.push(e),e.parentNode.removeChild(e);break;case"erase":cv.appendChild(t.Elements[0]);break;case"clear":t.Elements.forEach(function(e){cv.appendChild(e),d++})}v.push(t)}},redo:function(){if(v.length>0){var e,t=v.pop();switch(t.Action){case"draw":e=t.Elements[0],cv.appendChild(e);break;case"erase":(e=t.Elements[0]).parentNode.removeChild(e);break;case"clear":t.Elements.forEach(function(e){e.parentNode.removeChild(e)})}u.push(t)}},clear:function(){d=0;var e=document.querySelectorAll(".drawing");v=[],u.push({Elements:e,Id:null,Action:"clear"}),cv.innerHTML=""},strokeOpacity:i,strokeWidth:parseFloat(o.dataset.value),strokeColor:document.querySelector('[data-tool-type2="pastel"].primary.active').dataset.value,drawStart:function(a){a.preventDefault();var r,s=initDraw.strokeOpacity,i=initDraw.strokeColor,o=initDraw.strokeWidth,u=initDraw.strokeWidth+10;c=getMousePosition(a,cv),l="shape"+d,t=initTools.currToolType,initTools.currSetType&&(m=math.getSetPoints(initTools.currSetType),p=math.sideAndRange(c),g=p.inRange,n=p.slope,g&&(y=math.getCoords(m,p.side,c,n),c.x=y.x,c.y=y.y)),"pen"!=t&&"marker"!=t||("pen"==t?r='<polyline class="drawing" id="'+l+'" style="opacity:'+s+";fill:none;stroke-linecap:round;stroke:"+i+";stroke-width:"+o+'" points="'+c.x+","+c.y+'" />':"marker"==t&&(r='<polyline class="drawing" id="'+l+'" style="fill:none;stroke-linecap:round;stroke:rgba(0, 255, 0, .5);stroke-width:'+u+'" points="'+c.x+","+c.y+'" />'),cv.innerHTML+=r),cv.addEventListener("mousemove",h,!1),cv.addEventListener("mouseup",b,!1),d++,e=c}}}(),initMove=function(){var e=0,t=0,a=0,r=0,n=dropParent=oldDragParent=null,s=function(e,t){var a=e.querySelectorAll(".drag-area");"add"==t?a.length>0?a.forEach(function(e){e.addEventListener("mousedown",i,!1)}):e.addEventListener("mousedown",i,!1):"remove"==t&&(a.length>0?a.forEach(function(e){e.removeEventListener("mousedown",i,!1)}):e.removeEventListener("mousedown",i,!1))},i=function(a){var r=getMousePosition(a,cv);initMove.dragParent=a.target.closest(".draggable");var n=initMove.dragParent;a.target.classList.contains("drag-area")&&(cvOuter.classList.add("dragging"),e=r.x,t=r.y,n!=initMove.oldDragParent&&(n.style.zIndex=++initMove.dragParentzIndex),initMove.oldDragParent=initMove.dragParent,n.classList.contains("draggable-cubes")&&initCubes.getCoords(),cvOuter.addEventListener("mousemove",o,!1),cvOuter.addEventListener("mouseup",l,!1),n.addEventListener("dragstart",initDrag.start,!1)),n.dataset.sealType&&initPanel.trashPanel(a,"start",n.dataset.sealType)},o=function(n){n.preventDefault();var s=getMousePosition(n,cv),i=initMove.dragParent;if(a=e-s.x,r=t-s.y,e=s.x,t=s.y,i.style.left=i.offsetLeft-a+"px",i==toolsUniverse){var o=cvOuter.getBoundingClientRect().height-i.getBoundingClientRect().height-i.offsetTop;i.style.bottom=o+r+"px"}else i.style.top=i.offsetTop-r+"px";i.classList.contains("draggable-cubes")&&(initCubes.getShortestDist(),null!=initCubes.shortestDist&&(initCubes.shortestDist<initCubes.snapDist?initCubes.highlight(!0):initCubes.highlight(!1))),i.dataset.sealType&&initPanel.trashPanel(n,"move")},l=function(e){e.preventDefault();var t=initMove.dragParent;cvOuter.classList.remove("dragging"),t.classList.contains("draggable-cubes")&&null!=initCubes.shortestDist&&initCubes.shortestDist<initCubes.snapDist&&(initCubes.snap(),initCubes.shortestDist=null),t.dataset.sealType&&initPanel.trashPanel(e,"end")&&t.remove(),cvOuter.removeEventListener("mousemove",o,!1),cvOuter.removeEventListener("mouseup",l,!1),t.removeEventListener("dragstart",initDrag.start,!1)};return s(toolsUniverse,"add"),{dragParentzIndex:0,dragParent:n,dropParent:dropParent,oldDragParent:oldDragParent,init:s}}(),initDrag=function(){var e,t,a=function(e){e.preventDefault()},r=function(e){e.preventDefault()},n=function(e){e.preventDefault(),cvOuter.classList.add("dropping")},s=function(i){i.preventDefault();var o=i.dataTransfer.getData("sealType"),l=i.dataTransfer.getData("src"),d=i.dataTransfer.getData("width"),c=i.dataTransfer.getData("height"),u=i.dataTransfer.getData("sealDesign"),v=i.dataTransfer.getData("sealValue");cvOuter.classList.remove("dropping");var p,g=sealTypes[o].max;document.querySelectorAll('[data-seal-type="'+o+'"].dropped-seal').length<g?("cubes"==o||"numbers"==o?((p=document.createElement("div")).classList.add("draggable-cubes"),p.setAttribute("data-seal-type",o),"numbers"==o&&(p.setAttribute("data-number-design",u),p.setAttribute("data-number-value",v)),p.innerHTML=`\n          <div class="cube-outer drag-area" data-index="0" data-seal-type="${o}">\n            <div class="cube"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>\n          <div class="detach-btn"></div>\n          `,p.addEventListener("dblclick",initCubes.remove,!1),p.addEventListener("click",initCubes.detachUI,!1)):((p=document.createElement("img")).src=l,p.width=d,p.height=c,p.classList.add("dropped-seal"),p.classList.add("drag-area"),p.setAttribute("data-seal-type",o),p.addEventListener("dblclick",e=>{p.remove()},!1)),p.setAttribute("data-id",++initDrag.draggablesId),p.style.zIndex=++initMove.dragParentzIndex,p.style.left=i.offsetX-e+"px",p.style.top=i.offsetY-t+"px",p.classList.add("draggable"),cvOuter.appendChild(p),initDrag.dropElHeight=p.getBoundingClientRect().height,initMove.init(p,"add"),cvOuter.removeEventListener("dragenter",a),cvOuter.removeEventListener("dragleave",r),cvOuter.removeEventListener("dragover",n),cvOuter.removeEventListener("drop",s)):alert("You can only place max "+g+" of "+o+" seal type.")};return{start:function(i){e=i.offsetX,t=i.offsetY,i.dataTransfer.setData("src",i.target.src),i.dataTransfer.setData("width",i.target.getBoundingClientRect().width),i.dataTransfer.setData("height",i.target.getBoundingClientRect().height),i.dataTransfer.setData("sealType",i.target.dataset.sealType),i.target.dataset.numberDesign&&(i.dataTransfer.setData("sealDesign",i.target.dataset.numberDesign),i.dataTransfer.setData("sealValue",i.target.dataset.numberValue)),cvOuter.addEventListener("dragenter",a,!1),cvOuter.addEventListener("dragleave",r,!1),cvOuter.addEventListener("dragover",n,!1),cvOuter.addEventListener("drop",s,!1)},draggablesId:0,dropElHeight:0}}(),fetchSeals=function(){for(var e in sealTypes){var t=document.querySelector('[data-panel="'+e+'"] .content');if(sealTypes.hasOwnProperty(e)){var a=sealTypes[e].values;if("numbers"==e)for(var r in a)for(var n=0;n<a[r].length;n++){var s=a[r][n][0],i=a[r][n][1],o=document.createElement("img");o.classList.add("draggable-seal"),o.setAttribute("data-seal-type",e),o.setAttribute("data-number-design",r),o.setAttribute("data-number-value",i),o.src="./_assets/img/"+s,t.appendChild(o)}else a.forEach(a=>{var r=document.createElement("img");r.classList.add("draggable-seal"),r.setAttribute("data-seal-type",e),r.src="./_assets/img/"+a,t.appendChild(r)})}}}(),initPanel=function(e){var t=oldPanel=panelType=panelBtn=panelPosObj=panelCloseBtn=panelScaleBtn=draggableSeals=rotateBtns=null,a=function(e){e.type?(t=this.closest(".draggable"),panelType=t.dataset.panel):(panelType=e,t=document.querySelector('[data-panel="'+panelType+'"]')),panelBtn=document.querySelector('[data-panel-btn="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelScaleBtn=t.querySelector(".scale-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),t.classList.remove("active"),panelBtn.classList.remove("active"),rotateBtns=t.querySelectorAll(".rotate-btn"),panelCloseBtn.removeEventListener("click",a,!1),initMove.init(t,"remove");for(var n=0;n<draggableSeals.length;n++)draggableSeals[n].removeEventListener("dragstart",initDrag.start,!1);for(n=0;n<rotateBtns.length;n++)rotateBtns[n].addEventListener("mousedown",initRotate.start,!1);if(panelScaleBtn&&panelScaleBtn.removeEventListener("mousedown",initScale.start,!1),"calculator"==panelType){var s=t.querySelectorAll("[data-button-type]");for(n=0;n<s.length;n++)s[n].removeEventListener("click",initCalc.calculate,!1)}t.classList.contains("draggable-seal")&&t.addEventListener("click",r,!1),t.dataset.panelSet&&(initTools.currSetType=null)},r=function(e){t=this.closest(".draggable"),oldPanel!=t&&(t.style.zIndex=++initMove.dragParentzIndex),oldPanel=t};return{toggle:function(e){if(panelType=e.dataset.panelBtn,e.classList.contains("active"))a(panelType);else{t=document.querySelector('[data-panel="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelScaleBtn=t.querySelector(".scale-btn"),rotateBtns=t.querySelectorAll(".rotate-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),e.classList.add("active"),t.classList.add("active"),t.style.zIndex=++initMove.dragParentzIndex,initMove.dragParent=t,initMove.oldDragParent=t,panelCloseBtn.addEventListener("click",a,!1),initMove.init(t,"add");for(var n=0;n<draggableSeals.length;n++)draggableSeals[n].addEventListener("dragstart",initDrag.start,!1);for(n=0;n<rotateBtns.length;n++)rotateBtns[n].addEventListener("mousedown",initRotate.start,!1);if(panelScaleBtn&&panelScaleBtn.addEventListener("mousedown",initScale.start,!1),"calculator"==panelType){var s=t.querySelectorAll("[data-button-type]");for(n=0;n<s.length;n++)s[n].addEventListener("click",initCalc.calculate,!1)}t.classList.contains("draggable-seal")&&t.addEventListener("click",r,!1),t.dataset.panelSet&&(initTools.currSetType=t.dataset.panelSet)}},trashPanel:function(e,a,r){var n=getMousePosition(e,cv);if("start"==a){var s=(t=document.querySelector('[data-panel="'+r+'"]')).getBoundingClientRect();panelPosObj={x1:s.left,x2:s.left+s.width,y1:s.top,y2:s.top+s.height}}if("move"==a&&(t.style.zIndex=initMove.dragParentzIndex,t.classList.add("trash")),n.x>panelPosObj.x1&&n.x<panelPosObj.x2&&n.y>panelPosObj.y1&&n.y<panelPosObj.y2?t.classList.add("trash-active"):t.classList.remove("trash-active"),"end"==a)return t.classList.remove("trash"),!!t.classList.contains("trash-active")&&(t.classList.remove("trash-active"),!0)}}}(),initCubes=function(e){var t={},a=3,r=3,n=dragParentTop=shortestDist=snapType=dragParent=dropParent=cubeLimit=cubeOuter=null,s=null,i=function(){var e=whichTransitionEvent(),t=dragParent.querySelector("[data-seal-type]").dataset.sealType,s=dragParent.querySelector("img").src,i=dragParent.querySelector("img").width,o=dragParent.querySelector("img").height;if("numbers"==t&&(a=4,r=0),cubeLimit="vertical"==snapType?a:r,"vertical"==snapType)var l=dropParent.querySelectorAll(".drag-area").length,d=dragParent.querySelectorAll(".drag-area").length;else l=dropParent.querySelectorAll(".cube-outer").length,d=dragParent.querySelectorAll(".cube-outer").length;var c=l+d;if(c<=cubeLimit){if(cubeOuter="","vertical"==snapType){for(var u=0;u<d;u++)cubeOuter+=`\n            <div class="cube-outer drag-area" data-index="${l+u}" data-seal-type="${t}">\n              <div class="cube"><img src="${s}" style="width: ${i}px; height: ${o}px;"></div>\n            </div>        \n          `;initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent}else if("horizontal"==snapType){cubeOuter="";for(var v=0;v<c;v++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${v}" data-seal-type="${t}">`;for(u=0;u<a;u++)cubeOuter+=`<div class="cube"><img src="${s}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+="</div>"}cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>\n          <div class="detach-btn"></div>     \n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,initMove.init(dropParent,"add")}if("horizontal"==snapType&&dropParent.classList.add("horizontal"),(c=dropParent.querySelectorAll(".cube-outer").length)==cubeLimit){if("numbers"==t){for(u=0;u<a;u++)dropParent.querySelector('[data-index="'+u+'"]').remove();cubeOuter=`\n            <div class="cube-outer drag-area" data-index="0" data-seal-type="numbers">\n              <div class="cube"><img src="${"_assets/img/number-"+dropParent.dataset.numberDesign+"-"+10*dropParent.dataset.numberValue+".svg"}" style="width: ${i}px; height: ${o}px;"></div>\n            </div>        \n          `,dropParent.classList.remove("vertical"),dropParent.classList.remove("detach"),dropParent.setAttribute("data-number-value",10*dropParent.dataset.numberValue),dropParent.innerHTML+=cubeOuter}else if("cubes"==t)if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${s}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+='\n              </div>\n              <div class="dot dot-top"></div>\n              <div class="dot dot-bottom"></div>\n              <div class="dot dot-left"></div>\n              <div class="dot dot-right"></div>     \n              <div class="detach-btn"></div>\n            ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical")}else"horizontal"==snapType&&(dropParent=initMove.dropParent);console.log("limit reached!!!!!!!!!!")}initMove.init(dropParent,"add"),dragParent.remove()}else if(c>cubeLimit){var p=cubeLimit-l,g=d-p;if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${s}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>     \n          <div class="detach-btn"></div>\n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical");for(var m=0;m<p;m++)dragParent.querySelector('[data-index="'+(d-1-m)+'"].cube-outer').remove()}else if("horizontal"==snapType){cubeOuter="";for(v=0;v<p;v++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${l+v}" data-seal-type="${t}">`;for(u=0;u<a;u++)cubeOuter+=`<div class="cube"><img src="${s}" style="width: ${i}px; height: ${o}px;"></div>`;cubeOuter+="</div>"}if(initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent,1==g){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${s}" style="width: ${i}px; height: ${o}px;"></div>\n          `;cubeOuter+='\n            </div> \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n            <div class="detach-btn"></div>\n          ',initMove.dragParent.innerHTML=cubeOuter,dragParent=initMove.dragParent,initMove.init(dragParent,"add"),dragParent.classList.remove("horizontal")}else for(m=0;m<p;m++)dragParent.querySelector('[data-index="'+(d-1-m)+'"].cube-outer').remove()}initMove.init(dropParent,"add"),dragParent.style.left=n,dragParent.style.top=dragParentTop,initMove.init(dragParent,"add"),dragParent.classList.add("cant-snap"),console.log("limit reached!!!!!!!!!!")}dragParent.addEventListener(e,function t(){dragParent.removeEventListener(e,t);dragParent.classList.remove("cant-snap")}),dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight")},o=function(e){var t,a=dragParent.style.left,r=dragParent.style.top,n=parseFloat(a),i=dragParent.querySelector(".drag-area").getBoundingClientRect().height,o=dragParent.dataset.sealType,d=dragParent.querySelector("img").src,c=dragParent.querySelector("img").width,u=dragParent.querySelector("img").height;if(e.target.classList.contains("detach-btn"))if("vertical"==s){console.log("vertical detaching all");for(var v=dragParent.querySelectorAll(".drag-area").length,p=1;p<v;p++)dragParent.querySelector('[data-index="'+p+'"]').remove(),dragParent.classList.remove("detach");for(p=1;p<v;p++){var g=document.createElement("div");g.classList.add("draggable-cubes"),g.classList.add("draggable"),g.setAttribute("data-id",++initDrag.draggablesId),g.setAttribute("data-seal-type",o),g.style.left=n+"px",g.style.top=parseFloat(r)+i*p+30*p+"px",g.style.zIndex=++initMove.dragParentzIndex,"numbers"==o&&(g.setAttribute("data-number-design",dragParent.dataset.numberDesign),g.setAttribute("data-number-value",dragParent.dataset.numberValue)),t=`\n            <div class="cube-outer drag-area" data-index="0" data-seal-type="${o}">\n            <div class="cube"><img src="${d}" style="width: ${c}px; height: ${u}px;"></div>\n            </div>        \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n            <div class="detach"></div>     \n          `,g.innerHTML=t,cvOuter.appendChild(g),initMove.init(g,"add"),g.addEventListener("dblclick",l,!1)}}else console.log("horizontal detaching all");else dragParent.querySelectorAll(".drag-area").length>1&&(dragParent.classList.contains("detach")?dragParent.classList.remove("detach"):dragParent.classList.add("detach"))},l=function(e){e.target.closest(".draggable").remove()};return{isSnapping:!1,snapDist:40,shortestDist:shortestDist,getCoords:function(){dragParent=initMove.dragParent,snapType=dragParent.classList.contains("vertical")?"horizontal":"vertical",s=dragParent.classList.contains("horizontal")?"horizontal":"vertical",t={};var e=dropDotCoord_1=null,a=document.querySelectorAll(".draggable-cubes");for(let n=0;n<a.length;n++)if(a[n]!=dragParent){"vertical"==snapType?(e=a[n].querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=a[n].querySelector(".dot-bottom").getBoundingClientRect()):(e=a[n].querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=a[n].querySelector(".dot-right").getBoundingClientRect());var r=a[n].dataset.id,i={0:{x:e.x,y:e.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}};t[r]=i}n=dragParent.style.left,dragParentTop=dragParent.style.top},getShortestDist:function(){var e=null;({i:0,j:0,id:""}),"vertical"==snapType?(dropDotCoord_0=dragParent.querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-bottom").getBoundingClientRect()):(dropDotCoord_0=dragParent.querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-right").getBoundingClientRect());for(var a={0:{x:dropDotCoord_0.x,y:dropDotCoord_0.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}},r=0;r<1;r++)for(var n in t){var s=0==r?1:0;if(t.hasOwnProperty(n)){var i=a[r].x,o=a[r].y,l=i-t[n][s].x,d=o-t[n][s].y,c=parseFloat(Math.sqrt(l*l+d*d).toFixed(2));(null==e||e>c)&&(e=c,{i:0==r?0:1,j:0==s?0:1,id:n},initCubes.shortestDist=e,dropParent=initMove.dropParent=document.querySelector('[data-id="'+n+'"'),"vertical"==snapType&&dropParent.classList.contains("vertical"),"horizontal"==snapType&&(dragParent.classList.contains("vertical")&&dropParent.classList.contains("vertical")||(initCubes.shortestDist=null)))}}dropParent&&("cubes"==dragParent.dataset.sealType?dragParent.dataset.sealType!=dropParent.dataset.sealType&&(initCubes.shortestDist=null):"numbers"==dragParent.dataset.sealType&&(dragParent.dataset.numberDesign==dropParent.dataset.numberDesign&&dragParent.dataset.numberValue==dropParent.dataset.numberValue||(initCubes.shortestDist=null)),"10000"==dragParent.dataset.numberValue&&(initCubes.shortestDist=null))},highlight:function(e){e?(dragParent.classList.add("highlight"),dropParent.classList.add("highlight")):(dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight"))},snap:i,snap:i,detachUI:o,detachUI:o,remove:l,remove:l}}(),initRotate=function(){var e,t=null,a=null,r=null,n=null,s=null,i={x:0,y:0},o=180/Math.PI,l=function(e){var n,l;e.preventDefault(),n=e.clientX-i.x,l=e.clientY-i.y;var d=Math.floor(o*Math.atan2(l,n));a=d-t,r.style.transform="clock"==s?"translateY(-50%) rotate("+d+"deg)":"compass"==s?"translateX(-50%) rotate("+d+"deg)":"rotate("+a+"deg)"},d=function(t){e.dataset.angle=a<0?a+360:a,cvOuter.classList.remove("rotating"),cvOuter.removeEventListener("mousemove",l,!1),cvOuter.removeEventListener("mouseup",d,!1)};return{start:function(a){a.preventDefault();var c,u,v,p,g,m,y,h=a.target;e=h.closest(".draggable"),s=e.dataset.panel,r=h.closest(".rotatable"),n!=e&&(t=null),n=e,cvOuter.classList.add("rotating"),v=(y="clock"==s?h.closest(".draggable").getBoundingClientRect():r.getBoundingClientRect()).top,u=y.left,c=y.height,p=y.width,i={x:u+p/2,y:v+c/2},g=a.clientX-i.x,m=a.clientY-i.y,null==t&&(t=Math.floor(o*Math.atan2(m,g))),cvOuter.addEventListener("mousemove",l,!1),cvOuter.addEventListener("mouseup",d,!1)}}}(),initScale=function(e){var t=function(e){console.log("scale"),e.preventDefault()},a=function(e){console.log("end"),cvOuter.removeEventListener("mousemove",t,!1),cvOuter.removeEventListener("mouseup",a,!1)};return{start:function(e){console.log("start"),cvOuter.addEventListener("mousemove",t,!1),cvOuter.addEventListener("mouseup",a,!1)}}}(),initCalc=function(e){var num="",calculate=function(e){var result=document.querySelector('[data-panel="calculator"] #result'),buttonType=e.target.closest("g[data-button-type]").dataset.buttonType,buttonValue=e.target.closest("g[data-button-type]").dataset.buttonValue;if("num"==buttonType)num+=buttonValue,result.innerHTML=num;else if("func"==buttonType){switch(buttonValue){case"=":num=eval(num).toString();break;case"<-":num=num.slice(0,-1);break;case"c":case"ac":num="";break;case"*":case"/":case"+":case"-":num+=" "+buttonValue+" "}result.innerHTML=num}};return{calculate:calculate}}(),initAbacus=function(){window.onload=function(){mousedown=0,body=document.querySelector("body"),body.addEventListener("mousedown",function(){mousedown=1}),body.addEventListener("mouseup",function(){mousedown=0}),upper_part=document.querySelectorAll(".upper_layer"),upper_part.forEach(function(e){e.addEventListener("click",function(e,t,a){t.style.background="red","down"==t.dataset.pos?(t.setAttribute("transform","translate(0,-20)"),t.dataset.pos="up"):(t.setAttribute("transform","translate(0,0)"),t.dataset.pos="down")}.bind(null,event,e)),e.addEventListener("mousemove",function(e,t,a){mousedown&&t.setAttribute("transform","translate(0,0)")}.bind(null,event,e))}),lower_part=document.querySelectorAll(".bottom_boxes"),lower_part.forEach(function(e){e.addEventListener("click",function(e,t,a){if(column_id=t.parentNode.getAttribute("id"),boxes=document.querySelectorAll("#"+column_id+" .bottom_boxes"),till=t.dataset.pos,"down"==t.dataset.state)for(i=0;i<=till;++i)boxes[i].setAttribute("transform","translate(0,-43)"),boxes[i].dataset.state="up";else for(i=till;i<=3;++i)boxes[i].setAttribute("transform","translate(0,0)"),boxes[i].dataset.state="down"}.bind(null,event,e)),e.addEventListener("mousemove",function(e,t,a){if(column_id=t.parentNode.getAttribute("id"),boxes=document.querySelectorAll("#"+column_id+" .bottom_boxes"),mousedown&&"up"==t.dataset.state)for(i=0;i<=3;++i)boxes[i].setAttribute("transform","translate(0,0)"),boxes[i].dataset.state="down"}.bind(null,event,e))})}},math=function(e){var t=0,a=!1,r=function(e){var t=(e.p2.y-e.p1.y)/(e.p2.x-e.p1.x);return parseFloat(t.toFixed(2))},n=function(e,t,a){return a==1/0||a==-1/0?Math.abs(e.p1.x-t.x):Math.abs((a*t.x-t.y+e.p1.y-a*e.p1.x)/Math.sqrt(1+a*a))};return{sideAndRange:function(e){var s,i=function(e){var t={},a=math.getSetPoints(initTools.currSetType),r=Object.size(a);for(let e=1;e<=r;e++){var n=e==r?1:e+1,s={p1:a[e],p2:a[n]};t["l"+e+n]=s}return t}(),o=(e.x-i.l12.p1.x)*(i.l12.p2.y-i.l12.p1.y)-(e.y-i.l12.p1.y)*(i.l12.p2.x-i.l12.p1.x),l=(e.x-i.l34.p1.x)*(i.l34.p2.y-i.l34.p1.y)-(e.y-i.l34.p1.y)*(i.l34.p2.x-i.l34.p1.x),d=(e.x-i.l23.p1.x)*(i.l23.p2.y-i.l23.p1.y)-(e.y-i.l23.p1.y)*(i.l23.p2.x-i.l23.p1.x),c=(e.x-i.l41.p1.x)*(i.l41.p2.y-i.l41.p1.y)-(e.y-i.l41.p1.y)*(i.l41.p2.x-i.l41.p1.x),u="";if(o<0&&l<0||o>0&&l>0||d<0&&c<0||d>0&&c>0){if("12_34"==(o<0&&l<0||o>0&&l>0?"12_34":"23_41")){t=r(i.l23);var v=n(i.l23,e,t),p=n(i.l41,e,t);v<p?(s=v,nearestLine=i.l23,u=2,startPoint=e):(s=p,nearestLine=i.l41,u=4)}else{t=r(i.l12);var g=n(i.l12,e,t),m=n(i.l34,e,t);g<m?(s=g,nearestLine=i.l12,u=1):(s=m,nearestLine=i.l34,u=3)}a=50>=s&&(1==u||3==u)}else a=!1;return{inRange:a,side:u,slope:t,slope:t}},getSetPoints:function(e){var t={},a=document.querySelector('[data-panel-set="'+e+'"]').querySelectorAll(".point"),r=getElPosition(cv);for(let e=0;e<a.length;e++){var n={x:"",y:""},s=r.left,i=r.right,o=a[e].getBoundingClientRect().left,l=a[e].getBoundingClientRect().top,d=a[e].getBoundingClientRect().width,c=a[e].getBoundingClientRect().height;n.x=parseFloat((o+d/2-s).toFixed(2)),n.y=parseFloat((l+c/2-i).toFixed(2)),t[e+1]=n}return t},getCoords:function(e,t,a,r){var n,s,i=initDraw.strokeWidth/2;return 0==r?(i=1==t?e[1].x<e[3].x?-i:i:e[1].x<e[3].x?i:-i,n=a.x,s=e[t].y+i):r==1/0||r==-1/0?(i=1==t?e[1].x<e[3].x?-i:i:e[1].x<e[3].x?i:-i,n=e[t].x+i,s=a.y):(x1=(a.x/r+r*e[t].x+a.y-e[t].y)/(r+1/r),y1=r*(x1-e[t].x)+e[t].y,r=-1/r,e[1].x>e[4].x?(1==t?n=x1+Math.sqrt(i*i/(1+r*r)):3==t&&(n=x1-Math.sqrt(i*i/(1+r*r))),s=r*(n-x1)+y1):(1==t?n=x1-Math.sqrt(i*i/(1+r*r)):3==t&&(n=x1+Math.sqrt(i*i/(1+r*r))),s=r*(n-x1)+y1)),{x:n,y:s}}}}();document.querySelector('[data-tool-type1="pen"]').click();
//# sourceMappingURL=script.min.js.map
