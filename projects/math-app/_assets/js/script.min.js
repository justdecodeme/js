var cv=document.getElementById("cv"),cvOuter=document.getElementById("cvOuter"),mousedown=mousemove=!1;function whichTransitionEvent(){var e,t=document.createElement("fakeelement"),a={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in a)if(void 0!==t.style[e])return a[e]}Object.size=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a};var initTools=function(){var e=document.getElementById("toolsUniverse"),t=e.querySelectorAll(".tools-planet"),a=document.getElementById("toolsPlanetSets"),n=document.getElementById("toolsPlanetPens"),r=(e.offsetWidth,document.getElementById("minimizeToggleBtn")),s=document.getElementById("toolsPlanetSetsBtn"),o=document.getElementById("toolsPlanetPensBtn"),i=currSetType=null;t.forEach(function(e){var t=e.querySelectorAll("#"+e.id+">.tools-satellite.primary"),a=e.querySelector(".tools-satellite:first-child").offsetWidth,n=e.offsetWidth,r=(t.length,(n-a)/2);t.forEach(function(t,a){var n=a-3,s=Math.round(110*Math.cos(30*n*(Math.PI/180))),o=Math.round(110*Math.sin(30*n*(Math.PI/180))),i=Math.round(s+r),l=Math.round(o+r);if(t.style.left=i+"px",t.style.top=l+"px",t.classList.contains("has-child")){let a=t.dataset.toolGroupType,n=19,s=165;e.querySelectorAll('[data-tool-group-type="'+a+'"].secondary').forEach(function(e,t){let o=t-4.5;switch(a){case"pastel1":o=t+.7;break;case"pastel2":o=t+2.2;break;case"stroke":o=t+3.8;break;case"opacity":o=t+5.2;break;case"scale":o=t-4.5;break;case"set-square":o=t-2.2}let i=Math.sin(n*o*(Math.PI/180))*s,l=Math.cos(n*o*(Math.PI/180))*s;e.style.top=(i+r).toString()+"px",e.style.left=(l+r).toString()+"px"})}})}),a.classList.add("active"),s.classList.add("active"),s.classList.add("temp-active");var l=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type1].active");t&&(t.classList.remove("active"),initTools.currToolType=null,cv.removeEventListener("mousedown",initDraw.start,!1)),t!=e&&(e.classList.add("active"),initTools.currToolType=e.dataset.toolType1,cv.addEventListener("mousedown",initDraw.start,!1))},d=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type2].active");t&&t!=e&&(t.classList.remove("active"),e.classList.add("active")),initDraw.strokeColor=e.dataset.value},c=function(e,t,a,n){if(a)t.classList.contains("show-child")?t.classList.remove("show-child"):(document.querySelector(".has-child.show-child")&&document.querySelector(".has-child.show-child").classList.remove("show-child"),t.classList.add("show-child"));else if(n){var r=document.querySelector('[data-tool-group-type="'+e+'"].primary'),s=document.querySelector('[data-tool-group-type="'+e+'"].secondary.active');if("pastel"==e.substr(0,6)&&(document.querySelector("[data-tool-type2].primary.active").classList.remove("active"),r.setAttribute("data-tool-type2","pastel"),e="pastel"),"scale"!=e&&"set-square"!=e||(s=null),s&&s.classList.remove("active"),"scale"==e||"set-square"==e){if("scale"==e)var o=document.querySelectorAll('[data-tool-group-type="scale"].secondary.active');else if("set-square"==e)o=document.querySelectorAll('[data-tool-group-type="set-square"].secondary.active');o.length>0?r.classList.add("active"):r.classList.remove("active")}else t.classList.add("active"),r.classList.add("active");switch(r.classList.remove("show-child"),e){case"opacity":initDraw.strokeOpacity=parseFloat(t.dataset.value);break;case"stroke":initDraw.strokeWidth=parseFloat(t.dataset.value);break;case"pastel":var i=t.querySelector("img").getAttribute("src");r.querySelector("img").setAttribute("src",i),r.setAttribute("data-value",t.dataset.value),initDraw.strokeColor=t.dataset.value}}};return e.addEventListener("click",function(t){var i=t.target,u=i.id,p=i.dataset.toolType1,v=i.dataset.toolType2,g=i.dataset.toolGroupType,m=i.classList.contains("primary"),y=i.classList.contains("secondary"),h=i.dataset.panelBtn;"minimizeToggleBtn"==u?document.querySelector(".tools-planet.active")?(r.classList.add("active"),e.classList.remove("active"),s.classList.remove("active"),o.classList.remove("active"),document.querySelector(".tools-planet.active").classList.add("temp-active"),document.querySelector(".tools-planet.active").classList.remove("active")):(e.classList.add("active"),r.classList.remove("active"),document.querySelector(".tools-toggle .temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.remove("temp-active")):"toolsPlanetPensBtn"==u?(s.classList.remove("active"),s.classList.remove("temp-active"),a.classList.remove("active"),o.classList.add("active"),o.classList.add("temp-active"),n.classList.add("active"),e.classList.add("active"),r.classList.remove("active")):"toolsPlanetSetsBtn"==u?(o.classList.remove("active"),o.classList.remove("temp-active"),n.classList.remove("active"),s.classList.add("active"),s.classList.add("temp-active"),a.classList.add("active"),e.classList.add("active"),r.classList.remove("active")):"undo"==u?initDraw.undo():"redo"==u?initDraw.redo():"clear"==u?initDraw.clear():p?l(i):v?d(i):h&&initPanel.toggle(i),g&&c(g,i,m,y)},!1),{currToolType:i,currSetType:currSetType}}(),initDraw=function(){var e,t,a,n,r,s,o=document.querySelector('[data-tool-group-type="opacity"].secondary.active'),i=parseFloat(o.dataset.value),l=document.querySelector('[data-tool-group-type="stroke"].secondary.active'),d=null,c=0,u=null,p=[],v=[],g=!1,m=!1,y=null,h=null,b=null,f={radius:0,center:{x:0,y:0},point:{x:0,y:0},dotRadius:5},L=function(){null!==d&&null!=document.getElementById(d)&&p.push({Elements:[],Id:d,Action:"draw"}),cv.removeEventListener("mousemove",P,!1),cv.removeEventListener("mouseup",L,!1),cv.removeEventListener("mouseleave",L,!1)},P=function(o){if(o.preventDefault(),u=math.getMousePosition(o,cv),"pen"==t||"marker"==t)a=document.getElementById(d),r=a.getAttribute("points"),"marker"==t?r=e.x+","+e.y+" "+u.x+","+u.y:"pen"==t&&(m?(g=math.sideAndRange(u)).inRange?(b=math.getCoords(y,g.side,u,s),u.x=b.x,u.y=b.y,r+=" "+u.x+","+u.y):(cv.removeEventListener("mousemove",P,!1),cv.removeEventListener("mouseup",L,!1)):r+=" "+u.x+","+u.y),a.setAttribute("points",r);else if("eraser"==t){var i=o.target;i.classList.contains("drawing")&&(v=[],p.push({Elements:[i],Id:i.id,Action:"erase"}),i.remove())}if("compass"==h&&"arc"==t){var l=(n=document.getElementById(d)).querySelector("polyline");r=l.getAttribute("points"),y=math.getSetPoints(initTools.currSetType),f.point.x=y[2].x,f.point.y=y[2].y,r+=" "+f.point.x+","+f.point.y,l.setAttribute("points",r)}cv.addEventListener("mouseleave",L,!1)};return{undo:function(){if(p.length>0){var e,t=p.pop();switch(t.Action){case"draw":e=document.getElementById(t.Id),t.Elements.push(e),e.parentNode.removeChild(e);break;case"erase":cv.appendChild(t.Elements[0]);break;case"clear":t.Elements.forEach(function(e){cv.appendChild(e),c++})}v.push(t)}},redo:function(){if(v.length>0){var e,t=v.pop();switch(t.Action){case"draw":e=t.Elements[0],cv.appendChild(e);break;case"erase":(e=t.Elements[0]).parentNode.removeChild(e);break;case"clear":t.Elements.forEach(function(e){e.parentNode.removeChild(e)})}p.push(t)}},clear:function(){c=0;var e=document.querySelectorAll(".drawing");v=[],p.push({Elements:e,Id:null,Action:"clear"}),cv.innerHTML=""},strokeOpacity:i,strokeWidth:parseFloat(l.dataset.value),strokeColor:document.querySelector('[data-tool-type2="pastel"].primary.active').dataset.value,start:function(r){r.preventDefault();var o=initDraw.strokeOpacity,i=initDraw.strokeColor,l=initDraw.strokeWidth,p=initDraw.strokeWidth+10;u=math.getMousePosition(r,cv),d="shape"+c,t=initTools.currToolType,h=initTools.currSetType,e=u,"scale"==h.substr(0,5)&&(y=math.getSetPoints(initTools.currSetType),g=math.sideAndRange(u),m=g.inRange,s=g.slope,console.log(g),m&&(b=math.getCoords(y,g.side,u,s),u.x=b.x,u.y=b.y)),"compass"==h&&"arc"==t&&(y=math.getSetPoints(initTools.currSetType),f.center.x=y[1].x,f.center.y=y[1].y,f.point.x=y[2].x,f.point.y=y[2].y,f.radius=Math.sqrt((y[2].x-y[1].x)*(y[2].x-y[1].x)+(y[2].y-y[1].y)*(y[2].y-y[1].y)),f.radius=math.parseToFloat(f.radius,2),n=`<g id="${d}">\n        <ellipse style="fill:${i};stroke-width:0;stroke:none;" cx="${f.center.x}px" cy="${f.center.y}px" rx="${f.dotRadius}px" ry="${f.dotRadius}px"></ellipse>\n        <polyline class="drawing" style="fill:none;stroke-linecap:round;stroke:${i};stroke-width:3" points="${f.point.x},${f.point.y} "></polyline>\n      </g>`,cv.innerHTML+=n),"pen"!=t&&"marker"!=t||("pen"==t?a='<polyline class="drawing" id="'+d+'" style="opacity:'+o+";fill:none;stroke-linecap:round;stroke:"+i+";stroke-width:"+l+'" points="'+u.x+","+u.y+'" />':"marker"==t&&(a='<polyline class="drawing" id="'+d+'" style="fill:none;stroke-linecap:round;stroke:rgba(0, 255, 0, .5);stroke-width:'+p+'" points="'+u.x+","+u.y+'" />'),cv.innerHTML+=a),cv.addEventListener("mousemove",P,!1),cv.addEventListener("mouseup",L,!1),c++}}}(),initMove=function(){var e=0,t=0,a=0,n=0,r=dropParent=oldDragParent=null,s=function(e,t){var a=e.querySelectorAll(".drag-area");"add"==t?a.length>0?a.forEach(function(e){e.addEventListener("mousedown",o,!1)}):e.addEventListener("mousedown",o,!1):"remove"==t&&(a.length>0?a.forEach(function(e){e.removeEventListener("mousedown",o,!1)}):e.removeEventListener("mousedown",o,!1))},o=function(a){var n=math.getMousePosition(a,cv);initMove.dragParent=a.target.closest(".draggable");var r=initMove.dragParent;a.target.classList.contains("drag-area")&&(cvOuter.classList.add("dragging"),e=n.x,t=n.y,r!=initMove.oldDragParent&&(r.style.zIndex=++initMove.dragParentzIndex),initMove.oldDragParent=initMove.dragParent,r.dataset.panelSet&&(initTools.currSetType=r.dataset.panel),r.classList.contains("draggable-cubes")&&initCubes.getCoords(),cvOuter.addEventListener("mousemove",i,!1),cvOuter.addEventListener("mouseup",l,!1),r.addEventListener("dragstart",initDrag.start,!1)),r.dataset.sealType&&initPanel.trashPanel(a,"start",r.dataset.sealType)},i=function(r){r.preventDefault();var s=math.getMousePosition(r,cv),o=initMove.dragParent;if(a=e-s.x,n=t-s.y,e=s.x,t=s.y,o.style.left=o.offsetLeft-a+"px",o==toolsUniverse){var i=cvOuter.getBoundingClientRect().height-o.getBoundingClientRect().height-o.offsetTop;o.style.bottom=i+n+"px"}else o.style.top=o.offsetTop-n+"px";o.classList.contains("draggable-cubes")&&(initCubes.getShortestDist(),null!=initCubes.shortestDist&&(initCubes.shortestDist<initCubes.snapDist?initCubes.highlight(!0):initCubes.highlight(!1))),o.dataset.sealType&&initPanel.trashPanel(r,"move")},l=function(e){e.preventDefault();var t=initMove.dragParent;cvOuter.classList.remove("dragging"),t.classList.contains("draggable-cubes")&&null!=initCubes.shortestDist&&initCubes.shortestDist<initCubes.snapDist&&(initCubes.snap(),initCubes.shortestDist=null),t.dataset.sealType&&initPanel.trashPanel(e,"end")&&t.remove(),cvOuter.removeEventListener("mousemove",i,!1),cvOuter.removeEventListener("mouseup",l,!1),t.removeEventListener("dragstart",initDrag.start,!1)};return s(toolsUniverse,"add"),{dragParentzIndex:0,dragParent:r,dropParent:dropParent,oldDragParent:oldDragParent,init:s}}(),initDrag=function(){var e,t,a=function(e){e.preventDefault()},n=function(e){e.preventDefault()},r=function(e){e.preventDefault(),cvOuter.classList.add("dropping")},s=function(o){o.preventDefault();var i=o.dataTransfer.getData("sealType"),l=o.dataTransfer.getData("src"),d=o.dataTransfer.getData("width"),c=o.dataTransfer.getData("height"),u=o.dataTransfer.getData("sealDesign"),p=o.dataTransfer.getData("sealValue");cvOuter.classList.remove("dropping");var v,g=sealTypes[i].max;document.querySelectorAll('[data-seal-type="'+i+'"].dropped-seal').length<g?("cubes"==i||"numbers"==i?((v=document.createElement("div")).classList.add("draggable-cubes"),v.setAttribute("data-seal-type",i),"numbers"==i&&(v.setAttribute("data-number-design",u),v.setAttribute("data-number-value",p)),v.innerHTML=`\n          <div class="cube-outer drag-area" data-index="0" data-seal-type="${i}">\n            <div class="cube"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>\n          <div class="detach-btn"></div>\n          `,v.addEventListener("dblclick",initCubes.remove,!1),v.addEventListener("click",initCubes.detachUI,!1)):((v=document.createElement("img")).src=l,v.width=d,v.height=c,v.classList.add("dropped-seal"),v.classList.add("drag-area"),v.setAttribute("data-seal-type",i),v.addEventListener("dblclick",e=>{v.remove()},!1)),v.setAttribute("data-id",++initDrag.draggablesId),v.style.zIndex=++initMove.dragParentzIndex,v.style.left=o.offsetX-e+"px",v.style.top=o.offsetY-t+"px",v.classList.add("draggable"),cvOuter.appendChild(v),initDrag.dropElHeight=v.getBoundingClientRect().height,initMove.init(v,"add"),cvOuter.removeEventListener("dragenter",a),cvOuter.removeEventListener("dragleave",n),cvOuter.removeEventListener("dragover",r),cvOuter.removeEventListener("drop",s)):alert("You can only place max "+g+" of "+i+" seal type.")};return{start:function(o){e=o.offsetX,t=o.offsetY,o.dataTransfer.setData("src",o.target.src),o.dataTransfer.setData("width",o.target.getBoundingClientRect().width),o.dataTransfer.setData("height",o.target.getBoundingClientRect().height),o.dataTransfer.setData("sealType",o.target.dataset.sealType),o.target.dataset.numberDesign&&(o.dataTransfer.setData("sealDesign",o.target.dataset.numberDesign),o.dataTransfer.setData("sealValue",o.target.dataset.numberValue)),cvOuter.addEventListener("dragenter",a,!1),cvOuter.addEventListener("dragleave",n,!1),cvOuter.addEventListener("dragover",r,!1),cvOuter.addEventListener("drop",s,!1)},draggablesId:0,dropElHeight:0}}(),fetchSeals=function(){for(var e in sealTypes){var t=document.querySelector('[data-panel="'+e+'"] .content');if(sealTypes.hasOwnProperty(e)){var a=sealTypes[e].values;if("numbers"==e)for(var n in a)for(var r=0;r<a[n].length;r++){var s=a[n][r][0],o=a[n][r][1],i=document.createElement("img");i.classList.add("draggable-seal"),i.setAttribute("data-seal-type",e),i.setAttribute("data-number-design",n),i.setAttribute("data-number-value",o),i.src="./_assets/img/"+s,t.appendChild(i)}else a.forEach(a=>{var n=document.createElement("img");n.classList.add("draggable-seal"),n.setAttribute("data-seal-type",e),n.src="./_assets/img/"+a,t.appendChild(n)})}}}(),initPanel=function(e){var t=oldPanel=panelType=panelBtn=panelPosObj=panelCloseBtn=panelScaleFlipBtn=panelScaleBtn=draggableSeals=rotateBtns=null,a=function(e){e.type?(t=this.closest(".draggable"),panelType=t.dataset.panel):(panelType=e,t=document.querySelector('[data-panel="'+panelType+'"]')),panelBtn=document.querySelector('[data-panel-btn="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelFlipBtn=t.querySelector(".flip-btn"),panelScaleBtn=t.querySelector(".scale-btn"),panelScaleFlipBtn=t.querySelector(".scale-flip-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),t.classList.remove("active"),panelBtn.classList.remove("active"),rotateBtns=t.querySelectorAll(".rotate-btn"),panelCloseBtn.removeEventListener("click",a,!1),initMove.init(t,"remove");for(var o=0;o<draggableSeals.length;o++)draggableSeals[o].removeEventListener("dragstart",initDrag.start,!1);for(o=0;o<rotateBtns.length;o++)rotateBtns[o].addEventListener("mousedown",initRotate.start,!1);if(panelScaleBtn&&panelScaleBtn.removeEventListener("mousedown",initScale.start,!1),panelFlipBtn&&panelFlipBtn.removeEventListener("click",r,!1),panelScaleFlipBtn&&panelScaleFlipBtn.removeEventListener("click",s,!1),"calculator"==panelType){var i=t.querySelectorAll("[data-button-type]");for(o=0;o<i.length;o++)i[o].removeEventListener("click",initCalc.calculate,!1)}if(t.classList.contains("draggable-seal")&&t.removeEventListener("click",n,!1),"scale"==panelType.substr(0,5)){var l=document.querySelectorAll('[data-tool-group-type="scale"].secondary.active'),d=document.querySelector('[data-tool-group-type="scale"]');l.length<1&&d.classList.remove("active")}else if("set-square"==panelType.substr(0,10)){l=document.querySelectorAll('[data-tool-group-type="set-square"].secondary.active'),d=document.querySelector('[data-tool-group-type="set-square"]');l.length<1&&d.classList.remove("active")}t.dataset.panelSet&&(initTools.currSetType=null)},n=function(e){t=this.closest(".draggable"),oldPanel!=t&&(t.style.zIndex=++initMove.dragParentzIndex,t.dataset.panelSet&&(initTools.currSetType=t.dataset.panel)),console.log("changing"),oldPanel=t},r=function(e){t.classList.contains("flipped")?t.classList.remove("flipped"):t.classList.add("flipped")},s=function(e){console.log("scale flipping")};return{toggle:function(e){if(panelType=e.dataset.panelBtn,e.classList.contains("active"))a(panelType);else{t=document.querySelector('[data-panel="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelScaleBtn=t.querySelector(".scale-btn"),panelFlipBtn=t.querySelector(".flip-btn"),rotateBtns=t.querySelectorAll(".rotate-btn"),panelScaleFlipBtn=t.querySelector(".scale-flip-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),e.classList.add("active"),t.classList.add("active"),t.style.zIndex=++initMove.dragParentzIndex,initMove.dragParent=t,initMove.oldDragParent=t,panelCloseBtn.addEventListener("click",a,!1),initMove.init(t,"add");for(var o=0;o<draggableSeals.length;o++)draggableSeals[o].addEventListener("dragstart",initDrag.start,!1);for(o=0;o<rotateBtns.length;o++)rotateBtns[o].addEventListener("mousedown",function(e){initRotate.start(e)},!1);if(panelScaleBtn&&panelScaleBtn.addEventListener("mousedown",initScale.start,!1),panelFlipBtn&&panelFlipBtn.addEventListener("click",r,!1),panelScaleFlipBtn&&panelScaleFlipBtn.addEventListener("click",s,!1),"calculator"==panelType){var i=t.querySelectorAll("[data-button-type]");for(o=0;o<i.length;o++)i[o].addEventListener("click",initCalc.calculate,!1)}t.classList.contains("draggable-seal")&&t.addEventListener("click",n,!1),t.dataset.panelSet&&(initTools.currSetType=t.dataset.panel)}},trashPanel:function(e,a,n){var r=math.getMousePosition(e,cv);if("start"==a){var s=(t=document.querySelector('[data-panel="'+n+'"]')).getBoundingClientRect();panelPosObj={x1:s.left,x2:s.left+s.width,y1:s.top,y2:s.top+s.height}}if("move"==a&&(t.style.zIndex=initMove.dragParentzIndex,t.classList.add("trash")),r.x>panelPosObj.x1&&r.x<panelPosObj.x2&&r.y>panelPosObj.y1&&r.y<panelPosObj.y2?t.classList.add("trash-active"):t.classList.remove("trash-active"),"end"==a)return t.classList.remove("trash"),!!t.classList.contains("trash-active")&&(t.classList.remove("trash-active"),!0)}}}(),initCubes=function(e){var t={},a=3,n=3,r=dragParentTop=shortestDist=snapType=dragParent=dropParent=cubeLimit=cubeOuter=null,s=null,o=function(){var e=whichTransitionEvent(),t=dragParent.querySelector("[data-seal-type]").dataset.sealType,s=dragParent.querySelector("img").src,o=dragParent.querySelector("img").width,i=dragParent.querySelector("img").height;if("numbers"==t&&(a=4,n=0),cubeLimit="vertical"==snapType?a:n,"vertical"==snapType)var l=dropParent.querySelectorAll(".drag-area").length,d=dragParent.querySelectorAll(".drag-area").length;else l=dropParent.querySelectorAll(".cube-outer").length,d=dragParent.querySelectorAll(".cube-outer").length;var c=l+d;if(c<=cubeLimit){if(cubeOuter="","vertical"==snapType){for(var u=0;u<d;u++)cubeOuter+=`\n            <div class="cube-outer drag-area" data-index="${l+u}" data-seal-type="${t}">\n              <div class="cube"><img src="${s}" style="width: ${o}px; height: ${i}px;"></div>\n            </div>        \n          `;initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent}else if("horizontal"==snapType){cubeOuter="";for(var p=0;p<c;p++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${p}" data-seal-type="${t}">`;for(u=0;u<a;u++)cubeOuter+=`<div class="cube"><img src="${s}" style="width: ${o}px; height: ${i}px;"></div>`;cubeOuter+="</div>"}cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>\n          <div class="detach-btn"></div>     \n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,initMove.init(dropParent,"add")}if("horizontal"==snapType&&dropParent.classList.add("horizontal"),(c=dropParent.querySelectorAll(".cube-outer").length)==cubeLimit){if("numbers"==t){for(u=0;u<a;u++)dropParent.querySelector('[data-index="'+u+'"]').remove();cubeOuter=`\n            <div class="cube-outer drag-area" data-index="0" data-seal-type="numbers">\n              <div class="cube"><img src="${"_assets/img/number-"+dropParent.dataset.numberDesign+"-"+10*dropParent.dataset.numberValue+".svg"}" style="width: ${o}px; height: ${i}px;"></div>\n            </div>        \n          `,dropParent.classList.remove("vertical"),dropParent.classList.remove("detach"),dropParent.setAttribute("data-number-value",10*dropParent.dataset.numberValue),dropParent.innerHTML+=cubeOuter}else if("cubes"==t)if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${s}" style="width: ${o}px; height: ${i}px;"></div>`;cubeOuter+='\n              </div>\n              <div class="dot dot-top"></div>\n              <div class="dot dot-bottom"></div>\n              <div class="dot dot-left"></div>\n              <div class="dot dot-right"></div>     \n              <div class="detach-btn"></div>\n            ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical")}else"horizontal"==snapType&&(dropParent=initMove.dropParent);console.log("limit reached!!!!!!!!!!")}initMove.init(dropParent,"add"),dragParent.remove()}else if(c>cubeLimit){var v=cubeLimit-l,g=d-v;if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${s}" style="width: ${o}px; height: ${i}px;"></div>`;cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>     \n          <div class="detach-btn"></div>\n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical");for(var m=0;m<v;m++)dragParent.querySelector('[data-index="'+(d-1-m)+'"].cube-outer').remove()}else if("horizontal"==snapType){cubeOuter="";for(p=0;p<v;p++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${l+p}" data-seal-type="${t}">`;for(u=0;u<a;u++)cubeOuter+=`<div class="cube"><img src="${s}" style="width: ${o}px; height: ${i}px;"></div>`;cubeOuter+="</div>"}if(initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent,1==g){cubeOuter='<div class="cube-outer">';for(u=0;u<a;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${t}"><img src="${s}" style="width: ${o}px; height: ${i}px;"></div>\n          `;cubeOuter+='\n            </div> \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n            <div class="detach-btn"></div>\n          ',initMove.dragParent.innerHTML=cubeOuter,dragParent=initMove.dragParent,initMove.init(dragParent,"add"),dragParent.classList.remove("horizontal")}else for(m=0;m<v;m++)dragParent.querySelector('[data-index="'+(d-1-m)+'"].cube-outer').remove()}initMove.init(dropParent,"add"),dragParent.style.left=r,dragParent.style.top=dragParentTop,initMove.init(dragParent,"add"),dragParent.classList.add("cant-snap"),console.log("limit reached!!!!!!!!!!")}dragParent.addEventListener(e,function t(){dragParent.removeEventListener(e,t);dragParent.classList.remove("cant-snap")}),dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight")},i=function(e){var t,a=dragParent.style.left,n=dragParent.style.top,r=parseFloat(a),o=dragParent.querySelector(".drag-area").getBoundingClientRect().height,i=dragParent.dataset.sealType,d=dragParent.querySelector("img").src,c=dragParent.querySelector("img").width,u=dragParent.querySelector("img").height;if(e.target.classList.contains("detach-btn"))if("vertical"==s){console.log("vertical detaching all");for(var p=dragParent.querySelectorAll(".drag-area").length,v=1;v<p;v++)dragParent.querySelector('[data-index="'+v+'"]').remove(),dragParent.classList.remove("detach");for(v=1;v<p;v++){var g=document.createElement("div");g.classList.add("draggable-cubes"),g.classList.add("draggable"),g.setAttribute("data-id",++initDrag.draggablesId),g.setAttribute("data-seal-type",i),g.style.left=r+"px",g.style.top=parseFloat(n)+o*v+30*v+"px",g.style.zIndex=++initMove.dragParentzIndex,"numbers"==i&&(g.setAttribute("data-number-design",dragParent.dataset.numberDesign),g.setAttribute("data-number-value",dragParent.dataset.numberValue)),t=`\n            <div class="cube-outer drag-area" data-index="0" data-seal-type="${i}">\n            <div class="cube"><img src="${d}" style="width: ${c}px; height: ${u}px;"></div>\n            </div>        \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n            <div class="detach"></div>     \n          `,g.innerHTML=t,cvOuter.appendChild(g),initMove.init(g,"add"),g.addEventListener("dblclick",l,!1)}}else console.log("horizontal detaching all");else dragParent.querySelectorAll(".drag-area").length>1&&(dragParent.classList.contains("detach")?dragParent.classList.remove("detach"):dragParent.classList.add("detach"))},l=function(e){e.target.closest(".draggable").remove()};return{isSnapping:!1,snapDist:40,shortestDist:shortestDist,getCoords:function(){dragParent=initMove.dragParent,snapType=dragParent.classList.contains("vertical")?"horizontal":"vertical",s=dragParent.classList.contains("horizontal")?"horizontal":"vertical",t={};var e=dropDotCoord_1=null,a=document.querySelectorAll(".draggable-cubes");for(let r=0;r<a.length;r++)if(a[r]!=dragParent){"vertical"==snapType?(e=a[r].querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=a[r].querySelector(".dot-bottom").getBoundingClientRect()):(e=a[r].querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=a[r].querySelector(".dot-right").getBoundingClientRect());var n=a[r].dataset.id,o={0:{x:e.x,y:e.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}};t[n]=o}r=dragParent.style.left,dragParentTop=dragParent.style.top},getShortestDist:function(){var e=null;({i:0,j:0,id:""}),"vertical"==snapType?(dropDotCoord_0=dragParent.querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-bottom").getBoundingClientRect()):(dropDotCoord_0=dragParent.querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-right").getBoundingClientRect());for(var a={0:{x:dropDotCoord_0.x,y:dropDotCoord_0.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}},n=0;n<1;n++)for(var r in t){var s=0==n?1:0;if(t.hasOwnProperty(r)){var o=a[n].x,i=a[n].y,l=o-t[r][s].x,d=i-t[r][s].y,c=parseFloat(Math.sqrt(l*l+d*d).toFixed(2));(null==e||e>c)&&(e=c,{i:0==n?0:1,j:0==s?0:1,id:r},initCubes.shortestDist=e,dropParent=initMove.dropParent=document.querySelector('[data-id="'+r+'"'),"vertical"==snapType&&dropParent.classList.contains("vertical"),"horizontal"==snapType&&(dragParent.classList.contains("vertical")&&dropParent.classList.contains("vertical")||(initCubes.shortestDist=null)))}}dropParent&&("cubes"==dragParent.dataset.sealType?dragParent.dataset.sealType!=dropParent.dataset.sealType&&(initCubes.shortestDist=null):"numbers"==dragParent.dataset.sealType&&(dragParent.dataset.numberDesign==dropParent.dataset.numberDesign&&dragParent.dataset.numberValue==dropParent.dataset.numberValue||(initCubes.shortestDist=null)),"10000"==dragParent.dataset.numberValue&&(initCubes.shortestDist=null))},highlight:function(e){e?(dragParent.classList.add("highlight"),dropParent.classList.add("highlight")):(dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight"))},snap:o,snap:o,detachUI:i,detachUI:i,remove:l,remove:l}}(),initRotate=function(){var e,t,a,n,r=null,s=null,o=null,i=null,l=null,d=null,c=null,u={x:0,y:0},p=180/Math.PI,v=function(e){mousedown=mousemove=!1,initTools.currToolType=c,cvOuter.onmousemove=null,cvOuter.removeEventListener("mouseup",v,!1)},g=function(e){mousedown&&mousemove&&console.log("rotate"),mousemove=!0,e.preventDefault(),a=e.clientX-u.x,n=e.clientY-u.y,t=Math.floor(p*Math.atan2(n,a)),s=t-r,"clock"==d?i.style.transform="translateY(-50%) rotate("+t+"deg)":"compass"==d?o.classList.contains("rotate-point")?i.style.transform="translateY(-50%) rotate("+t+"deg)":o.classList.contains("rotate-pencil")?(t>130?t=130:t<95&&(t=95),i.style.transform="translateY(-50%) rotate("+t+"deg)"):o.classList.contains("rotate-compass")||(i.style.transform="rotate("+s+"deg)"):i.style.transform="rotate("+s+"deg)"};return{start:function(t){var s,m,y,h,b;console.log("start"),t.preventDefault(),mousedown=!0,o=t.target,e=o.closest(".draggable"),d=e.dataset.panel,i=o.closest(".rotatable"),l!=e&&(r=null),l=e,b=i,"compass"==d&&(o.classList.contains("rotate-compass")?(c=initTools.currToolType,initTools.currToolType="arc",initDraw.start(t)):(o.classList.contains("rotate-point")||o.classList.contains("rotate-pencil"))&&(b=e.querySelector(".rotate-hand-ref"))),refObj=b.getBoundingClientRect(),y=refObj.top,m=refObj.left,s=refObj.height,h=refObj.width,u={x:m+h/2,y:y+s/2},a=t.clientX-u.x,n=t.clientY-u.y,"compass"==d?o.classList.contains("rotate-point")||o.classList.contains("rotate-pencil")?void 0==e.dataset.angleHand?(r=Math.floor(p*Math.atan2(n,a)),e.setAttribute("data-angle-hand",r)):r=e.dataset.angleHand:o.classList.contains("btn")?void 0==e.dataset.angle?(r=Math.floor(p*Math.atan2(n,a)),e.setAttribute("data-angle",r)):r=e.dataset.angle:o.classList.contains("rotate-compass")&&(void 0==e.dataset.angleCompass?(console.log(1),r=Math.floor(p*Math.atan2(n,a)),e.setAttribute("data-angle-compass",r)):(console.log(2),r=e.dataset.angleCompass),e.dataset.angle&&(console.log(3),console.log(r))):void 0==e.dataset.angle?(r=Math.floor(p*Math.atan2(n,a)),e.setAttribute("data-angle",r)):r=e.dataset.angle,cvOuter.onmousemove=function(e){g(e)},cvOuter.addEventListener("mouseup",v,!1)}}}(),initScale=function(e){var t,a,n=document.querySelector('[data-panel="protractor"]'),r=null,s=null,o=null,i=null,l=function(e){e.preventDefault(),a=math.getMousePosition(e,cv),o=a.x-t.x,console.log(r,o,i,r+o,r*i),i>1&&(n.style.width=r+o+"px",n.style.height=s+o*i+"px")},d=function(e){cvOuter.removeEventListener("mousemove",l,!1),cvOuter.removeEventListener("mouseup",d,!1)};return{start:function(e){r=n.getBoundingClientRect().width,s=n.getBoundingClientRect().height,i=r/s,t=math.getMousePosition(e,cv),cvOuter.addEventListener("mousemove",l,!1),cvOuter.addEventListener("mouseup",d,!1)}}}(),initCalc=function(e){var num="",calculate=function(e){var result=document.querySelector('[data-panel="calculator"] #result'),buttonType=e.target.closest("g[data-button-type]").dataset.buttonType,buttonValue=e.target.closest("g[data-button-type]").dataset.buttonValue;if("num"==buttonType)num+=buttonValue,result.innerHTML=num;else if("func"==buttonType){switch(buttonValue){case"=":num=eval(num).toString();break;case"<-":num=num.slice(0,-1);break;case"c":case"ac":num="";break;case"*":case"/":case"+":case"-":num+=" "+buttonValue+" "}result.innerHTML=num}};return{calculate:calculate}}(),initAbacus=function(){window.onload=function(){mousedown=0,body=document.querySelector("body"),body.addEventListener("mousedown",function(){mousedown=1}),body.addEventListener("mouseup",function(){mousedown=0}),upper_part=document.querySelectorAll(".upper_layer"),upper_part.forEach(function(e){e.addEventListener("click",function(e,t,a){t.style.background="red","down"==t.dataset.pos?(t.setAttribute("transform","translate(0,-20)"),t.dataset.pos="up"):(t.setAttribute("transform","translate(0,0)"),t.dataset.pos="down")}.bind(null,event,e)),e.addEventListener("mousemove",function(e,t,a){mousedown&&t.setAttribute("transform","translate(0,0)")}.bind(null,event,e))}),lower_part=document.querySelectorAll(".bottom_boxes"),lower_part.forEach(function(e){e.addEventListener("click",function(e,t,a){if(column_id=t.parentNode.getAttribute("id"),boxes=document.querySelectorAll("#"+column_id+" .bottom_boxes"),till=t.dataset.pos,"down"==t.dataset.state)for(i=0;i<=till;++i)boxes[i].setAttribute("transform","translate(0,-43)"),boxes[i].dataset.state="up";else for(i=till;i<=3;++i)boxes[i].setAttribute("transform","translate(0,0)"),boxes[i].dataset.state="down"}.bind(null,event,e)),e.addEventListener("mousemove",function(e,t,a){if(column_id=t.parentNode.getAttribute("id"),boxes=document.querySelectorAll("#"+column_id+" .bottom_boxes"),mousedown&&"up"==t.dataset.state)for(i=0;i<=3;++i)boxes[i].setAttribute("transform","translate(0,0)"),boxes[i].dataset.state="down"}.bind(null,event,e))})}},math=function(e){var t=0,a=!1,n=function(e){return{left:e.getBoundingClientRect().left,right:e.getBoundingClientRect().top}},r=function(e){var t=(e.p2.y-e.p1.y)/(e.p2.x-e.p1.x);return math.parseToFloat(t,2)},s=function(e,t,a){return a==1/0||a==-1/0?Math.abs(e.p1.x-t.x):Math.abs((a*t.x-t.y+e.p1.y-a*e.p1.x)/Math.sqrt(1+a*a))};return{parseToFloat:function(e,t){return parseFloat(e.toFixed(t))},getMousePosition:function(e,t){var a=n(t),r={x:0,y:0};return r.x=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientX:e.clientX)-a.left).toFixed(2)),r.y=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientY:e.clientY)-a.right).toFixed(2)),r},sideAndRange:function(e){var n,o=function(e){var t={},a=math.getSetPoints(initTools.currSetType),n=Object.size(a);for(let e=1;e<=n;e++){var r=e==n?1:e+1,s={p1:a[e],p2:a[r]};t["l"+e+r]=s}return t}(),i=(e.x-o.l12.p1.x)*(o.l12.p2.y-o.l12.p1.y)-(e.y-o.l12.p1.y)*(o.l12.p2.x-o.l12.p1.x),l=(e.x-o.l34.p1.x)*(o.l34.p2.y-o.l34.p1.y)-(e.y-o.l34.p1.y)*(o.l34.p2.x-o.l34.p1.x),d=(e.x-o.l23.p1.x)*(o.l23.p2.y-o.l23.p1.y)-(e.y-o.l23.p1.y)*(o.l23.p2.x-o.l23.p1.x),c=(e.x-o.l41.p1.x)*(o.l41.p2.y-o.l41.p1.y)-(e.y-o.l41.p1.y)*(o.l41.p2.x-o.l41.p1.x),u="";if(i<0&&l<0||i>0&&l>0||d<0&&c<0||d>0&&c>0){if("12_34"==(i<0&&l<0||i>0&&l>0?"12_34":"23_41")){t=r(o.l23);var p=s(o.l23,e,t),v=s(o.l41,e,t);p<v?(n=p,nearestLine=o.l23,u=2,startPoint=e):(n=v,nearestLine=o.l41,u=4)}else{t=r(o.l12);var g=s(o.l12,e,t),m=s(o.l34,e,t);g<m?(n=g,nearestLine=o.l12,u=1):(n=m,nearestLine=o.l34,u=3)}a=50>=n&&(1==u||3==u)}else a=!1;return{inRange:a,side:u,slope:t,slope:t}},getSetPoints:function(e){var t={},a=document.querySelector('[data-panel="'+e+'"]').querySelectorAll(".point"),r=n(cv);for(let e=0;e<a.length;e++){var s={x:"",y:""},o=r.left,i=r.right,l=a[e].getBoundingClientRect().left,d=a[e].getBoundingClientRect().top,c=a[e].getBoundingClientRect().width,u=a[e].getBoundingClientRect().height;s.x=parseFloat((l+c/2-o).toFixed(2)),s.y=parseFloat((d+u/2-i).toFixed(2)),t[e+1]=s}return t},getCoords:function(e,t,a,n){var r,s,o=initDraw.strokeWidth/2;return 0==n?(o=1==t?e[1].x<e[3].x?-o:o:e[1].x<e[3].x?o:-o,r=a.x,s=e[t].y+o):n==1/0||n==-1/0?(o=1==t?e[1].x<e[3].x?-o:o:e[1].x<e[3].x?o:-o,r=e[t].x+o,s=a.y):(x1=(a.x/n+n*e[t].x+a.y-e[t].y)/(n+1/n),y1=n*(x1-e[t].x)+e[t].y,n=-1/n,e[1].x>e[4].x?(1==t?r=x1+Math.sqrt(o*o/(1+n*n)):3==t&&(r=x1-Math.sqrt(o*o/(1+n*n))),s=n*(r-x1)+y1):(1==t?r=x1-Math.sqrt(o*o/(1+n*n)):3==t&&(r=x1+Math.sqrt(o*o/(1+n*n))),s=n*(r-x1)+y1)),{x:r,y:s}}}}();document.querySelector('[data-tool-type1="pen"]').click();
//# sourceMappingURL=script.min.js.map
