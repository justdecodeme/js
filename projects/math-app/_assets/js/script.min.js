var cv=document.getElementById("cv"),cvOuter=document.getElementById("cvOuter"),pointsObj={},linesss={},isSetInRange=!1,toolDrawingOffset=50,inRange=!1,slope=0,isDrawingModeOn=!1,isStartedInRange=!1,nearestLineStarted,nearestLine;function whichTransitionEvent(){var e,t=document.createElement("fakeelement"),a={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in a)if(void 0!==t.style[e])return a[e]}function getElPosition(e){return{left:e.getBoundingClientRect().left,right:e.getBoundingClientRect().top}}function getMousePosition(e,t){var a=getElPosition(t),r={x:0,y:0};return r.x=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientX:e.clientX)-a.left).toFixed(2)),r.y=parseFloat((("touchstart"==e.type||"touchmove"==e.type?e.touches[0].clientY:e.clientY)-a.right).toFixed(2)),r}function parseToFloat(e,t){return parseFloat(e.toFixed(t))}function getPointsCoordinates(){pointsObj={};var e=document.querySelector("#scale").querySelectorAll(".point"),t=getElPosition(cv);for(let d=0;d<e.length;d++){var a={x:"",y:""},r=t.left,n=t.right,s=e[d].getBoundingClientRect().left,i=e[d].getBoundingClientRect().top,o=e[d].getBoundingClientRect().width,l=e[d].getBoundingClientRect().height;a.x=parseFloat((s+o/2-r).toFixed(2)),a.y=parseFloat((i+l/2-n).toFixed(2)),pointsObj[d+1]=a}}function getLines(){var e=Object.size(pointsObj);for(let r=1;r<=e;r++){var t=r==e?1:r+1,a={p1:pointsObj[r],p2:pointsObj[t]};linesss["l"+r+t]=a}}function getSlope(e){return parseToFloat((e.p2.y-e.p1.y)/(e.p2.x-e.p1.x),2)}function calculatePerpendicularDistFromLine(e,t,a){return a==1/0||a==-1/0?Math.abs(e.p1.x-t.x):Math.abs((a*t.x-t.y+e.p1.y-a*e.p1.x)/Math.sqrt(1+a*a))}function checkDrawingSide(e){var t,a=(e.x-linesss.l12.p1.x)*(linesss.l12.p2.y-linesss.l12.p1.y)-(e.y-linesss.l12.p1.y)*(linesss.l12.p2.x-linesss.l12.p1.x),r=(e.x-linesss.l34.p1.x)*(linesss.l34.p2.y-linesss.l34.p1.y)-(e.y-linesss.l34.p1.y)*(linesss.l34.p2.x-linesss.l34.p1.x),n=(e.x-linesss.l23.p1.x)*(linesss.l23.p2.y-linesss.l23.p1.y)-(e.y-linesss.l23.p1.y)*(linesss.l23.p2.x-linesss.l23.p1.x),s=(e.x-linesss.l41.p1.x)*(linesss.l41.p2.y-linesss.l41.p1.y)-(e.y-linesss.l41.p1.y)*(linesss.l41.p2.x-linesss.l41.p1.x),i="";if(a<0&&r<0||a>0&&r>0||n<0&&s<0||n>0&&s>0){if("12_34"==(a<0&&r<0||a>0&&r>0?"12_34":"23_41")){slope=getSlope(linesss.l23);var o=calculatePerpendicularDistFromLine(linesss.l23,e,slope),l=calculatePerpendicularDistFromLine(linesss.l41,e,slope);o<l?(t=o,nearestLine=linesss.l23,i="Side 2",startPoint=e):(t=l,nearestLine=linesss.l41,i="Side 4")}else{slope=getSlope(linesss.l12);var d=calculatePerpendicularDistFromLine(linesss.l12,e,slope),c=calculatePerpendicularDistFromLine(linesss.l34,e,slope);d<c?(t=d,nearestLine=linesss.l12,i="Side 1"):(t=c,nearestLine=linesss.l34,i="Side 3")}toolDrawingOffset>=t?inRange=!0:isDrawingModeOn||(inRange=!1)}else isDrawingModeOn||(inRange=!1);inRange&&console.log(i)}Object.size=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a};var initTools=function(){var e=document.getElementById("toolsUniverse"),t=e.querySelectorAll(".tools-planet"),a=document.getElementById("toolsPlanetSets"),r=document.getElementById("toolsPlanetPens"),n=(e.offsetWidth,document.getElementById("minimizeToggleBtn")),s=document.getElementById("toolsPlanetSetsBtn"),i=document.getElementById("toolsPlanetPensBtn"),o=currSetType=null;t.forEach(function(e){var t=e.querySelectorAll("#"+e.id+">.tools-satellite.primary"),a=e.querySelector(".tools-satellite:first-child").offsetWidth,r=e.offsetWidth,n=(t.length,(r-a)/2);t.forEach(function(t,a){var r=a-3,s=Math.round(110*Math.cos(30*r*(Math.PI/180))),i=Math.round(110*Math.sin(30*r*(Math.PI/180))),o=Math.round(s+n),l=Math.round(i+n);if(t.style.left=o+"px",t.style.top=l+"px",t.classList.contains("has-child")){let a=t.dataset.toolGroupType,r=19,s=165;e.querySelectorAll('[data-tool-group-type="'+a+'"].secondary').forEach(function(e,t){let i=t-4.5;switch(a){case"pastel1":i=t+.7;break;case"pastel2":i=t+2.2;break;case"stroke":i=t+3.8;break;case"opacity":i=t+5.2;break;case"scale":i=t-4.5}let o=Math.sin(r*i*(Math.PI/180))*s,l=Math.cos(r*i*(Math.PI/180))*s;e.style.top=(o+n).toString()+"px",e.style.left=(l+n).toString()+"px"})}})}),a.classList.add("active"),s.classList.add("active"),s.classList.add("temp-active");var l=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type1].active");t&&(t.classList.remove("active"),initTools.currToolType=null,cv.removeEventListener("mousedown",initDraw.drawStart,!1)),t!=e&&(e.classList.add("active"),initTools.currToolType=e.dataset.toolType1,cv.addEventListener("mousedown",initDraw.drawStart,!1))},d=function(e){var t=document.querySelector("#toolsPlanetPens [data-tool-type2].active");t&&t!=e&&(t.classList.remove("active"),e.classList.add("active")),initDraw.strokeColor=e.dataset.value},c=function(e,t,a,r){if(a)t.classList.contains("show-child")?t.classList.remove("show-child"):(document.querySelector(".has-child.show-child")&&document.querySelector(".has-child.show-child").classList.remove("show-child"),t.classList.add("show-child"));else if(r){var n=document.querySelector('[data-tool-group-type="'+e+'"].primary'),s=document.querySelector('[data-tool-group-type="'+e+'"].secondary.active');switch("pastel"==e.substr(0,6)&&(document.querySelector("[data-tool-type2].primary.active").classList.remove("active"),n.setAttribute("data-tool-type2","pastel"),e="pastel"),s&&s.classList.remove("active"),t.classList.add("active"),n.classList.add("active"),n.classList.remove("show-child"),e){case"opacity":initDraw.strokeOpacity=parseFloat(t.dataset.value);break;case"stroke":initDraw.strokeWidth=parseFloat(t.dataset.value);break;case"pastel":var i=t.querySelector("img").getAttribute("src");n.querySelector("img").setAttribute("src",i),n.setAttribute("data-value",t.dataset.value),initDraw.strokeColor=t.dataset.value}}};return e.addEventListener("click",function(t){var o=t.target,u=o.id,v=o.dataset.toolType1,p=o.dataset.toolType2,g=o.dataset.toolGroupType,y=o.classList.contains("primary"),m=o.classList.contains("secondary"),h=o.dataset.panelBtn;"minimizeToggleBtn"==u?document.querySelector(".tools-planet.active")?(n.classList.add("active"),e.classList.remove("active"),s.classList.remove("active"),i.classList.remove("active"),document.querySelector(".tools-planet.active").classList.add("temp-active"),document.querySelector(".tools-planet.active").classList.remove("active")):(e.classList.add("active"),n.classList.remove("active"),document.querySelector(".tools-toggle .temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.add("active"),document.querySelector(".tools-planet.temp-active").classList.remove("temp-active")):"toolsPlanetPensBtn"==u?(s.classList.remove("active"),s.classList.remove("temp-active"),a.classList.remove("active"),i.classList.add("active"),i.classList.add("temp-active"),r.classList.add("active"),e.classList.add("active"),n.classList.remove("active")):"toolsPlanetSetsBtn"==u?(i.classList.remove("active"),i.classList.remove("temp-active"),r.classList.remove("active"),s.classList.add("active"),s.classList.add("temp-active"),a.classList.add("active"),e.classList.add("active"),n.classList.remove("active")):"undo"==u?initDraw.undo():"redo"==u?initDraw.redo():"clear"==u?initDraw.clear():v?l(o):p?d(o):h&&initPanel.toggle(o),g&&c(g,o,y,m)},!1),{currToolType:o,currSetType:currSetType}}(),initDraw=function(){var e,t=document.querySelector('[data-tool-group-type="opacity"].secondary.active'),a=parseFloat(t.dataset.value),r=document.querySelector('[data-tool-group-type="stroke"].secondary.active'),n=null,s=0,i=[],o=[],l=function(t){t.preventDefault();var a,r,s,l,c=initTools.currToolType,u=getMousePosition(t,cv);if("pen"==c||"marker"==c){if(r=(a=document.getElementById(n)).getAttribute("points"),"marker"==c)r=e.x+","+e.y+" "+u.x+","+u.y;else if("pen"==c)if(isStartedInRange&&(nearestLineStarted!=nearestLine&&(nearestLineStarted=nearestLine,console.log("side updated")),checkDrawingSide(u)),inRange){var v=slope;0==v?(s=u.x,l=e.y,console.log("111111111")):v==1/0||v==-1/0?(s=e.x,l=u.y,console.log("2222222222")):(console.log("3333333333"),l=1*(v*((s=(u.x/v+v*e.x+u.y-e.y)/(v+1/v))-e.x)+e.y)),r+=" "+s+","+l}else r+=" "+u.x+","+u.y;a.setAttribute("points",r)}else if("eraser"==c){var p=t.target;p.classList.contains("drawing")&&(o=[],i.push({Elements:[p],Id:p.id,Action:"erase"}),p.remove())}cv.addEventListener("mouseleave",d,!1)},d=function(){null!==n&&null!=document.getElementById(n)&&i.push({Elements:[],Id:n,Action:"draw"}),cv.removeEventListener("mousemove",l,!1),cv.removeEventListener("mouseup",d,!1),cv.removeEventListener("mouseleave",d,!1)};return{undo:function(){if(i.length>0){var e,t=i.pop();switch(t.Action){case"draw":e=document.getElementById(t.Id),t.Elements.push(e),e.parentNode.removeChild(e);break;case"erase":cv.appendChild(t.Elements[0]);break;case"clear":t.Elements.forEach(function(e){cv.appendChild(e),s++})}o.push(t)}},redo:function(){if(o.length>0){var e,t=o.pop();switch(t.Action){case"draw":e=t.Elements[0],cv.appendChild(e);break;case"erase":(e=t.Elements[0]).parentNode.removeChild(e);break;case"clear":t.Elements.forEach(function(e){e.parentNode.removeChild(e)})}i.push(t)}},clear:function(){s=0;var e=document.querySelectorAll(".drawing");o=[],i.push({Elements:e,Id:null,Action:"clear"}),cv.innerHTML=""},strokeOpacity:a,strokeWidth:parseFloat(r.dataset.value),strokeColor:document.querySelector('[data-tool-type2="pastel"].primary.active').dataset.value,drawStart:function(t){t.preventDefault();var a,r=initDraw.strokeOpacity,i=initDraw.strokeColor,o=initDraw.strokeWidth,c=initDraw.strokeWidth+10,u=initTools.currToolType,v=getMousePosition(t,cv);n="shape"+s,isDrawingModeOn=!0,getPointsCoordinates(),getLines(),checkDrawingSide(v),inRange?(isStartedInRange=!0,nearestLineStarted=nearestLine):isStartedInRange=!1,"pen"!=u&&"marker"!=u||("pen"==u?a='<polyline class="drawing" id="'+n+'" style="opacity:'+r+";fill:none;stroke-linecap:round;stroke:"+i+";stroke-width:"+o+'" points="'+v.x+","+v.y+'" />':"marker"==u&&(a='<polyline class="drawing" id="'+n+'" style="fill:none;stroke-linecap:round;stroke:rgba(0, 255, 0, .5);stroke-width:'+c+'" points="'+v.x+","+v.y+'" />'),cv.innerHTML+=a),cv.addEventListener("mousemove",l,!1),cv.addEventListener("mouseup",d,!1),s++,e=v}}}(),initMove=function(){var e=0,t=0,a=0,r=0,n=dropParent=oldDragParent=null,s=function(e,t){var a=e.querySelectorAll(".drag-area");"add"==t?a.length>0?a.forEach(function(e){e.addEventListener("mousedown",i,!1)}):e.addEventListener("mousedown",i,!1):"remove"==t&&(a.length>0?a.forEach(function(e){e.removeEventListener("mousedown",i,!1)}):e.removeEventListener("mousedown",i,!1))},i=function(a){var r=getMousePosition(a,cv);initMove.dragParent=a.target.closest(".draggable");var n=initMove.dragParent;a.target.classList.contains("drag-area")&&(cvOuter.classList.add("dragging"),e=r.x,t=r.y,n!=initMove.oldDragParent&&(n.style.zIndex=++initMove.dragParentzIndex),initMove.oldDragParent=initMove.dragParent,n.classList.contains("draggable-cubes")&&initCubes.getCoords(),cvOuter.addEventListener("mousemove",o,!1),cvOuter.addEventListener("mouseup",l,!1),n.addEventListener("dragstart",initDrag.start,!1)),n.dataset.sealType&&initPanel.trashPanel(a,"start",n.dataset.sealType)},o=function(n){n.preventDefault();var s=getMousePosition(n,cv),i=initMove.dragParent;if(a=e-s.x,r=t-s.y,e=s.x,t=s.y,i.style.left=i.offsetLeft-a+"px",i==toolsUniverse){var o=cvOuter.getBoundingClientRect().height-i.getBoundingClientRect().height-i.offsetTop;i.style.bottom=o+r+"px"}else i.style.top=i.offsetTop-r+"px";i.classList.contains("draggable-cubes")&&(initCubes.getShortestDist(),null!=initCubes.shortestDist&&(initCubes.shortestDist<initCubes.snapDist?initCubes.highlight(!0):initCubes.highlight(!1))),i.dataset.sealType&&initPanel.trashPanel(n,"move")},l=function(e){e.preventDefault();var t=initMove.dragParent;cvOuter.classList.remove("dragging"),t.classList.contains("draggable-cubes")&&null!=initCubes.shortestDist&&initCubes.shortestDist<initCubes.snapDist&&(initCubes.snap(),initCubes.shortestDist=null),t.dataset.sealType&&initPanel.trashPanel(e,"end")&&t.remove(),cvOuter.removeEventListener("mousemove",o,!1),cvOuter.removeEventListener("mouseup",l,!1),t.removeEventListener("dragstart",initDrag.start,!1)};return s(toolsUniverse,"add"),{dragParentzIndex:0,dragParent:n,dropParent:dropParent,oldDragParent:oldDragParent,init:s}}(),initDrag=function(){var e,t,a=function(e){e.preventDefault()},r=function(e){e.preventDefault()},n=function(e){e.preventDefault(),cvOuter.classList.add("dropping")},s=function(i){i.preventDefault();var o=i.dataTransfer.getData("sealType"),l=i.dataTransfer.getData("src"),d=i.dataTransfer.getData("width"),c=i.dataTransfer.getData("height");cvOuter.classList.remove("dropping");var u,v=sealTypes[o].max;document.querySelectorAll('[data-seal-type="'+o+'"].dropped-seal').length<v?("cubes"==o?((u=document.createElement("div")).classList.add("draggable-cubes"),u.setAttribute("data-seal-type",o),u.innerHTML=`\n          <div class="cube-outer drag-area" data-index="0" data-seal-type="${o}">\n            <div class="cube"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>\n          `,u.addEventListener("dblclick",initCubes.detach,!1)):((u=document.createElement("img")).src=l,u.width=d,u.height=c,u.classList.add("dropped-seal"),u.classList.add("drag-area"),u.setAttribute("data-seal-type",o),u.addEventListener("dblclick",e=>{u.remove()},!1)),u.setAttribute("data-id",++initDrag.draggablesId),u.style.zIndex=++initMove.dragParentzIndex,u.style.left=i.offsetX-e+"px",u.style.top=i.offsetY-t+"px",u.classList.add("draggable"),cvOuter.appendChild(u),initDrag.dropElHeight=u.getBoundingClientRect().height,initMove.init(u,"add"),cvOuter.removeEventListener("dragenter",a),cvOuter.removeEventListener("dragleave",r),cvOuter.removeEventListener("dragover",n),cvOuter.removeEventListener("drop",s)):alert("You can only place max "+v+" of "+o+" seal type.")};return{start:function(i){e=i.offsetX,t=i.offsetY,i.dataTransfer.setData("src",i.target.src),i.dataTransfer.setData("width",i.target.getBoundingClientRect().width),i.dataTransfer.setData("height",i.target.getBoundingClientRect().height),i.dataTransfer.setData("sealType",i.target.dataset.sealType),cvOuter.addEventListener("dragenter",a,!1),cvOuter.addEventListener("dragleave",r,!1),cvOuter.addEventListener("dragover",n,!1),cvOuter.addEventListener("drop",s,!1)},draggablesId:0,dropElHeight:0}}(),fetchSeals=function(){for(var e in sealTypes){var t=document.querySelector('[data-panel="'+e+'"] .content');if(sealTypes.hasOwnProperty(e))sealTypes[e].values.forEach(a=>{var r=document.createElement("img");r.classList.add("draggable-seal"),r.setAttribute("data-seal-type",e),r.src="./_assets/img/"+a,t.appendChild(r)})}}(),initPanel=function(e){var t=oldPanel=panelType=panelBtn=panelPosObj=panelCloseBtn=panelScaleBtn=draggableSeals=rotateBtns=null,a=function(e){e.type?(t=this.closest(".draggable"),panelType=t.dataset.panel):(panelType=e,t=document.querySelector('[data-panel="'+panelType+'"]')),panelBtn=document.querySelector('[data-panel-btn="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelScaleBtn=t.querySelector(".scale-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),t.classList.remove("active"),panelBtn.classList.remove("active"),rotateBtns=t.querySelectorAll(".rotate-btn"),t.removeEventListener("click",r,!1),panelCloseBtn.removeEventListener("click",a,!1),initMove.init(t,"remove");for(var n=0;n<draggableSeals.length;n++)draggableSeals[n].removeEventListener("dragstart",initDrag.start,!1);rotateBtns.length>0&&rotateBtns.forEach(e=>{e.removeEventListener("mousedown",initRotate.start,!1)}),panelScaleBtn&&panelScaleBtn.removeEventListener("mousedown",initScale.start,!1),t.dataset.panelSet&&(currSetType=null)},r=function(e){t=this.closest(".draggable"),oldPanel!=t&&(t.style.zIndex=++initMove.dragParentzIndex),oldPanel=t};return{toggle:function(e){if(panelType=e.dataset.panelBtn,e.classList.contains("active"))a(panelType);else{t=document.querySelector('[data-panel="'+panelType+'"]'),panelCloseBtn=t.querySelector(".close-btn"),panelScaleBtn=t.querySelector(".scale-btn"),rotateBtns=t.querySelectorAll(".rotate-btn"),draggableSeals=t.getElementsByClassName("draggable-seal"),e.classList.add("active"),t.classList.add("active"),t.style.zIndex=++initMove.dragParentzIndex,initMove.dragParent=t,initMove.oldDragParent=t,t.addEventListener("click",r,!1),panelCloseBtn.addEventListener("click",a,!1),initMove.init(t,"add");for(var n=0;n<draggableSeals.length;n++)draggableSeals[n].addEventListener("dragstart",initDrag.start,!1);rotateBtns.length>0&&rotateBtns.forEach(e=>{e.addEventListener("mousedown",initRotate.start,!1)}),panelScaleBtn&&panelScaleBtn.addEventListener("mousedown",initScale.start,!1),t.dataset.panelSet&&(currSetType=t.dataset.panelSet)}},trashPanel:function(e,a,r){var n=getMousePosition(e,cv);if("start"==a){var s=(t=document.querySelector('[data-panel="'+r+'"]')).getBoundingClientRect();panelPosObj={x1:s.left,x2:s.left+s.width,y1:s.top,y2:s.top+s.height},t.style.zIndex=initMove.dragParentzIndex,t.classList.add("trash")}if(n.x>panelPosObj.x1&&n.x<panelPosObj.x2&&n.y>panelPosObj.y1&&n.y<panelPosObj.y2?t.classList.add("trash-active"):t.classList.remove("trash-active"),"end"==a)return t.classList.remove("trash"),!!t.classList.contains("trash-active")&&(t.classList.remove("trash-active"),!0)}}}(),initCubes=function(e){var t={},a=dragParentTop=shortestDist=snapType=dragParent=dropParent=cubeLimit=cubeOuter=null,r=null,n=function(){var e=whichTransitionEvent();cubeLimit=(snapType,3);var t=dragParent.querySelector("[data-seal-type]").dataset.sealType,r=dragParent.querySelector("img").src,n=dragParent.querySelector("img").width,s=dragParent.querySelector("img").height;if("vertical"==snapType)var i=dropParent.querySelectorAll(".drag-area").length,o=dragParent.querySelectorAll(".drag-area").length;else i=dropParent.querySelectorAll(".cube-outer").length,o=dragParent.querySelectorAll(".cube-outer").length;var l=i+o;if(l<=cubeLimit){if(cubeOuter="","vertical"==snapType){for(var d=0;d<o;d++)cubeOuter+=`\n            <div class="cube-outer drag-area" data-index="${i+d}" data-seal-type="${t}">\n              <div class="cube"><img src="${r}" style="width: ${n}px; height: ${s}px;"></div>\n            </div>        \n          `;initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent}else if("horizontal"==snapType){cubeOuter="";for(var c=0;c<l;c++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${c}" data-seal-type="${t}">`;for(d=0;d<3;d++)cubeOuter+=`<div class="cube"><img src="${r}" style="width: ${n}px; height: ${s}px;"></div>`;cubeOuter+="</div>"}cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>     \n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,initMove.init(dropParent,"add")}if("horizontal"==snapType&&dropParent.classList.add("horizontal"),(l=dropParent.querySelectorAll(".cube-outer").length)==cubeLimit){if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(d=0;d<3;d++)cubeOuter+=`<div class="cube drag-area" data-index="${d}" data-seal-type="${t}"><img src="${r}" style="width: ${n}px; height: ${s}px;"></div>`;cubeOuter+='\n            </div>\n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n          ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical")}else"horizontal"==snapType&&(dropParent=initMove.dropParent);console.log("limit reached!!!!!!!!!!")}initMove.init(dropParent,"add"),dragParent.remove()}else if(l>cubeLimit){var u=cubeLimit-i,v=o-u;if("vertical"==snapType){cubeOuter='<div class="cube-outer">';for(d=0;d<3;d++)cubeOuter+=`<div class="cube drag-area" data-index="${d}" data-seal-type="${t}"><img src="${r}" style="width: ${n}px; height: ${s}px;"></div>`;cubeOuter+='\n          </div>\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>     \n        ',initMove.dropParent.innerHTML=cubeOuter,dropParent=initMove.dropParent,dropParent.classList.add("vertical");for(var p=0;p<u;p++)dragParent.querySelector('[data-index="'+(o-1-p)+'"].cube-outer').remove()}else if("horizontal"==snapType){cubeOuter="";for(c=0;c<u;c++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${i+c}" data-seal-type="${t}">`;for(d=0;d<3;d++)cubeOuter+=`<div class="cube"><img src="${r}" style="width: ${n}px; height: ${s}px;"></div>`;cubeOuter+="</div>"}if(initMove.dropParent.innerHTML+=cubeOuter,dropParent=initMove.dropParent,1==v){cubeOuter='<div class="cube-outer">';for(d=0;d<3;d++)cubeOuter+=`<div class="cube drag-area" data-index="${d}" data-seal-type="${t}"><img src="${r}" style="width: ${n}px; height: ${s}px;"></div>\n          `;cubeOuter+='\n            </div> \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n          ',initMove.dragParent.innerHTML=cubeOuter,dragParent=initMove.dragParent,initMove.init(dragParent,"add"),dragParent.classList.remove("horizontal")}else for(p=0;p<u;p++)dragParent.querySelector('[data-index="'+(o-1-p)+'"].cube-outer').remove()}initMove.init(dropParent,"add"),dragParent.style.left=a,dragParent.style.top=dragParentTop,initMove.init(dragParent,"add"),dragParent.classList.add("cant-snap"),console.log("limit reached!!!!!!!!!!")}dragParent.addEventListener(e,function t(){dragParent.removeEventListener(e,t);dragParent.classList.remove("cant-snap")}),dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight")},s=function(e){if("vertical"==r){var t=e.target,n=parseInt(t.dataset.index),i=(g=dragParent.querySelectorAll(".drag-area").length)-n,o=dragParent.querySelector("[data-seal-type]").dataset.sealType,l=dragParent.querySelector("img").src,d=dragParent.querySelector("img").width,c=dragParent.querySelector("img").height;if(a=dragParent.style.left,dragParentTop=dragParent.style.top,1!=g||dragParent.classList.contains("vertical"))if(n){if(dragParent.classList.contains("vertical")){cubeOuter="";for(u=0;u<n;u++)cubeOuter+=`\n              <div class="cube-outer drag-area" data-index="${u}" data-seal-type="${o}">\n                <div class="cube"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n              </div>        \n            `;cubeOuter+='\n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n          ',initMove.dragParent.innerHTML=cubeOuter,dragParent=initMove.dragParent,dragParent.classList.remove("vertical"),initMove.init(dragParent,"add"),dragParent.addEventListener("dblclick",s,!1)}else for(var u=n;u<g;u++)dragParent.querySelector('[data-index="'+u+'"]').remove();var v=parseFloat(a),p=parseFloat(dragParentTop)+dragParent.getBoundingClientRect().height+30;(y=document.createElement("div")).classList.add("draggable-cubes"),y.classList.add("draggable"),y.setAttribute("data-id",++initDrag.draggablesId),y.setAttribute("data-seal-type",o),y.style.left=v+"px",y.style.top=p+"px",y.style.zIndex=++initMove.dragParentzIndex,cubeOuter="";for(u=0;u<i;u++)cubeOuter+=`\n          <div class="cube-outer drag-area" data-index="${u}" data-seal-type="${o}">\n            <div class="cube"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n          </div>        \n        `;cubeOuter+='\n          <div class="dot dot-top"></div>\n          <div class="dot dot-bottom"></div>\n          <div class="dot dot-left"></div>\n          <div class="dot dot-right"></div>     \n        ',y.innerHTML=cubeOuter,cvOuter.appendChild(y),initMove.init(y,"add"),y.addEventListener("dblclick",s,!1)}else console.warn("Can't remove from here!");else dragParent.remove()}else{var g;t=e.target,n=parseInt(t.dataset.index),i=(g=dragParent.querySelectorAll(".drag-area").length)-n,o=dragParent.querySelector("[data-seal-type]").dataset.sealType,l=dragParent.querySelector("img").src,d=dragParent.querySelector("img").width,c=dragParent.querySelector("img").height;if(a=dragParent.style.left,dragParentTop=dragParent.style.top,n){if(1==n){cubeOuter='<div class="cube-outer">';for(u=0;u<3;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${o}"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n          `;cubeOuter+='\n            </div> \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n          ',initMove.dragParent.innerHTML=cubeOuter,dragParent=initMove.dragParent,initMove.init(dragParent,"add"),dragParent.classList.remove("horizontal")}else for(u=n;u<g;u++)dragParent.querySelector('[data-index="'+u+'"]').remove();var y;v=parseFloat(a)+dragParent.getBoundingClientRect().width+30,p=parseFloat(dragParentTop);if((y=document.createElement("div")).classList.add("draggable-cubes"),y.classList.add("draggable"),y.setAttribute("data-seal-type",o),y.setAttribute("data-id",++initDrag.draggablesId),y.style.left=v+"px",y.style.top=p+"px",y.style.zIndex=++initMove.dragParentzIndex,1==i){cubeOuter='<div class="cube-outer">';for(u=0;u<3;u++)cubeOuter+=`<div class="cube drag-area" data-index="${u}" data-seal-type="${o}"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>\n          `;cubeOuter+='\n            </div> \n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n          '}else{cubeOuter="";for(var m=0;m<i;m++){cubeOuter+=`<div class="cube-outer drag-area" data-index="${m}" data-seal-type="${o}">`;for(u=0;u<3;u++)cubeOuter+=`<div class="cube"><img src="${l}" style="width: ${d}px; height: ${c}px;"></div>`;cubeOuter+="</div>"}cubeOuter+='\n            <div class="dot dot-top"></div>\n            <div class="dot dot-bottom"></div>\n            <div class="dot dot-left"></div>\n            <div class="dot dot-right"></div>     \n          ',y.classList.add("horizontal")}initMove.dropParent=y,y.classList.add("vertical"),y.innerHTML=cubeOuter,cvOuter.appendChild(y),initMove.init(y,"add"),y.addEventListener("dblclick",s,!1)}else console.warn("Can't remove from here!")}};return{isSnapping:!1,snapDist:40,shortestDist:shortestDist,getCoords:function(){dragParent=initMove.dragParent,snapType=dragParent.classList.contains("vertical")?"horizontal":"vertical",r=dragParent.classList.contains("horizontal")?"horizontal":"vertical",t={};var e=dropDotCoord_1=null,n=document.querySelectorAll(".draggable-cubes");for(let a=0;a<n.length;a++)if(n[a]!=dragParent){"vertical"==snapType?(e=n[a].querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=n[a].querySelector(".dot-bottom").getBoundingClientRect()):(e=n[a].querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=n[a].querySelector(".dot-right").getBoundingClientRect());var s=n[a].dataset.id,i={0:{x:e.x,y:e.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}};t[s]=i}a=dragParent.style.left,dragParentTop=dragParent.style.top},getShortestDist:function(){var e=null;({i:0,j:0,id:""}),"vertical"==snapType?(dropDotCoord_0=dragParent.querySelector(".dot-top").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-bottom").getBoundingClientRect()):(dropDotCoord_0=dragParent.querySelector(".dot-left").getBoundingClientRect(),dropDotCoord_1=dragParent.querySelector(".dot-right").getBoundingClientRect());for(var a={0:{x:dropDotCoord_0.x,y:dropDotCoord_0.y},1:{x:dropDotCoord_1.x,y:dropDotCoord_1.y}},r=0;r<1;r++)for(var n in t){var s=0==r?1:0;if(t.hasOwnProperty(n)){var i=a[r].x,o=a[r].y,l=i-t[n][s].x,d=o-t[n][s].y,c=parseFloat(Math.sqrt(l*l+d*d).toFixed(2));(null==e||e>c)&&(e=c,{i:0==r?0:1,j:0==s?0:1,id:n},initCubes.shortestDist=e,dropParent=initMove.dropParent=document.querySelector('[data-id="'+n+'"'),"vertical"==snapType&&dropParent.classList.contains("vertical"),"horizontal"==snapType&&(dragParent.classList.contains("vertical")&&dropParent.classList.contains("vertical")||(initCubes.shortestDist=null)))}}},highlight:function(e){e?(dragParent.classList.add("highlight"),dropParent.classList.add("highlight")):(dragParent.classList.remove("highlight"),dropParent.classList.remove("highlight"))},snap:n,snap:n,detach:s,detach:s}}(),initRotate=function(){var e,t=null,a=null,r=null,n=null,s=null,i={x:0,y:0},o=180/Math.PI,l=function(e){var n,l;e.preventDefault(),n=e.clientX-i.x,l=e.clientY-i.y;var d=Math.floor(o*Math.atan2(l,n));a=d-t,console.log(s),r.style.transform="clock"==s?"translateY(-50%) rotate("+d+"deg)":"compass"==s?"translateX(-50%) rotate("+d+"deg)":"rotate("+a+"deg)"},d=function(t){e.dataset.angle=a<0?a+360:a,cvOuter.classList.remove("rotating"),cvOuter.removeEventListener("mousemove",l,!1),cvOuter.removeEventListener("mouseup",d,!1)};return{start:function(a){a.preventDefault();var c,u,v,p,g,y,m,h=a.target;e=h.closest(".draggable"),s=e.dataset.panel,r=h.closest(".rotatable"),n!=e&&(t=null),n=e,cvOuter.classList.add("rotating"),v=(m="clock"==s?h.closest(".draggable").getBoundingClientRect():r.getBoundingClientRect()).top,u=m.left,c=m.height,p=m.width,i={x:u+p/2,y:v+c/2},g=a.clientX-i.x,y=a.clientY-i.y,null==t&&(t=Math.floor(o*Math.atan2(y,g))),cvOuter.addEventListener("mousemove",l,!1),cvOuter.addEventListener("mouseup",d,!1)}}}(),initScale=function(e){var t=function(e){console.log("scale"),e.preventDefault()},a=function(e){console.log("end"),cvOuter.removeEventListener("mousemove",t,!1),cvOuter.removeEventListener("mouseup",a,!1)};return{start:function(e){console.log("start"),cvOuter.addEventListener("mousemove",t,!1),cvOuter.addEventListener("mouseup",a,!1)}}}(),initCalc=function(e){var calc=document.querySelector('[data-panel="calculator"]'),buttons=calc.querySelectorAll("[data-button-type]"),result=document.getElementById("result"),num="";function calculate(e){var buttonType=e.target.closest("g[data-button-type]").dataset.buttonType,buttonValue=e.target.closest("g[data-button-type]").dataset.buttonValue;if("num"==buttonType)num+=buttonValue,result.innerHTML=num;else if("func"==buttonType)switch(buttonValue){case"=":num=eval(num).toString(),result.innerHTML=num;break;case"<-":num=num.slice(0,-1),result.innerHTML=num;break;case"c":case"ac":result.innerHTML=num="";break;case"*":case"/":case"+":case"-":num+=" "+buttonValue+" ",result.innerHTML=num}}buttons.forEach(e=>{e.addEventListener("click",calculate,!1)})},initAbacus=function(){window.onload=function(){mousedown=0,body=document.querySelector("body"),body.addEventListener("mousedown",function(){mousedown=1}),body.addEventListener("mouseup",function(){mousedown=0}),upper_part=document.querySelectorAll(".upper_layer"),upper_part.forEach(function(e){e.addEventListener("click",function(e,t,a){t.style.background="red","down"==t.dataset.pos?(t.setAttribute("transform","translate(0,-20)"),t.dataset.pos="up"):(t.setAttribute("transform","translate(0,0)"),t.dataset.pos="down")}.bind(null,event,e)),e.addEventListener("mousemove",function(e,t,a){mousedown&&t.setAttribute("transform","translate(0,0)")}.bind(null,event,e))}),lower_part=document.querySelectorAll(".bottom_boxes"),lower_part.forEach(function(e){e.addEventListener("click",function(e,t,a){if(column_id=t.parentNode.getAttribute("id"),boxes=document.querySelectorAll("#"+column_id+" .bottom_boxes"),till=t.dataset.pos,"down"==t.dataset.state)for(i=0;i<=till;++i)boxes[i].setAttribute("transform","translate(0,-43)"),boxes[i].dataset.state="up";else for(i=till;i<=3;++i)boxes[i].setAttribute("transform","translate(0,0)"),boxes[i].dataset.state="down"}.bind(null,event,e)),e.addEventListener("mousemove",function(e,t,a){if(column_id=t.parentNode.getAttribute("id"),boxes=document.querySelectorAll("#"+column_id+" .bottom_boxes"),mousedown&&"up"==t.dataset.state)for(i=0;i<=3;++i)boxes[i].setAttribute("transform","translate(0,0)"),boxes[i].dataset.state="down"}.bind(null,event,e))})}};document.querySelector('[data-tool-type1="pen"]').click();
//# sourceMappingURL=script.min.js.map
